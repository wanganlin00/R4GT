[
  {
    "objectID": "热图.html",
    "href": "热图.html",
    "title": "",
    "section": "",
    "text": "关系图热图 CodeShow All CodeHide All CodeView Source",
    "crumbs": [
      "图",
      "关系图",
      "热图"
    ]
  },
  {
    "objectID": "热图.html#pheatmap",
    "href": "热图.html#pheatmap",
    "title": "",
    "section": "\n1.1 pheatmap\n",
    "text": "1.1 pheatmap\n\n\nCodelibrary(pheatmap)\n\n\n\nCode# Create test matrix\noptions(digits = 3)\nset.seed(10)\ntest = matrix(rnorm(200), 20, 10)\ntest[1:10, seq(1, 10, 2)] = test[1:10, seq(1, 10, 2)] + 3\ntest[11:20, seq(2, 10, 2)] = test[11:20, seq(2, 10, 2)] + 2\ntest[15:20, seq(2, 10, 2)] = test[15:20, seq(2, 10, 2)] + 4\ncolnames(test) = paste(\"Test\", 1:10, sep = \"\")\nrownames(test) = paste(\"Gene\", 1:20, sep = \"\")\n\ntest\n#&gt;          Test1  Test2  Test3  Test4   Test5  Test6  Test7   Test8  Test9\n#&gt; Gene1   3.0187 -0.596  4.087 -1.238  3.5928 -0.762  2.519 -1.6753  3.653\n#&gt; Gene2   2.8157 -2.185  2.237 -0.456  2.7773  0.419  3.203 -1.2052  2.451\n#&gt; Gene3   1.6287 -0.675  2.171 -0.830  3.7129 -1.040  2.968 -1.9633  3.521\n#&gt; Gene4   2.4008 -2.119  3.834  0.340  3.7166  0.712  1.804  1.4708  2.301\n#&gt; Gene5   3.2945 -1.265  2.032  1.066  3.4402 -0.633  3.624  0.3725  2.561\n#&gt; Gene6   3.3898 -0.374  2.971  1.216  3.1588  0.563  2.085  1.0659  2.323\n#&gt; Gene7   1.7919 -0.688  3.233  0.736  3.6598  0.661  3.249  0.5306  3.959\n#&gt; Gene8   2.6363 -0.872  2.699 -0.481  5.2205 -1.658  1.937  0.1020  1.532\n#&gt; Gene9   1.3733 -0.102  2.322  0.563  1.8161  1.028  2.636  1.3378  3.184\n#&gt; Gene10  2.7435 -0.254  3.655 -1.246  2.9260  1.128  1.793  0.0872  1.565\n#&gt; Gene11  1.1018  0.146 -0.401  2.381 -0.4164  0.720  1.429  1.6089 -1.137\n#&gt; Gene12  0.7558  1.922 -0.335  0.570 -0.1915  3.129  0.633  1.7501 -0.415\n#&gt; Gene13 -0.2382  2.969  1.368  0.952  0.0695  1.536 -1.997  3.1551  0.144\n#&gt; Gene14  0.9874  2.185  2.138  1.781  1.1553  1.684 -0.682  1.1353  1.062\n#&gt; Gene15  0.7414  4.620  0.506  4.510  0.5950  6.924 -0.460  5.1333 -0.571\n#&gt; Gene16  0.0893  4.564  0.786  7.173 -1.4196  6.077 -0.983  3.6790  1.277\n#&gt; Gene17 -0.9549  6.362 -0.902  4.520 -1.6067  7.040  0.495  6.6088  0.228\n#&gt; Gene18 -0.1952  4.241  0.533  5.570  0.8929  6.742  0.726  7.1500 -0.309\n#&gt; Gene19  0.9255  5.675 -0.646  4.948  0.1482  7.256  0.667  4.8004  0.960\n#&gt; Gene20  0.4830  5.348  0.291  7.523  1.2270  6.951  0.955  4.4200  0.549\n#&gt;         Test10\n#&gt; Gene1   0.4255\n#&gt; Gene2   0.6435\n#&gt; Gene3  -1.3603\n#&gt; Gene4  -0.1985\n#&gt; Gene5   0.6193\n#&gt; Gene6   2.0682\n#&gt; Gene7  -0.3053\n#&gt; Gene8   0.2812\n#&gt; Gene9   0.6913\n#&gt; Gene10  0.0464\n#&gt; Gene11  2.1130\n#&gt; Gene12  2.9953\n#&gt; Gene13  1.3188\n#&gt; Gene14  0.7229\n#&gt; Gene15  4.5313\n#&gt; Gene16  5.6865\n#&gt; Gene17  4.2963\n#&gt; Gene18  4.6495\n#&gt; Gene19  4.8979\n#&gt; Gene20  4.9005\n\n\n\nCodepheatmap(test)\n\n\n\n\n\n\nCodepheatmap(test, kmeans_k = 2)\n#&gt; Warning: argument `kmeans_k` is not suggested to use in pheatmap -&gt; Heatmap\n#&gt; translation because it changes the input matrix. You might check\n#&gt; `row_km` and `column_km` arguments in Heatmap().\n\n\n\n\n\n\nCodepheatmap(test, scale = \"row\", clustering_distance_rows = \"correlation\")\n\n\n\n\n\n\nCodepheatmap(test, color = colorRampPalette(c(\"navy\", \"white\", \"firebrick3\"))(50))\n\n\n\n\n\n\nCodepheatmap(test, cluster_row = FALSE)\n\n\n\n\n\n\nCodepheatmap(test, legend = FALSE)\n\n\n\n\n\n\n\n\nCode# Show text within cells\npheatmap(test, display_numbers = TRUE)\n\n\n\n\n\n\nCodepheatmap(test, display_numbers = TRUE, number_format = \"\\\\%.1e\")\n\n\n\n\n\n\nCodepheatmap(test, display_numbers = matrix(ifelse(test &gt; 5, \"*\", \"\"), nrow(test)))\n\n\n\n\n\n\nCodepheatmap(test, cluster_row = FALSE, legend_breaks = -1:4, legend_labels = c(\"0\",\n\"1e-4\", \"1e-3\", \"1e-2\", \"1e-1\", \"1\"))\n\n\n\n\n\n\n\n\nCodeannotation_col = data.frame(type=c(rep(\"normal\",5),rep(\"tumor\",5)))\nrownames(annotation_col) &lt;- colnames(test)\nanno_colors &lt;- list(type=c(normal=\"#1b9e77\",tumor=\"#d95f02\"))\n\npheatmap(\n    test,\n    show_rownames = T,\n    show_colnames = F,\n    cluster_rows = F,\n    treeheight_col = 5,\n    display_numbers = T,\n    #gaps_col = 5,\n    annotation_col = annotation_col,\n    annotation_colors = anno_colors,\n    annotation_legend =F\n)\n\n\n\n\n\n\n\n均一化z-score\n\nCodepheatmap(test,scale = \"column\",border_color = \"green\",fontsize = 8)\n\n\n\n\n\n\n\n\nCodepheatmap(test,scale = \"row\",border_color = NA,color = colorRampPalette(c(\"blue\",\"white\",\"red\"))(200))\n\n\n\n\n\n\nCode\npheatmap(test,scale = \"row\",border_color = NA,color = colorRampPalette(c(\"darkblue\", \"green\", \"yellow\"))(10))",
    "crumbs": [
      "图",
      "关系图",
      "热图"
    ]
  },
  {
    "objectID": "热图.html#geom_tile",
    "href": "热图.html#geom_tile",
    "title": "",
    "section": "\n1.2 geom_tile()\n",
    "text": "1.2 geom_tile()\n\n\nCode# 设置随机数种子以确保结果的可重复性  \nset.seed(10)  \n  \n# 生成随机数据集  \nmydata &lt;- tibble(  \n  year = 2000:2024,  \n  lung = runif(25),  \n  liver = runif(25), \n  bone = runif(25),  \n  luk = runif(25),  \n  eso = runif(25),  \n  gas = runif(25),   \n  eye = runif(25),  \n  brain = runif(25),  \n  pan = runif(25),  \n  kidney = runif(25),  \n  breast= runif(25),  \n)  |&gt; pivot_longer(cols = -1,\n                   names_to = \"cancer\",\n                   values_to = \"morbidity\")\n\nggplot(mydata, aes(year, cancer)) +  \n  geom_tile(aes(fill =morbidity)) +  \n  scale_fill_gradient(low = \"white\", high = \"red\")",
    "crumbs": [
      "图",
      "关系图",
      "热图"
    ]
  },
  {
    "objectID": "热图.html#complexheatmap",
    "href": "热图.html#complexheatmap",
    "title": "",
    "section": "\n1.3 ComplexHeatmap\n",
    "text": "1.3 ComplexHeatmap\n\nhttps://jokergoo.github.io/ComplexHeatmap-reference/book/\n\nCodeif(!require(ComplexHeatmap)) BiocManager::install(\"ComplexHeatmap\")\n\n\n\nCodeset.seed(123)\nnr1 = 4; nr2 = 8; nr3 = 6; nr = nr1 + nr2 + nr3\nnc1 = 6; nc2 = 8; nc3 = 10; nc = nc1 + nc2 + nc3\nmat = cbind(rbind(matrix(rnorm(nr1*nc1, mean = 1,   sd = 0.5), nrow  = nr1),\n          matrix(rnorm(nr2*nc1, mean = 0,   sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc1, mean = 0,   sd = 0.5), nrow = nr3)),\n    rbind(matrix(rnorm(nr1*nc2, mean = 0,   sd = 0.5), nrow = nr1),\n          matrix(rnorm(nr2*nc2, mean = 1,   sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc2, mean = 0,   sd = 0.5), nrow = nr3)),\n    rbind(matrix(rnorm(nr1*nc3, mean = 0.5, sd = 0.5), nrow = nr1),\n          matrix(rnorm(nr2*nc3, mean = 0.5, sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc3, mean = 1,   sd = 0.5), nrow = nr3))\n   )\nmat = mat[sample(nr, nr), sample(nc, nc)] # random shuffle rows and columns\nrownames(mat) = paste0(\"row\", seq_len(nr))\ncolnames(mat) = paste0(\"column\", seq_len(nc))\n\n\n\nCodeHeatmap(mat)\n\n\n\n\n\n\n\n\nCodeset.seed(123)\nmat = matrix(rnorm(100), 10)\nrownames(mat) = paste0(\"R\", 1:10)\ncolnames(mat) = paste0(\"C\", 1:10)\ncolumn_ha = HeatmapAnnotation(foo1 = runif(10), bar1 = anno_barplot(runif(10)))\nrow_ha = rowAnnotation(foo2 = runif(10), bar2 = anno_barplot(runif(10)))\nHeatmap(mat, name = \"mat\", top_annotation = column_ha, right_annotation = row_ha)",
    "crumbs": [
      "图",
      "关系图",
      "热图"
    ]
  },
  {
    "objectID": "相关图.html",
    "href": "相关图.html",
    "title": "",
    "section": "",
    "text": "关系图相关图 CodeShow All CodeHide All CodeView Source\n1 相关图\n\nCodelibrary(tidyverse)\nlibrary(ggcorrplot)\n\n\n\nCodedata(\"iris\")\ncor&lt;-cor(iris[,1:4])\nggcorrplot(cor)\n\n\n\n\n\n\nCodep.mat &lt;- ggcorrplot::cor_pmat(cor)\nggcorrplot(cor,hc.order=TRUE,lab=TRUE)\n\n\n\n\n\n\nCode\nggcorrplot(cor, hc.order = TRUE, p.mat = p.mat) + \n    labs(title = \"鸢尾花数据集指标相关性\") +\n    theme(plot.title = element_text(hjust = 0.5))\n\n\n\n\n\n\n\n\n\n\n\n Back to top",
    "crumbs": [
      "图",
      "关系图",
      "相关图"
    ]
  },
  {
    "objectID": "回归曲线.html",
    "href": "回归曲线.html",
    "title": "",
    "section": "",
    "text": "线图回归曲线 CodeShow All CodeHide All CodeView Source",
    "crumbs": [
      "图",
      "线图",
      "回归曲线"
    ]
  },
  {
    "objectID": "回归曲线.html#简单线性回归",
    "href": "回归曲线.html#简单线性回归",
    "title": "",
    "section": "\n1.1 简单线性回归",
    "text": "1.1 简单线性回归\nR2 ,p值：f6c\n\nCodelibrary(tidyverse)\n\n\n\nCode# 示例数据\ndf &lt;- data.frame(\n  x = 1:100,\n  y = rnorm(100) + 2 * (1:100)  # 生成具有线性关系的x和y数据\n)\n\n# 创建基本的ggplot对象\np &lt;- ggplot(df, aes(x = x, y = y))+\n    geom_point(color='red')+\n    geom_smooth(method = \"lm\",formula = \"y~x\",color=\"black\",linewidth=.8)\n\n# 使用stat_poly_eq()添加线性回归方程、R²和p值\np + ggpmisc::stat_poly_eq(formula = y ~ x,\n                 ggpmisc::use_label(c(\"eq\", \"adj.R2\", \"P\")))\n#&gt; Registered S3 methods overwritten by 'ggpp':\n#&gt;   method                  from   \n#&gt;   heightDetails.titleGrob ggplot2\n#&gt;   widthDetails.titleGrob  ggplot2\n#&gt; Registered S3 method overwritten by 'ggpmisc':\n#&gt;   method                  from   \n#&gt;   as.character.polynomial polynom\n\n\n\n\n\n\n\n\nCodelibrary(tidyverse)\n\ndata(crickets, package = \"modeldata\")\nnames(crickets)\n#&gt; [1] \"species\" \"temp\"    \"rate\"\n\nggplot(crickets, \n       aes(x = temp, y = rate, color = species, pch = species, lty = species)) + \n  geom_point(size = 2) + \n  geom_smooth(method = lm, se = FALSE, alpha = 0.5) + \n  scale_color_brewer(palette = \"Paired\") +\n  labs(x = \"Temperature (C)\", y = \"Chirp Rate (per minute)\")\n#&gt; `geom_smooth()` using formula = 'y ~ x'",
    "crumbs": [
      "图",
      "线图",
      "回归曲线"
    ]
  },
  {
    "objectID": "生存曲线.html",
    "href": "生存曲线.html",
    "title": "",
    "section": "",
    "text": "线图生存曲线 CodeShow All CodeHide All CodeView Source",
    "crumbs": [
      "图",
      "线图",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#kaplan-meier-curve",
    "href": "生存曲线.html#kaplan-meier-curve",
    "title": "",
    "section": "\n1.1 Kaplan-Meier curve",
    "text": "1.1 Kaplan-Meier curve\n\nCodelibrary(tidyverse)\nlibrary(readxl)\nlibrary(survival)\nlibrary(ggsci)\nlibrary(ggsurvfit)\n\n\n\nCode### 数据 三列 “group”分组列， “time”生存时间列，“status”事件状态列\nd&lt;-read_excel(\"data/01source.xlsx\",sheet=1,range = \"A19:E75\") |&gt; \n    rename(\n        LR_DPVB=`LR-DPVB`\n    )  |&gt; \n    pivot_longer(\n        cols = CON:LR_DPVB,\n        names_to = \"treatment\",\n        values_to = \"status\"\n    ) |&gt; drop_na() |&gt; \n    mutate(\n        treatment=factor(treatment,levels=c('CON','LDRT','DPVB','LR_DPVB'))\n    )\n# 加载包\nd\n#&gt; # A tibble: 56 × 3\n#&gt;     Days treatment status\n#&gt;    &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;\n#&gt;  1    11 CON            1\n#&gt;  2    13 CON            1\n#&gt;  3    14 CON            1\n#&gt;  4    14 CON            1\n#&gt;  5    15 CON            1\n#&gt;  6    17 CON            1\n#&gt;  7    17 CON            1\n#&gt;  8    17 CON            1\n#&gt;  9    20 CON            1\n#&gt; 10    20 CON            1\n#&gt; # ℹ 46 more rows\n# 使用 Kaplan-Meier 方法拟合生存曲线\nkm_fit&lt;-survfit2(Surv(Days,status)~treatment,data=d)\nsummary(km_fit)\n#&gt; Call: survfit(formula = Surv(Days, status) ~ treatment, data = d)\n#&gt; \n#&gt;                 treatment=CON \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    11     14       1   0.9286  0.0688       0.8030        1.000\n#&gt;    13     13       1   0.8571  0.0935       0.6921        1.000\n#&gt;    14     12       2   0.7143  0.1207       0.5129        0.995\n#&gt;    15     10       1   0.6429  0.1281       0.4351        0.950\n#&gt;    17      9       3   0.4286  0.1323       0.2341        0.785\n#&gt;    20      6       2   0.2857  0.1207       0.1248        0.654\n#&gt;    21      4       2   0.1429  0.0935       0.0396        0.515\n#&gt;    25      2       1   0.0714  0.0688       0.0108        0.472\n#&gt;    27      1       1   0.0000     NaN           NA           NA\n#&gt; \n#&gt;                 treatment=LDRT \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    13     14       2   0.8571  0.0935       0.6921        1.000\n#&gt;    15     12       1   0.7857  0.1097       0.5977        1.000\n#&gt;    16     11       1   0.7143  0.1207       0.5129        0.995\n#&gt;    18     10       1   0.6429  0.1281       0.4351        0.950\n#&gt;    19      9       2   0.5000  0.1336       0.2961        0.844\n#&gt;    20      7       3   0.2857  0.1207       0.1248        0.654\n#&gt;    24      4       1   0.2143  0.1097       0.0786        0.584\n#&gt;    25      3       1   0.1429  0.0935       0.0396        0.515\n#&gt;    27      2       1   0.0714  0.0688       0.0108        0.472\n#&gt;    30      1       1   0.0000     NaN           NA           NA\n#&gt; \n#&gt;                 treatment=DPVB \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    20     14       1    0.929  0.0688        0.803        1.000\n#&gt;    23     13       1    0.857  0.0935        0.692        1.000\n#&gt;    27     12       1    0.786  0.1097        0.598        1.000\n#&gt;    28     11       1    0.714  0.1207        0.513        0.995\n#&gt;    30     10       1    0.643  0.1281        0.435        0.950\n#&gt;    32      9       1    0.571  0.1323        0.363        0.899\n#&gt;    38      8       1    0.500  0.1336        0.296        0.844\n#&gt;    39      7       1    0.429  0.1323        0.234        0.785\n#&gt;    45      6       1    0.357  0.1281        0.177        0.721\n#&gt; \n#&gt;                 treatment=LR_DPVB \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    30     14       1    0.929  0.0688        0.803            1\n#&gt;    40     13       1    0.857  0.0935        0.692            1",
    "crumbs": [
      "图",
      "线图",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#plot",
    "href": "生存曲线.html#plot",
    "title": "",
    "section": "\n1.2 plot()\n",
    "text": "1.2 plot()\n\n\nCodeplot(km_fit,\n     lty = 1,\n     col = c(\"gray\",\"blue\",\"orange3\",\"darkred\"),\n     lwd = 2,\n)",
    "crumbs": [
      "图",
      "线图",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#survminerggsurvplot",
    "href": "生存曲线.html#survminerggsurvplot",
    "title": "",
    "section": "\n1.3 survminer::ggsurvplot()\n",
    "text": "1.3 survminer::ggsurvplot()\n\n\nCode# 使用 ggplot2 和 survminer 绘制生存曲线图\nlibrary(survminer)\np &lt;- ggsurvplot(\n    fit  = km_fit,\n    data = d,\n    fun = \"pct\",  #event',累计死亡比列，'cumhaz':cumulative hazard累计风险\n    \n    palette = \"jco\",\n    linetype = c(1,5,4,6),\n    surv.median.line = 'none',\n    \n    conf.int = F,\n\n    \n    pval = TRUE,# \"log rank p=0.0053\"\n    log.rank.weights='1',  \n    pval.method = TRUE,\n    pval.coord=c(40,75),\n    pval.method.coord=c(32,75),\n    \n    risk.table = \"abs_pct\", # \"nrisk_cumcensor\" and \"nrisk_cumevents\"\n    risk.table.col = \"treatment\",\n    risk.table.height=0.3,\n    tables.theme = theme_cleantable(),\n    ncensor.plot=T,\n  \n    \n    axes.offset=F,  #(0,0)pos\n    title = \"Hepa1-6 tumor\",\n    xlab=\"Days\",\n    ylab=\"Percent survival (%)\",\n    \n    legend.title = \"\",\n    legend = c(0.2,0.35),\n    legend.labs=c('CON','LDRT','DPVB','LR_DPVB'),\n    \n    ggtheme = theme_survminer(),\n)\np\n\n\n\n\n\n\n\n\nCodefit&lt;- survfit(Surv(time, status) ~ sex, data = lung)\n\n# Basic survival curves\nggsurvplot(fit, data = lung)\n\n\n\n\n\n\nCode\n# Customized survival curves\np &lt;- ggsurvplot(fit, data = lung,\n           surv.median.line = \"hv\", # Add medians survival\n           \n           # Change legends: title & labels\n           legend.title = \"Sex\",\n           legend.labs = c(\"Male\", \"Female\"),\n           # Add p-value and tervals\n           pval = TRUE,\n           \n           conf.int = TRUE,\n           # Add risk table\n           risk.table = TRUE,\n           tables.height = 0.2,\n           tables.theme = theme_cleantable(),\n           \n           # Color palettes. Use custom color: c(\"#E7B800\", \"#2E9FDF\"),\n           # or brewer color (e.g.: \"Dark2\"), or ggsci color (e.g.: \"jco\")\n           palette = c(\"#E7B800\", \"#2E9FDF\"),\n           ggtheme = theme_bw() # Change ggplot2 theme\n)\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n\n\n\nCodep &lt;- ggsurvplot(fit, data = lung,\n                surv.median.line = \"hv\", # Add medians survival\n                \n                # Change legends: title & labels\n                legend.title = \"Sex\",\n                legend.labs = c(\"Male\", \"Female\"),\n                # Add p-value and tervals\n                pval = F,    ##不默认显示P\n                conf.int = TRUE,\n                # Add risk table\n                risk.table = TRUE,\n                tables.height = 0.2,\n                tables.theme = theme_cleantable(),\n                \n                # Color palettes. Use custom color: c(\"#E7B800\", \"#2E9FDF\"),\n                # or brewer color (e.g.: \"Dark2\"), or ggsci color (e.g.: \"jco\")\n                palette = c(\"#E7B800\", \"#2E9FDF\"),\n                ggtheme = theme_bw() # Change ggplot2 theme\n)\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n##计算公式\ndata.survdiff &lt;- survdiff(Surv(time, status) ~ sex,data = lung)\np.val = 1 - pchisq(data.survdiff$chisq, length(data.survdiff$n) - 1)\nHR = (data.survdiff$obs[2]/data.survdiff$exp[2])/(data.survdiff$obs[1]/data.survdiff$exp[1])\nup95 = exp(log(HR) + qnorm(0.975)*sqrt(1/data.survdiff$exp[2]+1/data.survdiff$exp[1]))\nlow95 = exp(log(HR) - qnorm(0.975)*sqrt(1/data.survdiff$exp[2]+1/data.survdiff$exp[1]))\nci &lt;- paste0(sprintf(\"%.3f\",HR),\" [\",sprintf(\"%.3f\",low95),\", \",sprintf(\"%.3f\",up95),\"]\")\n\np$plot &lt;- p$plot + \n  annotate(\"text\", x = 0, y = 0.05, \n                            label = paste0(\"P value = \",sprintf(\"%.3f\",p.val),\"\\n HR (95% CI) = \",ci),   ###添加P和HR 95%CI\n                            size = 5, color = \"black\", hjust = 0)+\n  theme(text = element_text(size = 15))\np$plot\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.",
    "crumbs": [
      "图",
      "线图",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#ggsurvfit",
    "href": "生存曲线.html#ggsurvfit",
    "title": "",
    "section": "\n1.4 ggsurvfit",
    "text": "1.4 ggsurvfit\n\nCodelibrary(ggsurvfit)\nkm_fit\n#&gt; Call: survfit(formula = Surv(Days, status) ~ treatment, data = d)\n#&gt; \n#&gt;                    n events median 0.95LCL 0.95UCL\n#&gt; treatment=CON     14     14   17.0      15      25\n#&gt; treatment=LDRT    14     14   19.5      18      27\n#&gt; treatment=DPVB    14      9   38.5      30      NA\n#&gt; treatment=LR_DPVB 14      2     NA      NA      NA\n\n\nkm_fit |&gt; tidy_survfit() |&gt; \n    ggplot(aes(time,estimate,min=conf.low,ymax=conf.low,\n               color=strata,fill=strata))+\n    scale_color_jco()+\n    geom_step()\n\n\n\n\n\n\nCode\nkm_fit |&gt; ggsurvfit()+\n    add_confidence_interval()+\n    # 添加删失点\n    add_censor_mark()  +\n    add_quantile()+\n    add_pvalue(\"annotation\",size=3,x=5,y=0.25)+\n    #add_pvalue(caption = \"Log-rank {p.value}\")+\n    add_risktable(size = 3,risktable_height = 0.3)+\n    add_legend_title(\"treatment\")",
    "crumbs": [
      "图",
      "线图",
      "生存曲线"
    ]
  }
]