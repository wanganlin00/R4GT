[
  {
    "objectID": "条形图.html",
    "href": "条形图.html",
    "title": "\n1 条形图",
    "section": "",
    "text": "Codelibrary(tidyverse)\nlibrary(ggpubr)\nlibrary(ggthemes)\nlibrary(patchwork)\n\n\n\n\nCodedf &lt;- ToothGrowth |&gt; rownames_to_column(\"id\")\nggplot(df,aes(dose,len,color=factor(dose)))+\n    geom_col(fill=NA)\n\n\n\n\n\n\n\n\n\nCodeggplot(df,aes(id,len))+\n    geom_col()+\n   ggrepel::geom_text_repel(aes(y=len+3,label=len))\n\n\n\n\n\n\n\n\n\nCodedf &lt;- ToothGrowth |&gt; rownames_to_column(\"id\")\nggplot(df, aes(x=supp, y=len, fill = factor(dose)))+\n  stat_summary(fun=\"mean\", geom=\"bar\",position = position_dodge(1))+\n  stat_summary(fun.data=\"mean_sd\", geom=\"errorbar\", width=0.25,position = position_dodge(1))+\n  theme_tufte(base_size=16, base_family=\"sans\", ticks=FALSE)+\n  labs(x=\"Group\", y=\"Values\", caption=\"Error Bars Indicate Standard Error\")\n\n\n\n\n\n\n\n\n\nCodelibrary(ggsignif)\nggplot(data = PlantGrowth, aes(x = group, y = weight)) +\n  geom_boxplot(width = 0.25) +\n  geom_jitter(width = 0.15) +\n  geom_signif(comparisons = list(c(\"ctrl\", \"trt1\"), c(\"trt1\", \"trt2\")), \n              map_signif_level = function(p) sprintf(\"p = %.3g\", p), \n              textsize = 6, test = \"t.test\") +\n    ylim(c(NA,7))+\n  theme_classic() +\n  coord_cartesian(clip = \"off\")\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(x = drv, y = hwy, fill = as.factor(cyl))) +  \n    geom_bar(stat = \"summary\",fun=mean, position = position_dodge(1)) +\n    stat_summary(fun.data = 'mean_sd',geom=\"errorbar\",position = position_dodge(1),\n                 width=.2,linewidth=1)+\n    geom_point(position = position_dodge(1), \n              size = 3,alpha=0.3\n             )  \n\n\n\n\n\n\n\n\nCodedf &lt;- ToothGrowth\nggplot(df, aes(x = supp, y = len)) +\n    geom_bar(\n        aes(fill = factor(dose)),\n        stat = \"summary\",\n        fun = mean,\n        position = position_dodge(width = 0.9)\n    ) +\n    geom_point(position = position_jitterdodge(jitter.width = 0.1),\n               aes(color = factor(dose)),\n               alpha = 0.7)+\n    scale_color_manual(values = c(\"red\",\"green\",\"blue\"))|\n    ggplot(df, aes(x = supp, y = len)) +\n    geom_bar(\n        aes(fill = factor(dose)),\n        stat = \"summary\",\n        fun = mean,\n        position = position_dodge(width = 0.9)\n    ) +\n    geom_dotplot(position = position_dodge(width = 0.9),\n               aes(fill = factor(dose)),dotsize = 0.8,\n               binaxis = \"y\", stackdir = \"center\",color=\"black\",\n               alpha = 0.7)+\n    scale_fill_manual(values = c(\"red\",\"green\",\"blue\"))\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n\n\n\n\n\n\n\n\n\nCodelibrary(tidyverse)\nlibrary(ggpubr)\nlibrary(ggsci)\nlibrary(readxl)\nc &lt;- read_excel(\"data/01source.xlsx\",sheet=1,range = \"A2:D16\") |&gt; \n  rename(\n    LR_DPVB=`LR-DPVB`\n  )  |&gt; \n  pivot_longer(\n    cols = CON:LR_DPVB,\n    names_to = \"treatment\",\n    values_to = \"changerate\"\n  ) |&gt; \n  mutate(\n    treatment=factor(treatment,levels=c('CON','LDRT','DPVB','LR_DPVB')),\n    changerate=if_else(changerate&gt;=1,100,changerate*100)\n  ) |&gt; \n  arrange(treatment)|&gt;\n  drop_na() |&gt; \n  mutate(\n    id=1:52\n    ) \n\n\n\nCode\nggplot( c ,aes(x=id,y=changerate,fill=treatment))+ \n  geom_bar(stat = \"identity\",position = \"dodge\",width =0.8)+\n    scale_fill_jco()+\n    scale_y_continuous(name = \"MRI tumor volume change from baseline (%)\",\n                       limits = c(-100,100),\n                       breaks = seq(-100,100,50),\n                       )+\n    theme_pubr()+\n    theme(\n        legend.position = c(0.8,0.8),\n        legend.title = element_blank(),\n        axis.title.x = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.line.x = element_blank(),\n        plot.title = element_text(hjust = 0.5),\n    )+\n    ggtitle(\"Hepa1-6 tumor\")+\n    geom_hline(yintercept = 0,color = \"black\",linetype =1,linewidth=0.8)+\n    geom_hline(yintercept=c(20,-30), colour=\"gray15\", linetype=3,linewidth=0.8)+                # 0 = blank, 1 = solid, 2 = dashed, 3 = dotted, \n            # 4 = dotdash, 5 = longdash, 6 = twodash\n    annotate(geom = \"text\",x=c(2,50),y=c(-30,20),\n             label = c(\"PR:-30%\",\"PD:20%\"),\n             vjust = -0.5,\n             )   \n#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2\n#&gt; 3.5.0.\n#&gt; ℹ Please use the `legend.position.inside` argument of `theme()` instead.\n\n\n\n\n\n\n\n\nCode\nlibrary(ggplot2)\nlibrary(rstatix)\nlibrary(ggpubr)\n# sample data\nplot_df &lt;- ToothGrowth\n\n# Summarize the data\nsummary_df &lt;- plot_df %&gt;%\n  group_by(dose, supp) %&gt;%\n  summarise(\n    Mean = mean(len),\n    SD = sd(len),\n    SE = sd(len) / sqrt(n())  # Standard Error\n  )\n#&gt; `summarise()` has grouped output by 'dose'. You can override using the\n#&gt; `.groups` argument.\n\n# p values for supp between dose\np_sup &lt;- plot_df %&gt;%\n  group_by(supp) %&gt;%\n  t_test(len ~ dose, p.adjust.method = \"fdr\")\n\np_sup &lt;- p_sup %&gt;% \n  add_xy_position(x = \"dose\", group = \"supp\")\n\n# Group the data by dose and then compare the levels of the supps variable\np_dose &lt;- plot_df %&gt;%\n  group_by(dose) %&gt;%\n  t_test(len ~ supp) %&gt;%\n  adjust_pvalue(method = \"fdr\") %&gt;%\n  add_significance(\"p.adj\")\np_dose\n#&gt; # A tibble: 3 × 11\n#&gt;    dose .y.   group1 group2    n1    n2 statistic    df       p   p.adj\n#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;\n#&gt; 1   0.5 len   OJ     VC        10    10    3.17    15.0 0.00636 0.00954\n#&gt; 2   1   len   OJ     VC        10    10    4.03    15.4 0.00104 0.00312\n#&gt; 3   2   len   OJ     VC        10    10   -0.0461  14.0 0.964   0.964  \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\n\n# Add p-values onto the box plots\np_dose &lt;- p_dose %&gt;%\n  add_xy_position(x = \"dose\")\n\n# change dose to character\nsummary_df$dose &lt;- as.character(summary_df$dose)\n\n\n\n\nggplot(summary_df, aes(x = dose, y = Mean, fill = supp)) +\n  geom_bar(stat = \"identity\", color = \"black\", position = position_dodge()) +\n  geom_errorbar(aes(ymin = Mean - SE, ymax = Mean + SE), width = 0.2, position = position_dodge(.9)) +\n  theme_minimal() +\n  scale_fill_manual(\n    values = c(\"#999999\", \"#E69F00\"),\n    aesthetics = c(\"color\", \"fill\")\n  ) +\n  labs(\n    title = \"ToothGrowth\",\n    x = \"dose\",\n    y = \"len ± SE\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  stat_pvalue_manual(\n    p_sup,\n    tip.length = 0.01,\n    hide.ns = F,\n    color = \"supp\"\n  ) +\n  stat_pvalue_manual(\n    p_dose,\n    tip.length = 0.01,\n    hide.ns = F,\n    inherit.aes = FALSE\n  )\n\n\n\n\n\n\n\n\n\nggpubr\n\nCodeg&lt;-read_excel(\"data/01source.xlsx\",sheet=1,range=\"G2:Z3\") \n#&gt; New names:\n#&gt; • `` -&gt; `...2`\n#&gt; • `` -&gt; `...3`\n#&gt; • `` -&gt; `...4`\n#&gt; • `` -&gt; `...5`\n#&gt; • `` -&gt; `...7`\n#&gt; • `` -&gt; `...8`\n#&gt; • `` -&gt; `...9`\n#&gt; • `` -&gt; `...10`\n#&gt; • `` -&gt; `...12`\n#&gt; • `` -&gt; `...13`\n#&gt; • `` -&gt; `...14`\n#&gt; • `` -&gt; `...15`\n#&gt; • `` -&gt; `...17`\n#&gt; • `` -&gt; `...18`\n#&gt; • `` -&gt; `...19`\n#&gt; • `` -&gt; `...20`\ncolnames(g) &lt;- rep(c('CON','LDRT','DPVB','LR_DPVB'),each=5)\ng&lt;- g |&gt;  pivot_longer(\n  cols = everything(),\n  names_to = \"treatment\",\n  values_to = \"liverweight\"\n  )|&gt; \n  mutate(\n    treatment=factor(treatment,levels=c('CON','LDRT','DPVB','LR_DPVB'))\n  )\ng\n#&gt; # A tibble: 20 × 2\n#&gt;    treatment liverweight\n#&gt;    &lt;fct&gt;           &lt;dbl&gt;\n#&gt;  1 CON              1.75\n#&gt;  2 CON              1.8 \n#&gt;  3 CON              2.01\n#&gt;  4 CON              1.52\n#&gt;  5 CON              1.63\n#&gt;  6 LDRT             1.73\n#&gt;  7 LDRT             2.05\n#&gt;  8 LDRT             1.48\n#&gt;  9 LDRT             1.66\n#&gt; 10 LDRT             1.68\n#&gt; 11 DPVB             1.2 \n#&gt; 12 DPVB             1.38\n#&gt; 13 DPVB             1.52\n#&gt; 14 DPVB             1.62\n#&gt; 15 DPVB             1.39\n#&gt; 16 LR_DPVB          1.2 \n#&gt; 17 LR_DPVB          1.23\n#&gt; 18 LR_DPVB          1.13\n#&gt; 19 LR_DPVB          1.03\n#&gt; 20 LR_DPVB          0.89\n\n\n\nCodesource(\"function/calculate_t_tests.R\")\ncalculate_t_tests(g,\"treatment\",\"liverweight\")\n#&gt;                  CON         LDRT        DPVB LR_DPVB\n#&gt; CON               NA           NA          NA      NA\n#&gt; LDRT    0.8639404014           NA          NA      NA\n#&gt; DPVB    0.0193695457 0.0359059495          NA      NA\n#&gt; LR_DPVB 0.0003376202 0.0008265681 0.008820249      NA\n\n\n\n\n\n\n\n\nNote\n\n\n\n函数calculate_t_tests\n\nCode# 定义计算两两组之间t检验的函数\ncalculate_t_tests &lt;- function(data, group_by, value_column) {\n  # data: 数据框\n  # group_by: 组别的列名\n  # value_column: 要比较的数值的列名\n  \n  # 提取唯一的组别\n  groups &lt;- unique(data[[group_by]])\n  \n  # 初始化结果矩阵\n  result_matrix &lt;- matrix(NA, nrow = length(groups), ncol = length(groups),\n                          dimnames = list(groups, groups))\n  \n  # 循环遍历所有可能的组合\n  for (i in 1:(length(groups)-1)) {\n    for (j in (i+1):length(groups)) {\n      # 提取两组数据\n      group1_data &lt;- data[data[[group_by]] == groups[i], value_column]\n      group2_data &lt;- data[data[[group_by]] == groups[j], value_column]\n      \n      # 执行t检验\n      t_test_result &lt;- t.test(group1_data, group2_data)\n      \n      # 提取p值\n      p_value &lt;- t_test_result$p.value\n      \n      # 将p值存入结果矩阵\n      #result_matrix[groups[i], groups[j]] &lt;- p_value\n      result_matrix[groups[j], groups[i]] &lt;- p_value\n    }\n  }\n  \n  # 返回结果矩阵\n  return(result_matrix)\n}\n\n\n\n\n\n\nCodelibrary(ggpubr)\nggbarplot(data = g,\n          x=\"treatment\",y=\"liverweight\",\n          add = c(\"mean_sd\"),\n          fill = \"treatment\",\n          palette = \"jco\",\n          title = \"DEN+CCl4 tumor\",\n          xlab = \"\",\n          ylab='liver weight (g)',\n          legend='none',\n          )+\n  stat_compare_means(\n      #aes(label='p.format'),\n      comparisons = list(c('CON','LDRT'),c(\"DPVB\",'LR_DPVB'), c(\"CON\",\"LR_DPVB\")),\n      method = 't.test',\n      tip.length = c(0,0,0,0,0,0),\n      bracket.size = 1,linewidth=1)+\n\n  theme(plot.title = element_text(hjust = 0.5),\n        axis.text.x = element_text(angle = 45,vjust = 0.5))+\n  geom_dotplot(data = g,\n               mapping=aes(x=treatment,y=liverweight),\n               binaxis = 'y',stackdir = 'center',binwidth = 0.05)\n\n\n\n\n\n\n\n\n\nCodelibrary(ggsignif)\ng |&gt; \n  summarise(\n    n=n(),\n    mean=mean(liverweight),\n    sd=sd(liverweight),\n    .by=treatment\n  ) |&gt; \n    ggplot(aes(treatment,mean,fill=treatment))+\n    geom_bar(stat = \"identity\",width = .7,position = position_dodge())+#条形图\n    geom_errorbar(aes(ymin=mean-sd,ymax=mean+sd),\n                  width=.2,color=\"black\",linewidth=.8)+#误差棒\n    geom_signif(data = g,\n              mapping=aes(x=treatment,y=liverweight),\n              comparisons = list(c('CON','LDRT'),c(\"DPVB\",'LR_DPVB'),\n                                 c(\"CON\",\"LR_DPVB\")),\n              annotations = c(\"p=0.8639\",\"p=0.0088\",\"p=0.00034\"),\n              map_signif_level=F,\n              tip_length=c(0.0,0.0,0.0,0.0,0.0,0.0),\n              y_position=c(2.1,1.8,2.35),size = .8,\n              textsize = 5,\n              test = \"t.test\"\n              )+\n    theme_pubr()+\n    scale_fill_jco()+\n    scale_y_continuous(limits = c(0,2.5))+\n    labs(\n        x='',\n        y='liver weight (g)',\n        title=\"DEN+CCl4 tumor\"\n    )+\n    theme(\n        plot.title = element_text(hjust =0.5 ),\n        legend.position = 'none',\n        axis.text.x = element_text(angle = 45,vjust = .5)\n    )+  \n    geom_dotplot(data = g,\n                 mapping=aes(x=treatment,y=liverweight),\n                 binaxis = 'y',\n                 stackdir = 'center',#居中\n                 fill='black',\n                 binwidth = 0.05)\n#&gt; Warning in geom_signif(data = g, mapping = aes(x = treatment, y = liverweight),\n#&gt; : You have set data and mapping, are you sure that manual = FALSE is correct?\n\n\n\n\n\n\n\n\nhttps://www.datanovia.com/en/blog/tag/ggpubr/\nhttps://www.datanovia.com/en/blog/how-to-add-p-values-onto-a-grouped-ggplot-using-the-ggpubr-r-package/\n\nCodef2e &lt;- read_excel(\"data/01source.xlsx\", sheet = 3, range = \"A2:M4\")\n#&gt; New names:\n#&gt; • `` -&gt; `...3`\n#&gt; • `` -&gt; `...4`\n#&gt; • `` -&gt; `...6`\n#&gt; • `` -&gt; `...7`\n#&gt; • `` -&gt; `...9`\n#&gt; • `` -&gt; `...10`\n#&gt; • `` -&gt; `...12`\n#&gt; • `` -&gt; `...13`\ncolnames(f2e) &lt;-\n    c(\"type\", rep(c('CON', 'LDRT', 'DPVB', 'LR_DPVB'), each = 3))\n\nf2e |&gt; pivot_longer(cols = -1,\n                    names_to = \"trt\",\n                    values_to = \"pct\",\n) |&gt;\n    mutate(trt = factor(trt, levels = c('CON', 'LDRT', 'DPVB', 'LR_DPVB'))) -&gt; f2e\n\n\n\nCodelibrary(ggpubr)\nlibrary(rstatix)\n conflicts_prefer(rstatix::t_test)\n#&gt; [conflicted] Will prefer rstatix::t_test over any other package.\nstat.test &lt;- f2e %&gt;%\n  group_by(type) %&gt;%\n  t_test(pct ~ trt) |&gt; \n  adjust_pvalue(method = \"bonferroni\") %&gt;%\n    add_significance(\"p.adj\") |&gt; \n    add_significance(\"p\") \n\n\nstat.test &lt;- stat.test %&gt;%\n  add_xy_position(fun = \"mean_sd\", x = \"type\", dodge = 1)|&gt; \n  dplyr::filter(group1==\"CON\"&group2==\"LR_DPVB\")\n\n\ne_left &lt;- ggbarplot(f2e, x = \"type\", y = \"pct\",\n                fill = \"trt\", palette = \"jco\",\n                add =c(\"mean_sd\"), add.params = list(group = \"trt\"),\n                position = position_dodge(1),\n                #legend=\"none\",\n          legend.title=\"\",\n          )+\n    scale_y_continuous(limits = c(0,80))+\n    stat_pvalue_manual(\n        data = stat.test,\n        label = \"p={p}({p.signif})\",\n        tip.length = 0.05,\n        y.position = c(40,75),\n        #bracket.nudge.y = -2,\n)+labs(\n        x='',\n        y='% in live CD45+ cell',\n        #title=\"Hepa1-6 tumor\"\n    )\n\ne_right &lt;- e_left\n\nlibrary(patchwork)\n(e_left + e_right)+\n    plot_annotation(\n        title = \"Hepa1-6 tumor\",\n    ) +\n    plot_layout(guides = \"collect\")& \n    theme(\n        plot.title = element_text(hjust = 0.5),\n        legend.position = \"top\",\n    )\n\n\n\n\n\n\n\n\nhttps://www.datanovia.com/en/blog/how-to-add-p-values-onto-a-grouped-ggplot-using-the-ggpubr-r-package/\n\nCodelibrary(ggpubr)\nlibrary(rstatix)\ndf &lt;- ToothGrowth\ndf$dose &lt;- as.factor(df$dose)\n\n\n\nbp &lt;- ggbarplot(\n    df,\n    x = \"dose\",\n    y = \"len\",\n    add = \"mean_sd\",\n    color = \"supp\",\n    palette = c(\"#00AFBB\", \"#E7B800\"),\n    position = position_dodge(0.8)\n)\n\n\n# 统计检验\nstat.test &lt;- df %&gt;%\n    group_by(dose) %&gt;%\n    t_test(len ~ supp) %&gt;%\n    adjust_pvalue(method = \"bonferroni\") %&gt;%\n    add_significance(\"p.adj\")\nstat.test &lt;- stat.test %&gt;%\n    add_xy_position(fun = \"mean_sd\", x = \"dose\", dodge = 0.8)\n\n\nstat.test2 &lt;- df %&gt;%\n    t_test(len ~ dose, p.adjust.method = \"bonferroni\")\nstat.test2 &lt;- stat.test2 %&gt;%\n    add_xy_position(x = \"dose\")\n\npwc &lt;- df %&gt;%\n    group_by(supp) %&gt;%\n    t_test(len ~ dose, p.adjust.method = \"bonferroni\")\npwc\n#&gt; # A tibble: 6 × 11\n#&gt;   supp  .y.   group1 group2    n1    n2 statistic    df            p      p.adj\n#&gt; * &lt;fct&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;\n#&gt; 1 OJ    len   0.5    1         10    10     -5.05  17.7 0.0000878    0.000263  \n#&gt; 2 OJ    len   0.5    2         10    10     -7.82  14.7 0.00000132   0.00000396\n#&gt; 3 OJ    len   1      2         10    10     -2.25  15.8 0.039        0.118     \n#&gt; 4 VC    len   0.5    1         10    10     -7.46  17.9 0.000000681  0.00000204\n#&gt; 5 VC    len   0.5    2         10    10    -10.4   14.3 0.0000000468 0.00000014\n#&gt; 6 VC    len   1      2         10    10     -5.47  13.6 0.0000916    0.000275  \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\npwc &lt;- pwc %&gt;%\n    add_xy_position(\n        x = \"dose\",\n        fun = \"mean_sd\",\n        group = \"supp\",\n        dodge = 0.8\n    )\n\n# 组间组内复合\n\n\nbp +\n     stat_pvalue_manual(stat.test,  label = \"p.adj.signif\", tip.length = 0.01) \n\n\n\n\n\n\nCode    # stat_pvalue_manual(\n    #     stat.test2,\n    #     label = \"p\",\n    #     tip.length = 0.02,\n    #     step.increase = 0.05,\n    # ) +\n    # scale_y_continuous(expand = expansion(mult = c(0.05, 0.1))) +\n    # stat_pvalue_manual(\n    #     pwc,\n    #     color = \"supp\",\n    #     step.group.by = \"supp\",\n    #     tip.length = 0,\n    #     step.increase = 0.1,\n    # )",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "条形图.html#修改边框和填充颜色",
    "href": "条形图.html#修改边框和填充颜色",
    "title": "\n1 条形图",
    "section": "",
    "text": "Codedf &lt;- ToothGrowth |&gt; rownames_to_column(\"id\")\nggplot(df,aes(dose,len,color=factor(dose)))+\n    geom_col(fill=NA)",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "条形图.html#添加标签",
    "href": "条形图.html#添加标签",
    "title": "\n1 条形图",
    "section": "",
    "text": "Codeggplot(df,aes(id,len))+\n    geom_col()+\n   ggrepel::geom_text_repel(aes(y=len+3,label=len))",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "条形图.html#添加误差棒",
    "href": "条形图.html#添加误差棒",
    "title": "\n1 条形图",
    "section": "",
    "text": "Codedf &lt;- ToothGrowth |&gt; rownames_to_column(\"id\")\nggplot(df, aes(x=supp, y=len, fill = factor(dose)))+\n  stat_summary(fun=\"mean\", geom=\"bar\",position = position_dodge(1))+\n  stat_summary(fun.data=\"mean_sd\", geom=\"errorbar\", width=0.25,position = position_dodge(1))+\n  theme_tufte(base_size=16, base_family=\"sans\", ticks=FALSE)+\n  labs(x=\"Group\", y=\"Values\", caption=\"Error Bars Indicate Standard Error\")",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "条形图.html#添加显著性",
    "href": "条形图.html#添加显著性",
    "title": "\n1 条形图",
    "section": "",
    "text": "Codelibrary(ggsignif)\nggplot(data = PlantGrowth, aes(x = group, y = weight)) +\n  geom_boxplot(width = 0.25) +\n  geom_jitter(width = 0.15) +\n  geom_signif(comparisons = list(c(\"ctrl\", \"trt1\"), c(\"trt1\", \"trt2\")), \n              map_signif_level = function(p) sprintf(\"p = %.3g\", p), \n              textsize = 6, test = \"t.test\") +\n    ylim(c(NA,7))+\n  theme_classic() +\n  coord_cartesian(clip = \"off\")",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "条形图.html#添加散点抖动点",
    "href": "条形图.html#添加散点抖动点",
    "title": "\n1 条形图",
    "section": "",
    "text": "Codeggplot(mpg, aes(x = drv, y = hwy, fill = as.factor(cyl))) +  \n    geom_bar(stat = \"summary\",fun=mean, position = position_dodge(1)) +\n    stat_summary(fun.data = 'mean_sd',geom=\"errorbar\",position = position_dodge(1),\n                 width=.2,linewidth=1)+\n    geom_point(position = position_dodge(1), \n              size = 3,alpha=0.3\n             )  \n\n\n\n\n\n\n\n\nCodedf &lt;- ToothGrowth\nggplot(df, aes(x = supp, y = len)) +\n    geom_bar(\n        aes(fill = factor(dose)),\n        stat = \"summary\",\n        fun = mean,\n        position = position_dodge(width = 0.9)\n    ) +\n    geom_point(position = position_jitterdodge(jitter.width = 0.1),\n               aes(color = factor(dose)),\n               alpha = 0.7)+\n    scale_color_manual(values = c(\"red\",\"green\",\"blue\"))|\n    ggplot(df, aes(x = supp, y = len)) +\n    geom_bar(\n        aes(fill = factor(dose)),\n        stat = \"summary\",\n        fun = mean,\n        position = position_dodge(width = 0.9)\n    ) +\n    geom_dotplot(position = position_dodge(width = 0.9),\n               aes(fill = factor(dose)),dotsize = 0.8,\n               binaxis = \"y\", stackdir = \"center\",color=\"black\",\n               alpha = 0.7)+\n    scale_fill_manual(values = c(\"red\",\"green\",\"blue\"))\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "条形图.html#分组排序条图-waterfall-barplot",
    "href": "条形图.html#分组排序条图-waterfall-barplot",
    "title": "\n1 条形图",
    "section": "",
    "text": "Codelibrary(tidyverse)\nlibrary(ggpubr)\nlibrary(ggsci)\nlibrary(readxl)\nc &lt;- read_excel(\"data/01source.xlsx\",sheet=1,range = \"A2:D16\") |&gt; \n  rename(\n    LR_DPVB=`LR-DPVB`\n  )  |&gt; \n  pivot_longer(\n    cols = CON:LR_DPVB,\n    names_to = \"treatment\",\n    values_to = \"changerate\"\n  ) |&gt; \n  mutate(\n    treatment=factor(treatment,levels=c('CON','LDRT','DPVB','LR_DPVB')),\n    changerate=if_else(changerate&gt;=1,100,changerate*100)\n  ) |&gt; \n  arrange(treatment)|&gt;\n  drop_na() |&gt; \n  mutate(\n    id=1:52\n    ) \n\n\n\nCode\nggplot( c ,aes(x=id,y=changerate,fill=treatment))+ \n  geom_bar(stat = \"identity\",position = \"dodge\",width =0.8)+\n    scale_fill_jco()+\n    scale_y_continuous(name = \"MRI tumor volume change from baseline (%)\",\n                       limits = c(-100,100),\n                       breaks = seq(-100,100,50),\n                       )+\n    theme_pubr()+\n    theme(\n        legend.position = c(0.8,0.8),\n        legend.title = element_blank(),\n        axis.title.x = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.line.x = element_blank(),\n        plot.title = element_text(hjust = 0.5),\n    )+\n    ggtitle(\"Hepa1-6 tumor\")+\n    geom_hline(yintercept = 0,color = \"black\",linetype =1,linewidth=0.8)+\n    geom_hline(yintercept=c(20,-30), colour=\"gray15\", linetype=3,linewidth=0.8)+                # 0 = blank, 1 = solid, 2 = dashed, 3 = dotted, \n            # 4 = dotdash, 5 = longdash, 6 = twodash\n    annotate(geom = \"text\",x=c(2,50),y=c(-30,20),\n             label = c(\"PR:-30%\",\"PD:20%\"),\n             vjust = -0.5,\n             )   \n#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2\n#&gt; 3.5.0.\n#&gt; ℹ Please use the `legend.position.inside` argument of `theme()` instead.\n\n\n\n\n\n\n\n\nCode\nlibrary(ggplot2)\nlibrary(rstatix)\nlibrary(ggpubr)\n# sample data\nplot_df &lt;- ToothGrowth\n\n# Summarize the data\nsummary_df &lt;- plot_df %&gt;%\n  group_by(dose, supp) %&gt;%\n  summarise(\n    Mean = mean(len),\n    SD = sd(len),\n    SE = sd(len) / sqrt(n())  # Standard Error\n  )\n#&gt; `summarise()` has grouped output by 'dose'. You can override using the\n#&gt; `.groups` argument.\n\n# p values for supp between dose\np_sup &lt;- plot_df %&gt;%\n  group_by(supp) %&gt;%\n  t_test(len ~ dose, p.adjust.method = \"fdr\")\n\np_sup &lt;- p_sup %&gt;% \n  add_xy_position(x = \"dose\", group = \"supp\")\n\n# Group the data by dose and then compare the levels of the supps variable\np_dose &lt;- plot_df %&gt;%\n  group_by(dose) %&gt;%\n  t_test(len ~ supp) %&gt;%\n  adjust_pvalue(method = \"fdr\") %&gt;%\n  add_significance(\"p.adj\")\np_dose\n#&gt; # A tibble: 3 × 11\n#&gt;    dose .y.   group1 group2    n1    n2 statistic    df       p   p.adj\n#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;\n#&gt; 1   0.5 len   OJ     VC        10    10    3.17    15.0 0.00636 0.00954\n#&gt; 2   1   len   OJ     VC        10    10    4.03    15.4 0.00104 0.00312\n#&gt; 3   2   len   OJ     VC        10    10   -0.0461  14.0 0.964   0.964  \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\n\n# Add p-values onto the box plots\np_dose &lt;- p_dose %&gt;%\n  add_xy_position(x = \"dose\")\n\n# change dose to character\nsummary_df$dose &lt;- as.character(summary_df$dose)\n\n\n\n\nggplot(summary_df, aes(x = dose, y = Mean, fill = supp)) +\n  geom_bar(stat = \"identity\", color = \"black\", position = position_dodge()) +\n  geom_errorbar(aes(ymin = Mean - SE, ymax = Mean + SE), width = 0.2, position = position_dodge(.9)) +\n  theme_minimal() +\n  scale_fill_manual(\n    values = c(\"#999999\", \"#E69F00\"),\n    aesthetics = c(\"color\", \"fill\")\n  ) +\n  labs(\n    title = \"ToothGrowth\",\n    x = \"dose\",\n    y = \"len ± SE\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  stat_pvalue_manual(\n    p_sup,\n    tip.length = 0.01,\n    hide.ns = F,\n    color = \"supp\"\n  ) +\n  stat_pvalue_manual(\n    p_dose,\n    tip.length = 0.01,\n    hide.ns = F,\n    inherit.aes = FALSE\n  )",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "条形图.html#复杂条图",
    "href": "条形图.html#复杂条图",
    "title": "\n1 条形图",
    "section": "",
    "text": "ggpubr\n\nCodeg&lt;-read_excel(\"data/01source.xlsx\",sheet=1,range=\"G2:Z3\") \n#&gt; New names:\n#&gt; • `` -&gt; `...2`\n#&gt; • `` -&gt; `...3`\n#&gt; • `` -&gt; `...4`\n#&gt; • `` -&gt; `...5`\n#&gt; • `` -&gt; `...7`\n#&gt; • `` -&gt; `...8`\n#&gt; • `` -&gt; `...9`\n#&gt; • `` -&gt; `...10`\n#&gt; • `` -&gt; `...12`\n#&gt; • `` -&gt; `...13`\n#&gt; • `` -&gt; `...14`\n#&gt; • `` -&gt; `...15`\n#&gt; • `` -&gt; `...17`\n#&gt; • `` -&gt; `...18`\n#&gt; • `` -&gt; `...19`\n#&gt; • `` -&gt; `...20`\ncolnames(g) &lt;- rep(c('CON','LDRT','DPVB','LR_DPVB'),each=5)\ng&lt;- g |&gt;  pivot_longer(\n  cols = everything(),\n  names_to = \"treatment\",\n  values_to = \"liverweight\"\n  )|&gt; \n  mutate(\n    treatment=factor(treatment,levels=c('CON','LDRT','DPVB','LR_DPVB'))\n  )\ng\n#&gt; # A tibble: 20 × 2\n#&gt;    treatment liverweight\n#&gt;    &lt;fct&gt;           &lt;dbl&gt;\n#&gt;  1 CON              1.75\n#&gt;  2 CON              1.8 \n#&gt;  3 CON              2.01\n#&gt;  4 CON              1.52\n#&gt;  5 CON              1.63\n#&gt;  6 LDRT             1.73\n#&gt;  7 LDRT             2.05\n#&gt;  8 LDRT             1.48\n#&gt;  9 LDRT             1.66\n#&gt; 10 LDRT             1.68\n#&gt; 11 DPVB             1.2 \n#&gt; 12 DPVB             1.38\n#&gt; 13 DPVB             1.52\n#&gt; 14 DPVB             1.62\n#&gt; 15 DPVB             1.39\n#&gt; 16 LR_DPVB          1.2 \n#&gt; 17 LR_DPVB          1.23\n#&gt; 18 LR_DPVB          1.13\n#&gt; 19 LR_DPVB          1.03\n#&gt; 20 LR_DPVB          0.89\n\n\n\nCodesource(\"function/calculate_t_tests.R\")\ncalculate_t_tests(g,\"treatment\",\"liverweight\")\n#&gt;                  CON         LDRT        DPVB LR_DPVB\n#&gt; CON               NA           NA          NA      NA\n#&gt; LDRT    0.8639404014           NA          NA      NA\n#&gt; DPVB    0.0193695457 0.0359059495          NA      NA\n#&gt; LR_DPVB 0.0003376202 0.0008265681 0.008820249      NA\n\n\n\n\n\n\n\n\nNote\n\n\n\n函数calculate_t_tests\n\nCode# 定义计算两两组之间t检验的函数\ncalculate_t_tests &lt;- function(data, group_by, value_column) {\n  # data: 数据框\n  # group_by: 组别的列名\n  # value_column: 要比较的数值的列名\n  \n  # 提取唯一的组别\n  groups &lt;- unique(data[[group_by]])\n  \n  # 初始化结果矩阵\n  result_matrix &lt;- matrix(NA, nrow = length(groups), ncol = length(groups),\n                          dimnames = list(groups, groups))\n  \n  # 循环遍历所有可能的组合\n  for (i in 1:(length(groups)-1)) {\n    for (j in (i+1):length(groups)) {\n      # 提取两组数据\n      group1_data &lt;- data[data[[group_by]] == groups[i], value_column]\n      group2_data &lt;- data[data[[group_by]] == groups[j], value_column]\n      \n      # 执行t检验\n      t_test_result &lt;- t.test(group1_data, group2_data)\n      \n      # 提取p值\n      p_value &lt;- t_test_result$p.value\n      \n      # 将p值存入结果矩阵\n      #result_matrix[groups[i], groups[j]] &lt;- p_value\n      result_matrix[groups[j], groups[i]] &lt;- p_value\n    }\n  }\n  \n  # 返回结果矩阵\n  return(result_matrix)\n}\n\n\n\n\n\n\nCodelibrary(ggpubr)\nggbarplot(data = g,\n          x=\"treatment\",y=\"liverweight\",\n          add = c(\"mean_sd\"),\n          fill = \"treatment\",\n          palette = \"jco\",\n          title = \"DEN+CCl4 tumor\",\n          xlab = \"\",\n          ylab='liver weight (g)',\n          legend='none',\n          )+\n  stat_compare_means(\n      #aes(label='p.format'),\n      comparisons = list(c('CON','LDRT'),c(\"DPVB\",'LR_DPVB'), c(\"CON\",\"LR_DPVB\")),\n      method = 't.test',\n      tip.length = c(0,0,0,0,0,0),\n      bracket.size = 1,linewidth=1)+\n\n  theme(plot.title = element_text(hjust = 0.5),\n        axis.text.x = element_text(angle = 45,vjust = 0.5))+\n  geom_dotplot(data = g,\n               mapping=aes(x=treatment,y=liverweight),\n               binaxis = 'y',stackdir = 'center',binwidth = 0.05)\n\n\n\n\n\n\n\n\n\nCodelibrary(ggsignif)\ng |&gt; \n  summarise(\n    n=n(),\n    mean=mean(liverweight),\n    sd=sd(liverweight),\n    .by=treatment\n  ) |&gt; \n    ggplot(aes(treatment,mean,fill=treatment))+\n    geom_bar(stat = \"identity\",width = .7,position = position_dodge())+#条形图\n    geom_errorbar(aes(ymin=mean-sd,ymax=mean+sd),\n                  width=.2,color=\"black\",linewidth=.8)+#误差棒\n    geom_signif(data = g,\n              mapping=aes(x=treatment,y=liverweight),\n              comparisons = list(c('CON','LDRT'),c(\"DPVB\",'LR_DPVB'),\n                                 c(\"CON\",\"LR_DPVB\")),\n              annotations = c(\"p=0.8639\",\"p=0.0088\",\"p=0.00034\"),\n              map_signif_level=F,\n              tip_length=c(0.0,0.0,0.0,0.0,0.0,0.0),\n              y_position=c(2.1,1.8,2.35),size = .8,\n              textsize = 5,\n              test = \"t.test\"\n              )+\n    theme_pubr()+\n    scale_fill_jco()+\n    scale_y_continuous(limits = c(0,2.5))+\n    labs(\n        x='',\n        y='liver weight (g)',\n        title=\"DEN+CCl4 tumor\"\n    )+\n    theme(\n        plot.title = element_text(hjust =0.5 ),\n        legend.position = 'none',\n        axis.text.x = element_text(angle = 45,vjust = .5)\n    )+  \n    geom_dotplot(data = g,\n                 mapping=aes(x=treatment,y=liverweight),\n                 binaxis = 'y',\n                 stackdir = 'center',#居中\n                 fill='black',\n                 binwidth = 0.05)\n#&gt; Warning in geom_signif(data = g, mapping = aes(x = treatment, y = liverweight),\n#&gt; : You have set data and mapping, are you sure that manual = FALSE is correct?\n\n\n\n\n\n\n\n\nhttps://www.datanovia.com/en/blog/tag/ggpubr/\nhttps://www.datanovia.com/en/blog/how-to-add-p-values-onto-a-grouped-ggplot-using-the-ggpubr-r-package/\n\nCodef2e &lt;- read_excel(\"data/01source.xlsx\", sheet = 3, range = \"A2:M4\")\n#&gt; New names:\n#&gt; • `` -&gt; `...3`\n#&gt; • `` -&gt; `...4`\n#&gt; • `` -&gt; `...6`\n#&gt; • `` -&gt; `...7`\n#&gt; • `` -&gt; `...9`\n#&gt; • `` -&gt; `...10`\n#&gt; • `` -&gt; `...12`\n#&gt; • `` -&gt; `...13`\ncolnames(f2e) &lt;-\n    c(\"type\", rep(c('CON', 'LDRT', 'DPVB', 'LR_DPVB'), each = 3))\n\nf2e |&gt; pivot_longer(cols = -1,\n                    names_to = \"trt\",\n                    values_to = \"pct\",\n) |&gt;\n    mutate(trt = factor(trt, levels = c('CON', 'LDRT', 'DPVB', 'LR_DPVB'))) -&gt; f2e\n\n\n\nCodelibrary(ggpubr)\nlibrary(rstatix)\n conflicts_prefer(rstatix::t_test)\n#&gt; [conflicted] Will prefer rstatix::t_test over any other package.\nstat.test &lt;- f2e %&gt;%\n  group_by(type) %&gt;%\n  t_test(pct ~ trt) |&gt; \n  adjust_pvalue(method = \"bonferroni\") %&gt;%\n    add_significance(\"p.adj\") |&gt; \n    add_significance(\"p\") \n\n\nstat.test &lt;- stat.test %&gt;%\n  add_xy_position(fun = \"mean_sd\", x = \"type\", dodge = 1)|&gt; \n  dplyr::filter(group1==\"CON\"&group2==\"LR_DPVB\")\n\n\ne_left &lt;- ggbarplot(f2e, x = \"type\", y = \"pct\",\n                fill = \"trt\", palette = \"jco\",\n                add =c(\"mean_sd\"), add.params = list(group = \"trt\"),\n                position = position_dodge(1),\n                #legend=\"none\",\n          legend.title=\"\",\n          )+\n    scale_y_continuous(limits = c(0,80))+\n    stat_pvalue_manual(\n        data = stat.test,\n        label = \"p={p}({p.signif})\",\n        tip.length = 0.05,\n        y.position = c(40,75),\n        #bracket.nudge.y = -2,\n)+labs(\n        x='',\n        y='% in live CD45+ cell',\n        #title=\"Hepa1-6 tumor\"\n    )\n\ne_right &lt;- e_left\n\nlibrary(patchwork)\n(e_left + e_right)+\n    plot_annotation(\n        title = \"Hepa1-6 tumor\",\n    ) +\n    plot_layout(guides = \"collect\")& \n    theme(\n        plot.title = element_text(hjust = 0.5),\n        legend.position = \"top\",\n    )\n\n\n\n\n\n\n\n\nhttps://www.datanovia.com/en/blog/how-to-add-p-values-onto-a-grouped-ggplot-using-the-ggpubr-r-package/\n\nCodelibrary(ggpubr)\nlibrary(rstatix)\ndf &lt;- ToothGrowth\ndf$dose &lt;- as.factor(df$dose)\n\n\n\nbp &lt;- ggbarplot(\n    df,\n    x = \"dose\",\n    y = \"len\",\n    add = \"mean_sd\",\n    color = \"supp\",\n    palette = c(\"#00AFBB\", \"#E7B800\"),\n    position = position_dodge(0.8)\n)\n\n\n# 统计检验\nstat.test &lt;- df %&gt;%\n    group_by(dose) %&gt;%\n    t_test(len ~ supp) %&gt;%\n    adjust_pvalue(method = \"bonferroni\") %&gt;%\n    add_significance(\"p.adj\")\nstat.test &lt;- stat.test %&gt;%\n    add_xy_position(fun = \"mean_sd\", x = \"dose\", dodge = 0.8)\n\n\nstat.test2 &lt;- df %&gt;%\n    t_test(len ~ dose, p.adjust.method = \"bonferroni\")\nstat.test2 &lt;- stat.test2 %&gt;%\n    add_xy_position(x = \"dose\")\n\npwc &lt;- df %&gt;%\n    group_by(supp) %&gt;%\n    t_test(len ~ dose, p.adjust.method = \"bonferroni\")\npwc\n#&gt; # A tibble: 6 × 11\n#&gt;   supp  .y.   group1 group2    n1    n2 statistic    df            p      p.adj\n#&gt; * &lt;fct&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;\n#&gt; 1 OJ    len   0.5    1         10    10     -5.05  17.7 0.0000878    0.000263  \n#&gt; 2 OJ    len   0.5    2         10    10     -7.82  14.7 0.00000132   0.00000396\n#&gt; 3 OJ    len   1      2         10    10     -2.25  15.8 0.039        0.118     \n#&gt; 4 VC    len   0.5    1         10    10     -7.46  17.9 0.000000681  0.00000204\n#&gt; 5 VC    len   0.5    2         10    10    -10.4   14.3 0.0000000468 0.00000014\n#&gt; 6 VC    len   1      2         10    10     -5.47  13.6 0.0000916    0.000275  \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\npwc &lt;- pwc %&gt;%\n    add_xy_position(\n        x = \"dose\",\n        fun = \"mean_sd\",\n        group = \"supp\",\n        dodge = 0.8\n    )\n\n# 组间组内复合\n\n\nbp +\n     stat_pvalue_manual(stat.test,  label = \"p.adj.signif\", tip.length = 0.01) \n\n\n\n\n\n\nCode    # stat_pvalue_manual(\n    #     stat.test2,\n    #     label = \"p\",\n    #     tip.length = 0.02,\n    #     step.increase = 0.05,\n    # ) +\n    # scale_y_continuous(expand = expansion(mult = c(0.05, 0.1))) +\n    # stat_pvalue_manual(\n    #     pwc,\n    #     color = \"supp\",\n    #     step.group.by = \"supp\",\n    #     tip.length = 0,\n    #     step.increase = 0.1,\n    # )",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "条形图"
    ]
  },
  {
    "objectID": "误差棒图.html",
    "href": "误差棒图.html",
    "title": "\n1 误差棒图",
    "section": "",
    "text": "Codecorr_res &lt;- map(mtcars %&gt;% select(-mpg), cor.test, y = mtcars$mpg)\nlibrary(broom)\n\ncorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_point(aes(y = estimate)) + \n    geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = .1) +\n    labs(x = NULL, y = \"Correlation with mpg\")\n\n\n\n\n\n\n\n\n\nCodecorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_point(aes(y = estimate)) + \n    geom_linerange(aes(ymin = conf.low, ymax = conf.high)) +\n    labs(x = NULL, y = \"Correlation with mpg\")\n\n\n\n\n\n\n\n\n\nCodecorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_pointrange(aes(y = estimate, ymin = conf.low, ymax = conf.high)) +\n    labs(x = NULL, y = \"Correlation with mpg\")\n\n\n\n\n\n\n\n\n\nCodecorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_crossbar(aes(y = estimate, ymin = conf.low, ymax = conf.high)) +\n    labs(x = NULL, y = \"Correlation with mpg\")",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "误差棒图"
    ]
  },
  {
    "objectID": "误差棒图.html#errorbar",
    "href": "误差棒图.html#errorbar",
    "title": "\n1 误差棒图",
    "section": "",
    "text": "Codecorr_res &lt;- map(mtcars %&gt;% select(-mpg), cor.test, y = mtcars$mpg)\nlibrary(broom)\n\ncorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_point(aes(y = estimate)) + \n    geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = .1) +\n    labs(x = NULL, y = \"Correlation with mpg\")",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "误差棒图"
    ]
  },
  {
    "objectID": "误差棒图.html#linerange",
    "href": "误差棒图.html#linerange",
    "title": "\n1 误差棒图",
    "section": "",
    "text": "Codecorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_point(aes(y = estimate)) + \n    geom_linerange(aes(ymin = conf.low, ymax = conf.high)) +\n    labs(x = NULL, y = \"Correlation with mpg\")",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "误差棒图"
    ]
  },
  {
    "objectID": "误差棒图.html#pointrange",
    "href": "误差棒图.html#pointrange",
    "title": "\n1 误差棒图",
    "section": "",
    "text": "Codecorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_pointrange(aes(y = estimate, ymin = conf.low, ymax = conf.high)) +\n    labs(x = NULL, y = \"Correlation with mpg\")",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "误差棒图"
    ]
  },
  {
    "objectID": "误差棒图.html#crossbar",
    "href": "误差棒图.html#crossbar",
    "title": "\n1 误差棒图",
    "section": "",
    "text": "Codecorr_res %&gt;% \n    map_dfr(tidy, .id = \"predictor\") %&gt;% \n    ggplot(aes(x = fct_reorder(predictor, estimate))) + \n    geom_crossbar(aes(y = estimate, ymin = conf.low, ymax = conf.high)) +\n    labs(x = NULL, y = \"Correlation with mpg\")",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "误差棒图"
    ]
  },
  {
    "objectID": "箱线图.html",
    "href": "箱线图.html",
    "title": "\n1 箱线图",
    "section": "",
    "text": "1 箱线图\n\nCodelibrary(ggthemes)\n\nboxplot1.df&lt;-data.frame(rnorm(1000))\ncolnames(boxplot1.df)&lt;-\"data\"\nggplot(boxplot1.df, aes(y=data))+\n  geom_boxplot()+\n  theme_tufte(base_size=12, base_family=\"sans\", ticks=FALSE)+\n  labs(x=\"Dataset\", y=\"Values\")+\n  theme(axis.text.x=element_blank(), axis.title.x=element_blank())+\n  annotate(\"text\", x=1.75, y=0, label=\"median\", size=6)+\n  annotate(\"text\", x=c(-1.75, -1.75), y=c(-0.652, 0.667), label=c(\"25th\\npercentile\", \"75th\\npercentile\"), size=6)+\n  annotate(\"text\", x=c(0.8, 0.8), y=c(-2.508464,2.560529), label=c(\"25th percentile\\n- 1.5(IQR)\", \"75th percentile\\n+ 1.5(IQR)\"), size=6, hjust=0)+\n    annotate(\"text\", x=c(0.8, 0.8), y=c(-2.508464,2.560529), label=c(\"25th percentile\\n- 1.5(IQR)\", \"75th percentile\\n+ 1.5(IQR)\"), size=6, hjust=0)+\n  annotate(\"text\", x=c(-0.8, -0.8), y=c(2.973052, -3.03701), label=\"outliers\", size=6, hjust=1)+\n  geom_segment(x=1.2, xend=0.5, y=0, yend=0, arrow=arrow())+\n  geom_segment(x=-1.2, xend=-0.5, y=-0.652, yend=-0.652, arrow=arrow())+\n  geom_segment(x=-1.2, xend=-0.5, y=0.667, yend=0.6667, arrow=arrow())+\n  geom_segment(x=0.76, xend=0.05, y=2.560529, yend=2.560529, arrow=arrow())+\n  geom_segment(x=-0.76, xend=-0.05, y=2.973052, yend=2.973052, arrow=arrow())+\n  geom_segment(x=-0.76, xend=-0.05, y=-3.03701, yend=-3.03701, arrow=arrow())+\n  xlim(-2, 2)\n\n\n\n\n\n\n\n\n\n Back to top"
  },
  {
    "objectID": "生存曲线.html",
    "href": "生存曲线.html",
    "title": "\n1 生存曲线",
    "section": "",
    "text": "Codelibrary(tidyverse)\nlibrary(readxl)\nlibrary(survival)\nlibrary(ggsci)\nlibrary(ggsurvfit)\n\n\n\nCode### 数据 三列 “group”分组列， “time”生存时间列，“status”事件状态列\nd&lt;-read_excel(\"data/01source.xlsx\",sheet=1,range = \"A19:E75\") |&gt; \n    rename(\n        LR_DPVB=`LR-DPVB`\n    )  |&gt; \n    pivot_longer(\n        cols = CON:LR_DPVB,\n        names_to = \"treatment\",\n        values_to = \"status\"\n    ) |&gt; drop_na() |&gt; \n    mutate(\n        treatment=factor(treatment,levels=c('CON','LDRT','DPVB','LR_DPVB'))\n    )\n# 加载包\nd\n#&gt; # A tibble: 56 × 3\n#&gt;     Days treatment status\n#&gt;    &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;\n#&gt;  1    11 CON            1\n#&gt;  2    13 CON            1\n#&gt;  3    14 CON            1\n#&gt;  4    14 CON            1\n#&gt;  5    15 CON            1\n#&gt;  6    17 CON            1\n#&gt;  7    17 CON            1\n#&gt;  8    17 CON            1\n#&gt;  9    20 CON            1\n#&gt; 10    20 CON            1\n#&gt; # ℹ 46 more rows\n# 使用 Kaplan-Meier 方法拟合生存曲线\nkm_fit&lt;-survfit2(Surv(Days,status)~treatment,data=d)\nsummary(km_fit)\n#&gt; Call: survfit(formula = Surv(Days, status) ~ treatment, data = d)\n#&gt; \n#&gt;                 treatment=CON \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    11     14       1   0.9286  0.0688       0.8030        1.000\n#&gt;    13     13       1   0.8571  0.0935       0.6921        1.000\n#&gt;    14     12       2   0.7143  0.1207       0.5129        0.995\n#&gt;    15     10       1   0.6429  0.1281       0.4351        0.950\n#&gt;    17      9       3   0.4286  0.1323       0.2341        0.785\n#&gt;    20      6       2   0.2857  0.1207       0.1248        0.654\n#&gt;    21      4       2   0.1429  0.0935       0.0396        0.515\n#&gt;    25      2       1   0.0714  0.0688       0.0108        0.472\n#&gt;    27      1       1   0.0000     NaN           NA           NA\n#&gt; \n#&gt;                 treatment=LDRT \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    13     14       2   0.8571  0.0935       0.6921        1.000\n#&gt;    15     12       1   0.7857  0.1097       0.5977        1.000\n#&gt;    16     11       1   0.7143  0.1207       0.5129        0.995\n#&gt;    18     10       1   0.6429  0.1281       0.4351        0.950\n#&gt;    19      9       2   0.5000  0.1336       0.2961        0.844\n#&gt;    20      7       3   0.2857  0.1207       0.1248        0.654\n#&gt;    24      4       1   0.2143  0.1097       0.0786        0.584\n#&gt;    25      3       1   0.1429  0.0935       0.0396        0.515\n#&gt;    27      2       1   0.0714  0.0688       0.0108        0.472\n#&gt;    30      1       1   0.0000     NaN           NA           NA\n#&gt; \n#&gt;                 treatment=DPVB \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    20     14       1    0.929  0.0688        0.803        1.000\n#&gt;    23     13       1    0.857  0.0935        0.692        1.000\n#&gt;    27     12       1    0.786  0.1097        0.598        1.000\n#&gt;    28     11       1    0.714  0.1207        0.513        0.995\n#&gt;    30     10       1    0.643  0.1281        0.435        0.950\n#&gt;    32      9       1    0.571  0.1323        0.363        0.899\n#&gt;    38      8       1    0.500  0.1336        0.296        0.844\n#&gt;    39      7       1    0.429  0.1323        0.234        0.785\n#&gt;    45      6       1    0.357  0.1281        0.177        0.721\n#&gt; \n#&gt;                 treatment=LR_DPVB \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    30     14       1    0.929  0.0688        0.803            1\n#&gt;    40     13       1    0.857  0.0935        0.692            1\n\n\n\n\nCodeplot(km_fit,\n     lty = 1,\n     col = c(\"gray\",\"blue\",\"orange3\",\"darkred\"),\n     lwd = 2,\n)\n\n\n\n\n\n\n\n\n\nCode# 使用 ggplot2 和 survminer 绘制生存曲线图\nlibrary(survminer)\np &lt;- ggsurvplot(\n    fit  = km_fit,\n    data = d,\n    fun = \"pct\",  #event',累计死亡比列，'cumhaz':cumulative hazard累计风险\n    \n    palette = \"jco\",\n    linetype = c(1,5,4,6),\n    surv.median.line = 'none',\n    \n    conf.int = F,\n\n    \n    pval = TRUE,# \"log rank p=0.0053\"\n    log.rank.weights='1',  \n    pval.method = TRUE,\n    pval.coord=c(40,75),\n    pval.method.coord=c(32,75),\n    \n    risk.table = \"abs_pct\", # \"nrisk_cumcensor\" and \"nrisk_cumevents\"\n    risk.table.col = \"treatment\",\n    risk.table.height=0.3,\n    tables.theme = theme_cleantable(),\n    ncensor.plot=T,\n  \n    \n    axes.offset=F,  #(0,0)pos\n    title = \"Hepa1-6 tumor\",\n    xlab=\"Days\",\n    ylab=\"Percent survival (%)\",\n    \n    legend.title = \"\",\n    legend = c(0.2,0.35),\n    legend.labs=c('CON','LDRT','DPVB','LR_DPVB'),\n    \n    ggtheme = theme_survminer(),\n)\np\n\n\n\n\n\n\n\n\nCodefit&lt;- survfit(Surv(time, status) ~ sex, data = lung)\n\n# Basic survival curves\nggsurvplot(fit, data = lung)\n\n\n\n\n\n\nCode\n# Customized survival curves\np &lt;- ggsurvplot(fit, data = lung,\n           surv.median.line = \"hv\", # Add medians survival\n           \n           # Change legends: title & labels\n           legend.title = \"Sex\",\n           legend.labs = c(\"Male\", \"Female\"),\n           # Add p-value and tervals\n           pval = TRUE,\n           \n           conf.int = TRUE,\n           # Add risk table\n           risk.table = TRUE,\n           tables.height = 0.2,\n           tables.theme = theme_cleantable(),\n           \n           # Color palettes. Use custom color: c(\"#E7B800\", \"#2E9FDF\"),\n           # or brewer color (e.g.: \"Dark2\"), or ggsci color (e.g.: \"jco\")\n           palette = c(\"#E7B800\", \"#2E9FDF\"),\n           ggtheme = theme_bw() # Change ggplot2 theme\n)\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n\n\n\nCodep &lt;- ggsurvplot(fit, data = lung,\n                surv.median.line = \"hv\", # Add medians survival\n                \n                # Change legends: title & labels\n                legend.title = \"Sex\",\n                legend.labs = c(\"Male\", \"Female\"),\n                # Add p-value and tervals\n                pval = F,    ##不默认显示P\n                conf.int = TRUE,\n                # Add risk table\n                risk.table = TRUE,\n                tables.height = 0.2,\n                tables.theme = theme_cleantable(),\n                \n                # Color palettes. Use custom color: c(\"#E7B800\", \"#2E9FDF\"),\n                # or brewer color (e.g.: \"Dark2\"), or ggsci color (e.g.: \"jco\")\n                palette = c(\"#E7B800\", \"#2E9FDF\"),\n                ggtheme = theme_bw() # Change ggplot2 theme\n)\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n##计算公式\ndata.survdiff &lt;- survdiff(Surv(time, status) ~ sex,data = lung)\np.val = 1 - pchisq(data.survdiff$chisq, length(data.survdiff$n) - 1)\nHR = (data.survdiff$obs[2]/data.survdiff$exp[2])/(data.survdiff$obs[1]/data.survdiff$exp[1])\nup95 = exp(log(HR) + qnorm(0.975)*sqrt(1/data.survdiff$exp[2]+1/data.survdiff$exp[1]))\nlow95 = exp(log(HR) - qnorm(0.975)*sqrt(1/data.survdiff$exp[2]+1/data.survdiff$exp[1]))\nci &lt;- paste0(sprintf(\"%.3f\",HR),\" [\",sprintf(\"%.3f\",low95),\", \",sprintf(\"%.3f\",up95),\"]\")\n\np$plot &lt;- p$plot + \n  annotate(\"text\", x = 0, y = 0.05, \n                            label = paste0(\"P value = \",sprintf(\"%.3f\",p.val),\"\\n HR (95% CI) = \",ci),   ###添加P和HR 95%CI\n                            size = 5, color = \"black\", hjust = 0)+\n  theme(text = element_text(size = 15))\np$plot\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n\n\n\n\n\n\n\n\n\nCodelibrary(ggsurvfit)\nkm_fit\n#&gt; Call: survfit(formula = Surv(Days, status) ~ treatment, data = d)\n#&gt; \n#&gt;                    n events median 0.95LCL 0.95UCL\n#&gt; treatment=CON     14     14   17.0      15      25\n#&gt; treatment=LDRT    14     14   19.5      18      27\n#&gt; treatment=DPVB    14      9   38.5      30      NA\n#&gt; treatment=LR_DPVB 14      2     NA      NA      NA\n\n\nkm_fit |&gt; tidy_survfit() |&gt; \n    ggplot(aes(time,estimate,min=conf.low,ymax=conf.low,\n               color=strata,fill=strata))+\n    scale_color_jco()+\n    geom_step()\n\n\n\n\n\n\nCode\nkm_fit |&gt; ggsurvfit()+\n    add_confidence_interval()+\n    # 添加删失点\n    add_censor_mark()  +\n    add_quantile()+\n    add_pvalue(\"annotation\",size=3,x=5,y=0.25)+\n    #add_pvalue(caption = \"Log-rank {p.value}\")+\n    add_risktable(size = 3,risktable_height = 0.3)+\n    add_legend_title(\"treatment\")",
    "crumbs": [
      "ggplot2 图形",
      "Line",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#kaplan-meier-curve",
    "href": "生存曲线.html#kaplan-meier-curve",
    "title": "\n1 生存曲线",
    "section": "",
    "text": "Codelibrary(tidyverse)\nlibrary(readxl)\nlibrary(survival)\nlibrary(ggsci)\nlibrary(ggsurvfit)\n\n\n\nCode### 数据 三列 “group”分组列， “time”生存时间列，“status”事件状态列\nd&lt;-read_excel(\"data/01source.xlsx\",sheet=1,range = \"A19:E75\") |&gt; \n    rename(\n        LR_DPVB=`LR-DPVB`\n    )  |&gt; \n    pivot_longer(\n        cols = CON:LR_DPVB,\n        names_to = \"treatment\",\n        values_to = \"status\"\n    ) |&gt; drop_na() |&gt; \n    mutate(\n        treatment=factor(treatment,levels=c('CON','LDRT','DPVB','LR_DPVB'))\n    )\n# 加载包\nd\n#&gt; # A tibble: 56 × 3\n#&gt;     Days treatment status\n#&gt;    &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;\n#&gt;  1    11 CON            1\n#&gt;  2    13 CON            1\n#&gt;  3    14 CON            1\n#&gt;  4    14 CON            1\n#&gt;  5    15 CON            1\n#&gt;  6    17 CON            1\n#&gt;  7    17 CON            1\n#&gt;  8    17 CON            1\n#&gt;  9    20 CON            1\n#&gt; 10    20 CON            1\n#&gt; # ℹ 46 more rows\n# 使用 Kaplan-Meier 方法拟合生存曲线\nkm_fit&lt;-survfit2(Surv(Days,status)~treatment,data=d)\nsummary(km_fit)\n#&gt; Call: survfit(formula = Surv(Days, status) ~ treatment, data = d)\n#&gt; \n#&gt;                 treatment=CON \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    11     14       1   0.9286  0.0688       0.8030        1.000\n#&gt;    13     13       1   0.8571  0.0935       0.6921        1.000\n#&gt;    14     12       2   0.7143  0.1207       0.5129        0.995\n#&gt;    15     10       1   0.6429  0.1281       0.4351        0.950\n#&gt;    17      9       3   0.4286  0.1323       0.2341        0.785\n#&gt;    20      6       2   0.2857  0.1207       0.1248        0.654\n#&gt;    21      4       2   0.1429  0.0935       0.0396        0.515\n#&gt;    25      2       1   0.0714  0.0688       0.0108        0.472\n#&gt;    27      1       1   0.0000     NaN           NA           NA\n#&gt; \n#&gt;                 treatment=LDRT \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    13     14       2   0.8571  0.0935       0.6921        1.000\n#&gt;    15     12       1   0.7857  0.1097       0.5977        1.000\n#&gt;    16     11       1   0.7143  0.1207       0.5129        0.995\n#&gt;    18     10       1   0.6429  0.1281       0.4351        0.950\n#&gt;    19      9       2   0.5000  0.1336       0.2961        0.844\n#&gt;    20      7       3   0.2857  0.1207       0.1248        0.654\n#&gt;    24      4       1   0.2143  0.1097       0.0786        0.584\n#&gt;    25      3       1   0.1429  0.0935       0.0396        0.515\n#&gt;    27      2       1   0.0714  0.0688       0.0108        0.472\n#&gt;    30      1       1   0.0000     NaN           NA           NA\n#&gt; \n#&gt;                 treatment=DPVB \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    20     14       1    0.929  0.0688        0.803        1.000\n#&gt;    23     13       1    0.857  0.0935        0.692        1.000\n#&gt;    27     12       1    0.786  0.1097        0.598        1.000\n#&gt;    28     11       1    0.714  0.1207        0.513        0.995\n#&gt;    30     10       1    0.643  0.1281        0.435        0.950\n#&gt;    32      9       1    0.571  0.1323        0.363        0.899\n#&gt;    38      8       1    0.500  0.1336        0.296        0.844\n#&gt;    39      7       1    0.429  0.1323        0.234        0.785\n#&gt;    45      6       1    0.357  0.1281        0.177        0.721\n#&gt; \n#&gt;                 treatment=LR_DPVB \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    30     14       1    0.929  0.0688        0.803            1\n#&gt;    40     13       1    0.857  0.0935        0.692            1",
    "crumbs": [
      "ggplot2 图形",
      "Line",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#plot",
    "href": "生存曲线.html#plot",
    "title": "\n1 生存曲线",
    "section": "",
    "text": "Codeplot(km_fit,\n     lty = 1,\n     col = c(\"gray\",\"blue\",\"orange3\",\"darkred\"),\n     lwd = 2,\n)",
    "crumbs": [
      "ggplot2 图形",
      "Line",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#survminerggsurvplot",
    "href": "生存曲线.html#survminerggsurvplot",
    "title": "\n1 生存曲线",
    "section": "",
    "text": "Code# 使用 ggplot2 和 survminer 绘制生存曲线图\nlibrary(survminer)\np &lt;- ggsurvplot(\n    fit  = km_fit,\n    data = d,\n    fun = \"pct\",  #event',累计死亡比列，'cumhaz':cumulative hazard累计风险\n    \n    palette = \"jco\",\n    linetype = c(1,5,4,6),\n    surv.median.line = 'none',\n    \n    conf.int = F,\n\n    \n    pval = TRUE,# \"log rank p=0.0053\"\n    log.rank.weights='1',  \n    pval.method = TRUE,\n    pval.coord=c(40,75),\n    pval.method.coord=c(32,75),\n    \n    risk.table = \"abs_pct\", # \"nrisk_cumcensor\" and \"nrisk_cumevents\"\n    risk.table.col = \"treatment\",\n    risk.table.height=0.3,\n    tables.theme = theme_cleantable(),\n    ncensor.plot=T,\n  \n    \n    axes.offset=F,  #(0,0)pos\n    title = \"Hepa1-6 tumor\",\n    xlab=\"Days\",\n    ylab=\"Percent survival (%)\",\n    \n    legend.title = \"\",\n    legend = c(0.2,0.35),\n    legend.labs=c('CON','LDRT','DPVB','LR_DPVB'),\n    \n    ggtheme = theme_survminer(),\n)\np\n\n\n\n\n\n\n\n\nCodefit&lt;- survfit(Surv(time, status) ~ sex, data = lung)\n\n# Basic survival curves\nggsurvplot(fit, data = lung)\n\n\n\n\n\n\nCode\n# Customized survival curves\np &lt;- ggsurvplot(fit, data = lung,\n           surv.median.line = \"hv\", # Add medians survival\n           \n           # Change legends: title & labels\n           legend.title = \"Sex\",\n           legend.labs = c(\"Male\", \"Female\"),\n           # Add p-value and tervals\n           pval = TRUE,\n           \n           conf.int = TRUE,\n           # Add risk table\n           risk.table = TRUE,\n           tables.height = 0.2,\n           tables.theme = theme_cleantable(),\n           \n           # Color palettes. Use custom color: c(\"#E7B800\", \"#2E9FDF\"),\n           # or brewer color (e.g.: \"Dark2\"), or ggsci color (e.g.: \"jco\")\n           palette = c(\"#E7B800\", \"#2E9FDF\"),\n           ggtheme = theme_bw() # Change ggplot2 theme\n)\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n\n\n\nCodep &lt;- ggsurvplot(fit, data = lung,\n                surv.median.line = \"hv\", # Add medians survival\n                \n                # Change legends: title & labels\n                legend.title = \"Sex\",\n                legend.labs = c(\"Male\", \"Female\"),\n                # Add p-value and tervals\n                pval = F,    ##不默认显示P\n                conf.int = TRUE,\n                # Add risk table\n                risk.table = TRUE,\n                tables.height = 0.2,\n                tables.theme = theme_cleantable(),\n                \n                # Color palettes. Use custom color: c(\"#E7B800\", \"#2E9FDF\"),\n                # or brewer color (e.g.: \"Dark2\"), or ggsci color (e.g.: \"jco\")\n                palette = c(\"#E7B800\", \"#2E9FDF\"),\n                ggtheme = theme_bw() # Change ggplot2 theme\n)\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n##计算公式\ndata.survdiff &lt;- survdiff(Surv(time, status) ~ sex,data = lung)\np.val = 1 - pchisq(data.survdiff$chisq, length(data.survdiff$n) - 1)\nHR = (data.survdiff$obs[2]/data.survdiff$exp[2])/(data.survdiff$obs[1]/data.survdiff$exp[1])\nup95 = exp(log(HR) + qnorm(0.975)*sqrt(1/data.survdiff$exp[2]+1/data.survdiff$exp[1]))\nlow95 = exp(log(HR) - qnorm(0.975)*sqrt(1/data.survdiff$exp[2]+1/data.survdiff$exp[1]))\nci &lt;- paste0(sprintf(\"%.3f\",HR),\" [\",sprintf(\"%.3f\",low95),\", \",sprintf(\"%.3f\",up95),\"]\")\n\np$plot &lt;- p$plot + \n  annotate(\"text\", x = 0, y = 0.05, \n                            label = paste0(\"P value = \",sprintf(\"%.3f\",p.val),\"\\n HR (95% CI) = \",ci),   ###添加P和HR 95%CI\n                            size = 5, color = \"black\", hjust = 0)+\n  theme(text = element_text(size = 15))\np$plot\n#&gt; Warning in geom_segment(aes(x = 0, y = max(y2), xend = max(x1), yend = max(y2)), : All aesthetics have length 1, but the data has 2 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.",
    "crumbs": [
      "ggplot2 图形",
      "Line",
      "生存曲线"
    ]
  },
  {
    "objectID": "生存曲线.html#ggsurvfit",
    "href": "生存曲线.html#ggsurvfit",
    "title": "\n1 生存曲线",
    "section": "",
    "text": "Codelibrary(ggsurvfit)\nkm_fit\n#&gt; Call: survfit(formula = Surv(Days, status) ~ treatment, data = d)\n#&gt; \n#&gt;                    n events median 0.95LCL 0.95UCL\n#&gt; treatment=CON     14     14   17.0      15      25\n#&gt; treatment=LDRT    14     14   19.5      18      27\n#&gt; treatment=DPVB    14      9   38.5      30      NA\n#&gt; treatment=LR_DPVB 14      2     NA      NA      NA\n\n\nkm_fit |&gt; tidy_survfit() |&gt; \n    ggplot(aes(time,estimate,min=conf.low,ymax=conf.low,\n               color=strata,fill=strata))+\n    scale_color_jco()+\n    geom_step()\n\n\n\n\n\n\nCode\nkm_fit |&gt; ggsurvfit()+\n    add_confidence_interval()+\n    # 添加删失点\n    add_censor_mark()  +\n    add_quantile()+\n    add_pvalue(\"annotation\",size=3,x=5,y=0.25)+\n    #add_pvalue(caption = \"Log-rank {p.value}\")+\n    add_risktable(size = 3,risktable_height = 0.3)+\n    add_legend_title(\"treatment\")",
    "crumbs": [
      "ggplot2 图形",
      "Line",
      "生存曲线"
    ]
  },
  {
    "objectID": "点图.html",
    "href": "点图.html",
    "title": "\n1 点图",
    "section": "",
    "text": "Codelibrary(tidyverse)\nlibrary(ggpubr)\nggplot(mtcars,aes(mpg))+\n    geom_dotplot()\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n\n\n\n\n\n\n\n\nCode# 将数值型变量转换为因子\nToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)\nhead(ToothGrowth)\n#&gt;    len supp dose\n#&gt; 1  4.2   VC  0.5\n#&gt; 2 11.5   VC  0.5\n#&gt; 3  7.3   VC  0.5\n#&gt; 4  5.8   VC  0.5\n#&gt; 5  6.4   VC  0.5\n#&gt; 6 10.0   VC  0.5\nlibrary(ggplot2)\n# 基础点图\np1 &lt;- ggplot(ToothGrowth, aes(x=dose, y=len)) + \n  geom_dotplot(binaxis='y', stackdir='center')\n# 更改点尺寸和堆叠率\np2 &lt;- ggplot(ToothGrowth, aes(x=dose, y=len)) + \n  geom_dotplot(binaxis='y', stackdir='center',\n               stackratio=1.5, dotsize=1.2)\n# 旋转\np3 &lt;- p1 + coord_flip()\n# 选择展示数据\np4 &lt;- p1 + scale_x_discrete(limits=c(\"0.5\", \"2\"))\nggarrange(p1,p2,p3,p4,nrow = 1)\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Warning: Removed 20 rows containing missing values or values outside the scale range\n#&gt; (`stat_bindot()`).\n\n\n\n\n\n\n\n\nCode# 在点图上添加摘要统计信息 stat_summary()\n# 添加平均值和中位数\np5 &lt;- p1 + stat_summary(fun.y=mean, geom=\"point\", shape=18,\n                 size=3, color=\"red\")\n#&gt; Warning: The `fun.y` argument of `stat_summary()` is deprecated as of ggplot2 3.3.0.\n#&gt; ℹ Please use the `fun` argument instead.\n\n# p6&lt;- p1 + stat_summary(fun.y=median, geom=\"point\", shape=18,\n#                  size=3, color=\"red\")\n\n\n\n\nCode\nlibrary(ggpubr)\nlibrary(readxl)\n\n\n\nCode\nf6d &lt;-\n    read_excel(\"data/01source.xlsx\", sheet = \"Fig.6\", range = \"D2:E18\")\nf6d |&gt; pivot_longer(\n    cols = everything(),\n    names_to = \"status\",\n    values_to = \"Ratio\",\n) |&gt; \n    tidyr::drop_na() -&gt;f6d\n\n\n\nCodeggdotplot(f6d,\n          x=\"status\",\n          y=\"Ratio\",\n          add =c(\"mean_sd\"),\n          color = \"status\",\n          fill = \"status\",\n          error.plot = \"errorbar\",\n)+\n    geom_signif(\n        comparisons = list(c(\"relapse\",\"non-relapse\")),\n    )+\n    \n    stat_summary(\n        fun.data = \"mean_sd\",geom = \"pointrange\",width=.3\n    )+\n    ggplot2::annotate(\n        geom=\"segment\",\n        x=0.9,\n        xend=1.1,\n        y=2.42019873,#均值\n    )+\n    ggplot2::annotate(\n        geom=\"segment\",\n        x=1.9,\n        xend=2.1,\n        y=0.789463173,#均值\n    )\n#&gt; Warning in stat_summary(fun.data = \"mean_sd\", geom = \"pointrange\", width =\n#&gt; 0.3): Ignoring unknown parameters: `width`\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.",
    "crumbs": [
      "ggplot2 图形",
      "Point",
      "点图"
    ]
  },
  {
    "objectID": "点图.html#geom_dotplot",
    "href": "点图.html#geom_dotplot",
    "title": "\n1 点图",
    "section": "",
    "text": "Codelibrary(tidyverse)\nlibrary(ggpubr)\nggplot(mtcars,aes(mpg))+\n    geom_dotplot()\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n\n\n\n\n\n\n\n\nCode# 将数值型变量转换为因子\nToothGrowth$dose &lt;- as.factor(ToothGrowth$dose)\nhead(ToothGrowth)\n#&gt;    len supp dose\n#&gt; 1  4.2   VC  0.5\n#&gt; 2 11.5   VC  0.5\n#&gt; 3  7.3   VC  0.5\n#&gt; 4  5.8   VC  0.5\n#&gt; 5  6.4   VC  0.5\n#&gt; 6 10.0   VC  0.5\nlibrary(ggplot2)\n# 基础点图\np1 &lt;- ggplot(ToothGrowth, aes(x=dose, y=len)) + \n  geom_dotplot(binaxis='y', stackdir='center')\n# 更改点尺寸和堆叠率\np2 &lt;- ggplot(ToothGrowth, aes(x=dose, y=len)) + \n  geom_dotplot(binaxis='y', stackdir='center',\n               stackratio=1.5, dotsize=1.2)\n# 旋转\np3 &lt;- p1 + coord_flip()\n# 选择展示数据\np4 &lt;- p1 + scale_x_discrete(limits=c(\"0.5\", \"2\"))\nggarrange(p1,p2,p3,p4,nrow = 1)\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.\n#&gt; Warning: Removed 20 rows containing missing values or values outside the scale range\n#&gt; (`stat_bindot()`).\n\n\n\n\n\n\n\n\nCode# 在点图上添加摘要统计信息 stat_summary()\n# 添加平均值和中位数\np5 &lt;- p1 + stat_summary(fun.y=mean, geom=\"point\", shape=18,\n                 size=3, color=\"red\")\n#&gt; Warning: The `fun.y` argument of `stat_summary()` is deprecated as of ggplot2 3.3.0.\n#&gt; ℹ Please use the `fun` argument instead.\n\n# p6&lt;- p1 + stat_summary(fun.y=median, geom=\"point\", shape=18,\n#                  size=3, color=\"red\")",
    "crumbs": [
      "ggplot2 图形",
      "Point",
      "点图"
    ]
  },
  {
    "objectID": "点图.html#ggdotplot",
    "href": "点图.html#ggdotplot",
    "title": "\n1 点图",
    "section": "",
    "text": "Code\nlibrary(ggpubr)\nlibrary(readxl)\n\n\n\nCode\nf6d &lt;-\n    read_excel(\"data/01source.xlsx\", sheet = \"Fig.6\", range = \"D2:E18\")\nf6d |&gt; pivot_longer(\n    cols = everything(),\n    names_to = \"status\",\n    values_to = \"Ratio\",\n) |&gt; \n    tidyr::drop_na() -&gt;f6d\n\n\n\nCodeggdotplot(f6d,\n          x=\"status\",\n          y=\"Ratio\",\n          add =c(\"mean_sd\"),\n          color = \"status\",\n          fill = \"status\",\n          error.plot = \"errorbar\",\n)+\n    geom_signif(\n        comparisons = list(c(\"relapse\",\"non-relapse\")),\n    )+\n    \n    stat_summary(\n        fun.data = \"mean_sd\",geom = \"pointrange\",width=.3\n    )+\n    ggplot2::annotate(\n        geom=\"segment\",\n        x=0.9,\n        xend=1.1,\n        y=2.42019873,#均值\n    )+\n    ggplot2::annotate(\n        geom=\"segment\",\n        x=1.9,\n        xend=2.1,\n        y=0.789463173,#均值\n    )\n#&gt; Warning in stat_summary(fun.data = \"mean_sd\", geom = \"pointrange\", width =\n#&gt; 0.3): Ignoring unknown parameters: `width`\n#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with\n#&gt; `binwidth`.",
    "crumbs": [
      "ggplot2 图形",
      "Point",
      "点图"
    ]
  },
  {
    "objectID": "圆角条形.html",
    "href": "圆角条形.html",
    "title": "\n1 圆角条形",
    "section": "",
    "text": "1 圆角条形\n\nCodelibrary(ggforce)\n\ndf &lt;- data.frame(trt = c(\"a\", \"b\", \"c\"), outcome = c(2.3, 1.9, 3.2))\n\nwidth &lt;- .9\n\ndf &lt;- df |&gt;\n    mutate(trt = factor(trt)) |&gt;\n    dplyr::reframe(\n        data.frame(\n            x = rep(as.numeric(trt) + width / 2 * c(-1, 1), each = 2), # 指定条形图四个角的坐标\n            outcome = c(c(0, outcome), rev(c(0, outcome)))\n        ),\n        .by = trt\n    )\ndf\n#&gt;    trt    x outcome\n#&gt; 1    a 0.55     0.0\n#&gt; 2    a 0.55     2.3\n#&gt; 3    a 1.45     2.3\n#&gt; 4    a 1.45     0.0\n#&gt; 5    b 1.55     0.0\n#&gt; 6    b 1.55     1.9\n#&gt; 7    b 2.45     1.9\n#&gt; 8    b 2.45     0.0\n#&gt; 9    c 2.55     0.0\n#&gt; 10   c 2.55     3.2\n#&gt; 11   c 3.45     3.2\n#&gt; 12   c 3.45     0.0\n\nggplot(df, aes(x, outcome, fill = trt)) +\n    geom_shape(radius = .05) \n\n\n\n\n\n\n\n\n\n Back to top",
    "crumbs": [
      "ggplot2 图形",
      "Bin",
      "圆角条形"
    ]
  },
  {
    "objectID": "森林图.html",
    "href": "森林图.html",
    "title": "\n1 森林图",
    "section": "",
    "text": "什么是森林图\nhttps://github.com/gforge/forestplot\nggforestplot\nhttps://github.com/adayim/forestploter\n\n\nCodelibrary(survival)\nlibrary(survminer)\n#&gt; Loading required package: ggpubr\nmodel &lt;- coxph( Surv(time, status) ~ sex + rx + adhere,\n                data = colon )\nggforest(model, data = colon)\n\n\n\n\n\n\nCode\n\ncolon &lt;- within(colon, {\n  sex &lt;- factor(sex, labels = c(\"female\", \"male\"))\n  differ &lt;- factor(differ, labels = c(\"well\", \"moderate\", \"poor\"))\n  extent &lt;- factor(extent, labels = c(\"submuc.\", \"muscle\", \"serosa\", \"contig.\"))\n})\nbigmodel &lt;-\n  coxph(Surv(time, status) ~ sex + rx + adhere + differ + extent + node4,\n    data = colon )\nggforest(bigmodel)\n#&gt; Warning in .get_data(model, data = data): The `data` argument is not provided.\n#&gt; Data will be extracted from model fit.\n\n\n\n\n\n\n\n\n\nCodelibrary(grid)\nlibrary(forestploter)\n\ndt &lt;- read.csv(system.file(\"extdata\", \"example_data.csv\", package = \"forestploter\"))\n\n# Indent the subgroup if there is a number in the placebo column\ndt$Subgroup &lt;- ifelse(is.na(dt$Placebo), \n                      dt$Subgroup,\n                      paste0(\"   \", dt$Subgroup))\n\n# NA to blank\ndt$Treatment &lt;- ifelse(is.na(dt$Treatment), \"\", dt$Treatment)\ndt$Placebo &lt;- ifelse(is.na(dt$Placebo), \"\", dt$Placebo)\ndt$se &lt;- (log(dt$hi) - log(dt$est))/1.96\n\n# Add a blank column for the forest plot to display CI.\n# Adjust the column width with space. \ndt$` ` &lt;- paste(rep(\" \", 20), collapse = \" \")\n\n# Create confidence interval column to display\ndt$`HR (95% CI)` &lt;- ifelse(is.na(dt$se), \"\",\n                             sprintf(\"%.2f (%.2f to %.2f)\",\n                                     dt$est, dt$low, dt$hi))\n\n# Define theme\ntm &lt;- forest_theme(base_size = 10,\n                   refline_col = \"red\",\n                   arrow_type = \"closed\",\n                   footnote_gp = gpar(col = \"blue\", cex = 0.6))\n#&gt; refline_col will be deprecated, use refline_gp instead.\n\np &lt;- forest(dt[,c(1:3, 20:21)],\n            est = dt$est,\n            lower = dt$low, \n            upper = dt$hi,\n            sizes = dt$se,\n            ci_column = 4,\n            ref_line = 1,\n            arrow_lab = c(\"Placebo Better\", \"Treatment Better\"),\n            xlim = c(0, 4),\n            ticks_at = c(0.5, 1, 2, 3),\n            footnote = \"This is the demo data. Please feel free to change\\nanything you want.\",\n            theme = tm)\n\n# Print plot\nplot(p)\n\n\n\n\n\n\n\n\nCode# Edit text in row 3\ng &lt;- edit_plot(p, row = 3, gp = gpar(col = \"red\", fontface = \"italic\"))\n\n# Bold grouping text\ng &lt;- edit_plot(g,\n               row = c(2, 5, 8, 11, 15, 18),\n               gp = gpar(fontface = \"bold\"))\n\n# Insert text at the top\ng &lt;- insert_text(g,\n                 text = \"Treatment group\",\n                 col = 2:3,\n                 part = \"header\",\n                 gp = gpar(fontface = \"bold\"))\n\n# Add underline at the bottom of the header\ng &lt;- add_border(g, part = \"header\", row = 1, where = \"top\")\ng &lt;- add_border(g, part = \"header\", row = 2, where = \"bottom\")\ng &lt;- add_border(g, part = \"header\", row = 1, col = 2:3, \n                gp = gpar(lwd = 2))\n\n# Edit the background of row 5\ng &lt;- edit_plot(g, row = 5, which = \"background\",\n               gp = gpar(fill = \"darkolivegreen1\"))\n\n# Insert text\ng &lt;- insert_text(g,\n                 text = \"This is a long text. Age and gender summarised above.\\nBMI is next\",\n                 row = 10,\n                 just = \"left\",\n                 gp = gpar(cex = 0.6, col = \"green\", fontface = \"italic\"))\ng &lt;- add_border(g, row = 10, col = 1:3, where = \"top\")\nplot(g)\n\n\n\n\n\n\n\n\n\nCode\n# Add a blank column for the second CI column\ndt$`   ` &lt;- paste(rep(\" \", 20), collapse = \" \")\n\n# Set-up theme\ntm &lt;- forest_theme(base_size = 10,\n                   refline_col = \"red\",\n                   footnote_gp = gpar(col = \"blue\"),\n                   legend_name = \"GP\",\n                   legend_value = c(\"Trt 1\", \"Trt 2\"))\n#&gt; refline_col will be deprecated, use refline_gp instead.\n\np &lt;- forest(dt[,c(1:2, 20, 3, 22)],\n            est = list(dt$est_gp1,\n                       dt$est_gp2,\n                       dt$est_gp3,\n                       dt$est_gp4),\n            lower = list(dt$low_gp1,\n                         dt$low_gp2,\n                         dt$low_gp3,\n                         dt$low_gp4), \n            upper = list(dt$hi_gp1,\n                         dt$hi_gp2,\n                         dt$hi_gp3,\n                         dt$hi_gp4),\n            ci_column = c(3, 5),\n            ref_line = 1,\n            arrow_lab = c(\"Placebo Better\", \"Treatment Better\"),\n            nudge_y = 0.2,\n            x_trans = \"log\",\n            theme = tm)\n\nplot(p)",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "森林图"
    ]
  },
  {
    "objectID": "森林图.html#ggforest",
    "href": "森林图.html#ggforest",
    "title": "\n1 森林图",
    "section": "",
    "text": "Codelibrary(survival)\nlibrary(survminer)\n#&gt; Loading required package: ggpubr\nmodel &lt;- coxph( Surv(time, status) ~ sex + rx + adhere,\n                data = colon )\nggforest(model, data = colon)\n\n\n\n\n\n\nCode\n\ncolon &lt;- within(colon, {\n  sex &lt;- factor(sex, labels = c(\"female\", \"male\"))\n  differ &lt;- factor(differ, labels = c(\"well\", \"moderate\", \"poor\"))\n  extent &lt;- factor(extent, labels = c(\"submuc.\", \"muscle\", \"serosa\", \"contig.\"))\n})\nbigmodel &lt;-\n  coxph(Surv(time, status) ~ sex + rx + adhere + differ + extent + node4,\n    data = colon )\nggforest(bigmodel)\n#&gt; Warning in .get_data(model, data = data): The `data` argument is not provided.\n#&gt; Data will be extracted from model fit.",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "森林图"
    ]
  },
  {
    "objectID": "森林图.html#forestploter",
    "href": "森林图.html#forestploter",
    "title": "\n1 森林图",
    "section": "",
    "text": "Codelibrary(grid)\nlibrary(forestploter)\n\ndt &lt;- read.csv(system.file(\"extdata\", \"example_data.csv\", package = \"forestploter\"))\n\n# Indent the subgroup if there is a number in the placebo column\ndt$Subgroup &lt;- ifelse(is.na(dt$Placebo), \n                      dt$Subgroup,\n                      paste0(\"   \", dt$Subgroup))\n\n# NA to blank\ndt$Treatment &lt;- ifelse(is.na(dt$Treatment), \"\", dt$Treatment)\ndt$Placebo &lt;- ifelse(is.na(dt$Placebo), \"\", dt$Placebo)\ndt$se &lt;- (log(dt$hi) - log(dt$est))/1.96\n\n# Add a blank column for the forest plot to display CI.\n# Adjust the column width with space. \ndt$` ` &lt;- paste(rep(\" \", 20), collapse = \" \")\n\n# Create confidence interval column to display\ndt$`HR (95% CI)` &lt;- ifelse(is.na(dt$se), \"\",\n                             sprintf(\"%.2f (%.2f to %.2f)\",\n                                     dt$est, dt$low, dt$hi))\n\n# Define theme\ntm &lt;- forest_theme(base_size = 10,\n                   refline_col = \"red\",\n                   arrow_type = \"closed\",\n                   footnote_gp = gpar(col = \"blue\", cex = 0.6))\n#&gt; refline_col will be deprecated, use refline_gp instead.\n\np &lt;- forest(dt[,c(1:3, 20:21)],\n            est = dt$est,\n            lower = dt$low, \n            upper = dt$hi,\n            sizes = dt$se,\n            ci_column = 4,\n            ref_line = 1,\n            arrow_lab = c(\"Placebo Better\", \"Treatment Better\"),\n            xlim = c(0, 4),\n            ticks_at = c(0.5, 1, 2, 3),\n            footnote = \"This is the demo data. Please feel free to change\\nanything you want.\",\n            theme = tm)\n\n# Print plot\nplot(p)\n\n\n\n\n\n\n\n\nCode# Edit text in row 3\ng &lt;- edit_plot(p, row = 3, gp = gpar(col = \"red\", fontface = \"italic\"))\n\n# Bold grouping text\ng &lt;- edit_plot(g,\n               row = c(2, 5, 8, 11, 15, 18),\n               gp = gpar(fontface = \"bold\"))\n\n# Insert text at the top\ng &lt;- insert_text(g,\n                 text = \"Treatment group\",\n                 col = 2:3,\n                 part = \"header\",\n                 gp = gpar(fontface = \"bold\"))\n\n# Add underline at the bottom of the header\ng &lt;- add_border(g, part = \"header\", row = 1, where = \"top\")\ng &lt;- add_border(g, part = \"header\", row = 2, where = \"bottom\")\ng &lt;- add_border(g, part = \"header\", row = 1, col = 2:3, \n                gp = gpar(lwd = 2))\n\n# Edit the background of row 5\ng &lt;- edit_plot(g, row = 5, which = \"background\",\n               gp = gpar(fill = \"darkolivegreen1\"))\n\n# Insert text\ng &lt;- insert_text(g,\n                 text = \"This is a long text. Age and gender summarised above.\\nBMI is next\",\n                 row = 10,\n                 just = \"left\",\n                 gp = gpar(cex = 0.6, col = \"green\", fontface = \"italic\"))\ng &lt;- add_border(g, row = 10, col = 1:3, where = \"top\")\nplot(g)",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "森林图"
    ]
  },
  {
    "objectID": "森林图.html#section",
    "href": "森林图.html#section",
    "title": "\n1 森林图",
    "section": "",
    "text": "Code\n# Add a blank column for the second CI column\ndt$`   ` &lt;- paste(rep(\" \", 20), collapse = \" \")\n\n# Set-up theme\ntm &lt;- forest_theme(base_size = 10,\n                   refline_col = \"red\",\n                   footnote_gp = gpar(col = \"blue\"),\n                   legend_name = \"GP\",\n                   legend_value = c(\"Trt 1\", \"Trt 2\"))\n#&gt; refline_col will be deprecated, use refline_gp instead.\n\np &lt;- forest(dt[,c(1:2, 20, 3, 22)],\n            est = list(dt$est_gp1,\n                       dt$est_gp2,\n                       dt$est_gp3,\n                       dt$est_gp4),\n            lower = list(dt$low_gp1,\n                         dt$low_gp2,\n                         dt$low_gp3,\n                         dt$low_gp4), \n            upper = list(dt$hi_gp1,\n                         dt$hi_gp2,\n                         dt$hi_gp3,\n                         dt$hi_gp4),\n            ci_column = c(3, 5),\n            ref_line = 1,\n            arrow_lab = c(\"Placebo Better\", \"Treatment Better\"),\n            nudge_y = 0.2,\n            x_trans = \"log\",\n            theme = tm)\n\nplot(p)",
    "crumbs": [
      "ggplot2 图形",
      "Uncertainty",
      "森林图"
    ]
  },
  {
    "objectID": "热图.html",
    "href": "热图.html",
    "title": "\n1 热图",
    "section": "",
    "text": "Codelibrary(pheatmap)\n\n\n\nCode# read test matrix\ntest &lt;- read.delim(\"data/heatmap/heatmap.txt\",header = T,row.names = 1,sep = \"\\t\")\ntest\n#&gt;             Sample1     Sample2      Sample3      Sample4     Sample5\n#&gt; Gene1   1.276788667  1.39970122  1.072416992  0.880483730  0.82856234\n#&gt; Gene2   0.019548561  0.02705895  0.014687243  0.044248741  0.05737813\n#&gt; Gene3   2.395132841  3.07937035  2.256007527  2.415867713  2.48658672\n#&gt; Gene4   0.083182670  0.14317924  0.156855571  0.083322439  0.17252389\n#&gt; Gene5   0.027406019  0.01016765  0.020571287  0.049950368  0.07319428\n#&gt; Gene6   0.015444824  0.01451434  0.013529512  0.008938481  0.02281410\n#&gt; Gene7   0.027244791  0.06197748  0.083861020  0.752735813  0.66726281\n#&gt; Gene8   0.502507993  0.42464105  0.470344575  0.533677126  0.32546274\n#&gt; Gene9   0.854770698  1.01076161  0.831606319  1.207970172  0.92257052\n#&gt; Gene10  2.366194466  2.13447866  1.956382548  0.962606527  1.31203300\n#&gt; Gene11  2.155082130  1.98799347  1.788864352  3.616962038  3.06590887\n#&gt; Gene12  0.129310440  0.09191911  0.104282037  0.243862580  0.24021022\n#&gt; Gene13  0.605845552  0.58849974  0.574435835  0.432609433  0.33815736\n#&gt; Gene14  2.281032962  1.72559272  2.367729880  1.788446640  1.90978813\n#&gt; Gene15  1.098679859  1.12561208  1.114335742  0.721540287  0.62703942\n#&gt; Gene16  3.768603241  3.83448142  3.487697474  3.731478791  3.29533360\n#&gt; Gene17  0.203230074  0.05219244  0.014276941  0.032323746  0.01202423\n#&gt; Gene18  2.152050491  1.85644729  3.813717676  0.640071180  0.54325715\n#&gt; Gene19  0.516357072  0.31591833  0.276653295  0.366272032  0.54603307\n#&gt; Gene20  2.280619557  2.36036186  2.589737224  4.425116212  4.39044996\n#&gt; Gene21  6.825873663  6.68907517  7.000483477  5.783822390  5.86881864\n#&gt; Gene22  0.444148936  0.52574211  0.603483647  0.382820066  0.48857265\n#&gt; Gene23  6.425283872  5.84820317  7.471677403  4.017770676  4.56303969\n#&gt; Gene24  7.981617242  5.09157053  8.114701616 11.528060240 13.19384251\n#&gt; Gene25  6.000165362  5.96854511  5.584680317  4.962957583  4.91216906\n#&gt; Gene26  3.106879065  4.39925858  2.880084674  1.836868100  1.81948848\n#&gt; Gene27  0.974603131  1.10357706  1.088201858  1.090548131  0.80487377\n#&gt; Gene28  0.090236743  0.04519600  0.045398476  0.109017286  0.06329643\n#&gt; Gene29  1.505897916  1.21549506  1.164930941  1.094930273  1.07443412\n#&gt; Gene30  0.418214640  0.48694221  0.696402671  2.029101298  1.40913530\n#&gt; Gene31 12.094173740  6.11129554  5.846019156  1.705766996  2.03015108\n#&gt; Gene32 14.755815240 14.35665477 14.220752920 13.041109820 13.04242876\n#&gt; Gene33  8.567688237  8.45699505  8.462020933  6.893400155  6.32240155\n#&gt; Gene34 28.143258740 29.04805378 27.188386100 21.545128800 20.25762280\n#&gt; Gene35 10.272571930 14.51711069 13.670634660 15.391971720 13.49886440\n#&gt; Gene36  1.230432146  1.33515921  1.281579532  0.975571373  0.85519141\n#&gt; Gene37  2.105335685  2.12880737  2.290242914  2.313335270  2.16477765\n#&gt; Gene38 79.213978610 81.18377735 77.198186310 81.823794310 79.83893089\n#&gt; Gene39  8.132510197  7.49287631  6.970690849  8.731115630  7.74492270\n#&gt; Gene40  0.753541506  0.83845132  1.001006155  0.997615243  0.60000439\n#&gt; Gene41  0.325474038  0.30016322  0.350076442  0.200246949  0.21014691\n#&gt; Gene42  0.797210892  1.09573409  0.763174744  0.803602557  0.35076420\n#&gt; Gene43  0.574330283  0.68311340  0.591644997  0.388098005  0.32650509\n#&gt; Gene44 14.185315840 14.51019448 14.120137460 10.248523150  9.98540723\n#&gt; Gene45  0.265364899  0.17134202  0.109452626  0.281498160  0.48228569\n#&gt; Gene46 10.906735750 11.40647910 11.379215720 10.631052680 10.69211442\n#&gt; Gene47  5.665169221  5.94489169  5.530583178  5.948818516  5.76601091\n#&gt; Gene48  2.109194135  2.17929565  2.348260137  2.454241720  2.34274366\n#&gt; Gene49  0.004976574  0.00442388  0.006059272  0.025406740  0.03158951\n#&gt; Gene50  0.578367876  0.88617313  0.713324361  0.222133450  0.18598655\n#&gt;            Sample6\n#&gt; Gene1   0.69472331\n#&gt; Gene2   0.05942839\n#&gt; Gene3   2.43571945\n#&gt; Gene4   0.06852347\n#&gt; Gene5   0.06896061\n#&gt; Gene6   0.01208279\n#&gt; Gene7   0.69213029\n#&gt; Gene8   0.48171690\n#&gt; Gene9   1.06054591\n#&gt; Gene10  1.32278532\n#&gt; Gene11  3.51641291\n#&gt; Gene12  0.30601099\n#&gt; Gene13  0.41972532\n#&gt; Gene14  1.63142375\n#&gt; Gene15  0.66917172\n#&gt; Gene16  3.27913994\n#&gt; Gene17  0.01399543\n#&gt; Gene18  0.86020629\n#&gt; Gene19  0.58455431\n#&gt; Gene20  4.81441537\n#&gt; Gene21  5.68732288\n#&gt; Gene22  0.47799947\n#&gt; Gene23  5.39830421\n#&gt; Gene24 11.26897438\n#&gt; Gene25  5.28402767\n#&gt; Gene26  2.04171782\n#&gt; Gene27  1.04176371\n#&gt; Gene28  0.03033377\n#&gt; Gene29  1.21975286\n#&gt; Gene30  2.41736177\n#&gt; Gene31  1.87294193\n#&gt; Gene32 13.67646890\n#&gt; Gene33  5.82982434\n#&gt; Gene34 20.53076632\n#&gt; Gene35 12.53599826\n#&gt; Gene36  0.86309763\n#&gt; Gene37  2.43503104\n#&gt; Gene38 76.55265785\n#&gt; Gene39  7.53249882\n#&gt; Gene40  0.95383044\n#&gt; Gene41  0.09595213\n#&gt; Gene42  0.81975056\n#&gt; Gene43  0.43375747\n#&gt; Gene44 10.42543915\n#&gt; Gene45  0.38292966\n#&gt; Gene46 10.73717544\n#&gt; Gene47  5.88971626\n#&gt; Gene48  2.41323130\n#&gt; Gene49  0.06582145\n#&gt; Gene50  0.27235908\n\nsample_group &lt;- read.delim(\"data/heatmap/sample.class.txt\",header = T,row.names = 1,sep = \"\\t\")\ngene_group &lt;- read.delim(\"data/heatmap/gene.class.txt\",header = T,row.names = 1,sep = \"\\t\")\n\n\n\nCodepheatmap(test,\n         annotation_legend = T,#legend_breaks = seq(-1,1,0.2), legend_labels = seq(-1,1,0.2),\n         show_rownames = T,show_colnames = T,\n         fontsize = 12,\n         color = colorRampPalette(c(\"#0000ff\",\"#ffffff\",\"#ff0000\"))(200),\n         border_color = NA,\n         scale = \"row\",       # 归一化\n         cluster_rows = T,cluster_cols = T,clustering_distance_rows = \"correlation\",\n         display_numbers = TRUE, number_format = \"%.1e\",\n         \n \n         \n         treeheight_row = 12,\n         treeheight_col = 12,\n         \n         annotation_row = gene_group,annotation_col = sample_group,\n         )\n#&gt; Warning: The input is a data frame, convert it to the matrix.\n\n\n\n\n\n\n\n\nCodelibrary(\"Hiiragi2013\")\ndata(\"x\")\ndim(Biobase::exprs(x))\n#&gt; [1] 45101   101\n\ndfx = as.data.frame(Biobase::exprs(x))\ngroups = group_by(pData(x), sampleGroup) |&gt;\n  summarise(n = n(), color = unique(sampleColour))\ngroups\n#&gt; # A tibble: 8 × 3\n#&gt;   sampleGroup         n color  \n#&gt;   &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;  \n#&gt; 1 E3.25              36 #CAB2D6\n#&gt; 2 E3.25 (FGF4-KO)    17 #FDBF6F\n#&gt; 3 E3.5 (EPI)         11 #A6CEE3\n#&gt; 4 E3.5 (FGF4-KO)      8 #FF7F00\n#&gt; 5 E3.5 (PE)          11 #B2DF8A\n#&gt; 6 E4.5 (EPI)          4 #1F78B4\n#&gt; 7 E4.5 (FGF4-KO)     10 #E31A1C\n#&gt; 8 E4.5 (PE)           4 #33A02C\ngroupColor = setNames(groups$color, groups$sampleGroup)\ntopGenes = order(rowVars(Biobase::exprs(x)), decreasing = TRUE)[1:500]\nrowCenter = function(x) { x - rowMeans(x) }\npheatmap::pheatmap(rowCenter(dfx[topGenes, ]), \n  show_rownames = FALSE, \n  show_colnames = FALSE, \n  breaks = seq(-5, +5, length = 101),\n  annotation_col = pData(x)[, c(\"sampleGroup\", \"Embryonic.day\", \"ScanDate\", \"genotype\") ],\n  annotation_colors = list(\n    sampleGroup = groupColor,\n    genotype = c(`FGF4-KO` = \"chocolate1\", `WT` = \"azure2\"),\n    Embryonic.day = setNames(brewer.pal(9, \"Blues\")[c(3, 6, 9)], c(\"E3.25\", \"E3.5\", \"E4.5\")),\n    ScanDate = setNames(brewer.pal(nlevels(x$ScanDate), \"YlGn\"), levels(x$ScanDate))\n  )\n)\n\n\n\n\n\n\n\n\n\nCoder &lt;- cor(test,method = \"pearson\",use = \"pairwise.complete.obs\")\n\nr\n#&gt;           Sample1   Sample2   Sample3   Sample4   Sample5   Sample6\n#&gt; Sample1 1.0000000 0.9952840 0.9957627 0.9830767 0.9830091 0.9851351\n#&gt; Sample2 0.9952840 1.0000000 0.9983278 0.9887180 0.9865182 0.9891590\n#&gt; Sample3 0.9957627 0.9983278 1.0000000 0.9902566 0.9893629 0.9915575\n#&gt; Sample4 0.9830767 0.9887180 0.9902566 1.0000000 0.9992817 0.9990420\n#&gt; Sample5 0.9830091 0.9865182 0.9893629 0.9992817 1.0000000 0.9993162\n#&gt; Sample6 0.9851351 0.9891590 0.9915575 0.9990420 0.9993162 1.0000000\n\npheatmap::pheatmap(r,fontsize = 12,\n         color = colorRampPalette(c(\"#0000ff\",\"#ffffff\",\"#ff0000\"))(200),)\n\n\n\n\n\n\n\n\nCodepheatmap::pheatmap(test, kmeans_k = 2,\n                 cellwidth = 30,cellheight = 25,)\n\n\n\n\n\n\n\n\nCode# Show text within cells\npheatmap::pheatmap(test, display_numbers = TRUE)\n\n\n\n\n\n\nCodepheatmap::pheatmap(test, display_numbers = matrix(ifelse(test &gt; 5, \"*\", \"\"), nrow(test)))\n\n\n\n\n\n\n\n\n\nCode# 设置随机数种子以确保结果的可重复性  \nset.seed(10)  \n  \n# 生成随机数据集  \nmydata &lt;- tibble(  \n  year = 2000:2024,  \n  lung = runif(25),  \n  liver = runif(25), \n  bone = runif(25),  \n  luk = runif(25),  \n  eso = runif(25),  \n  gas = runif(25),   \n  eye = runif(25),  \n  brain = runif(25),  \n  pan = runif(25),  \n  kidney = runif(25),  \n  breast= runif(25),  \n)  |&gt; pivot_longer(cols = -1,\n                   names_to = \"cancer\",\n                   values_to = \"morbidity\")\n\nggplot(mydata, aes(year, cancer)) +  \n  geom_tile(aes(fill =morbidity)) +  \n  scale_fill_gradient(low = \"white\", high = \"red\")\n\n\n\n\n\n\n\n\nhttps://jokergoo.github.io/ComplexHeatmap-reference/book/\n\nCodeif(!require(ComplexHeatmap)) BiocManager::install(\"ComplexHeatmap\")\n\n\n\nCodeset.seed(123)\nnr1 = 4; nr2 = 8; nr3 = 6; nr = nr1 + nr2 + nr3\nnc1 = 6; nc2 = 8; nc3 = 10; nc = nc1 + nc2 + nc3\nmat = cbind(rbind(matrix(rnorm(nr1*nc1, mean = 1,   sd = 0.5), nrow  = nr1),\n          matrix(rnorm(nr2*nc1, mean = 0,   sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc1, mean = 0,   sd = 0.5), nrow = nr3)),\n    rbind(matrix(rnorm(nr1*nc2, mean = 0,   sd = 0.5), nrow = nr1),\n          matrix(rnorm(nr2*nc2, mean = 1,   sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc2, mean = 0,   sd = 0.5), nrow = nr3)),\n    rbind(matrix(rnorm(nr1*nc3, mean = 0.5, sd = 0.5), nrow = nr1),\n          matrix(rnorm(nr2*nc3, mean = 0.5, sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc3, mean = 1,   sd = 0.5), nrow = nr3))\n   )\nmat = mat[sample(nr, nr), sample(nc, nc)] # random shuffle rows and columns\nrownames(mat) = paste0(\"row\", seq_len(nr))\ncolnames(mat) = paste0(\"column\", seq_len(nc))\n\n\n\nCodeHeatmap(mat)\n\n\n\n\n\n\n\n\nCodeset.seed(123)\nmat = matrix(rnorm(100), 10)\nrownames(mat) = paste0(\"R\", 1:10)\ncolnames(mat) = paste0(\"C\", 1:10)\ncolumn_ha = HeatmapAnnotation(foo1 = runif(10), bar1 = anno_barplot(runif(10)))\nrow_ha = rowAnnotation(foo2 = runif(10), bar2 = anno_barplot(runif(10)))\nHeatmap(mat, name = \"mat\", top_annotation = column_ha, right_annotation = row_ha)",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "热图"
    ]
  },
  {
    "objectID": "热图.html#pheatmap",
    "href": "热图.html#pheatmap",
    "title": "\n1 热图",
    "section": "",
    "text": "Codelibrary(pheatmap)\n\n\n\nCode# read test matrix\ntest &lt;- read.delim(\"data/heatmap/heatmap.txt\",header = T,row.names = 1,sep = \"\\t\")\ntest\n#&gt;             Sample1     Sample2      Sample3      Sample4     Sample5\n#&gt; Gene1   1.276788667  1.39970122  1.072416992  0.880483730  0.82856234\n#&gt; Gene2   0.019548561  0.02705895  0.014687243  0.044248741  0.05737813\n#&gt; Gene3   2.395132841  3.07937035  2.256007527  2.415867713  2.48658672\n#&gt; Gene4   0.083182670  0.14317924  0.156855571  0.083322439  0.17252389\n#&gt; Gene5   0.027406019  0.01016765  0.020571287  0.049950368  0.07319428\n#&gt; Gene6   0.015444824  0.01451434  0.013529512  0.008938481  0.02281410\n#&gt; Gene7   0.027244791  0.06197748  0.083861020  0.752735813  0.66726281\n#&gt; Gene8   0.502507993  0.42464105  0.470344575  0.533677126  0.32546274\n#&gt; Gene9   0.854770698  1.01076161  0.831606319  1.207970172  0.92257052\n#&gt; Gene10  2.366194466  2.13447866  1.956382548  0.962606527  1.31203300\n#&gt; Gene11  2.155082130  1.98799347  1.788864352  3.616962038  3.06590887\n#&gt; Gene12  0.129310440  0.09191911  0.104282037  0.243862580  0.24021022\n#&gt; Gene13  0.605845552  0.58849974  0.574435835  0.432609433  0.33815736\n#&gt; Gene14  2.281032962  1.72559272  2.367729880  1.788446640  1.90978813\n#&gt; Gene15  1.098679859  1.12561208  1.114335742  0.721540287  0.62703942\n#&gt; Gene16  3.768603241  3.83448142  3.487697474  3.731478791  3.29533360\n#&gt; Gene17  0.203230074  0.05219244  0.014276941  0.032323746  0.01202423\n#&gt; Gene18  2.152050491  1.85644729  3.813717676  0.640071180  0.54325715\n#&gt; Gene19  0.516357072  0.31591833  0.276653295  0.366272032  0.54603307\n#&gt; Gene20  2.280619557  2.36036186  2.589737224  4.425116212  4.39044996\n#&gt; Gene21  6.825873663  6.68907517  7.000483477  5.783822390  5.86881864\n#&gt; Gene22  0.444148936  0.52574211  0.603483647  0.382820066  0.48857265\n#&gt; Gene23  6.425283872  5.84820317  7.471677403  4.017770676  4.56303969\n#&gt; Gene24  7.981617242  5.09157053  8.114701616 11.528060240 13.19384251\n#&gt; Gene25  6.000165362  5.96854511  5.584680317  4.962957583  4.91216906\n#&gt; Gene26  3.106879065  4.39925858  2.880084674  1.836868100  1.81948848\n#&gt; Gene27  0.974603131  1.10357706  1.088201858  1.090548131  0.80487377\n#&gt; Gene28  0.090236743  0.04519600  0.045398476  0.109017286  0.06329643\n#&gt; Gene29  1.505897916  1.21549506  1.164930941  1.094930273  1.07443412\n#&gt; Gene30  0.418214640  0.48694221  0.696402671  2.029101298  1.40913530\n#&gt; Gene31 12.094173740  6.11129554  5.846019156  1.705766996  2.03015108\n#&gt; Gene32 14.755815240 14.35665477 14.220752920 13.041109820 13.04242876\n#&gt; Gene33  8.567688237  8.45699505  8.462020933  6.893400155  6.32240155\n#&gt; Gene34 28.143258740 29.04805378 27.188386100 21.545128800 20.25762280\n#&gt; Gene35 10.272571930 14.51711069 13.670634660 15.391971720 13.49886440\n#&gt; Gene36  1.230432146  1.33515921  1.281579532  0.975571373  0.85519141\n#&gt; Gene37  2.105335685  2.12880737  2.290242914  2.313335270  2.16477765\n#&gt; Gene38 79.213978610 81.18377735 77.198186310 81.823794310 79.83893089\n#&gt; Gene39  8.132510197  7.49287631  6.970690849  8.731115630  7.74492270\n#&gt; Gene40  0.753541506  0.83845132  1.001006155  0.997615243  0.60000439\n#&gt; Gene41  0.325474038  0.30016322  0.350076442  0.200246949  0.21014691\n#&gt; Gene42  0.797210892  1.09573409  0.763174744  0.803602557  0.35076420\n#&gt; Gene43  0.574330283  0.68311340  0.591644997  0.388098005  0.32650509\n#&gt; Gene44 14.185315840 14.51019448 14.120137460 10.248523150  9.98540723\n#&gt; Gene45  0.265364899  0.17134202  0.109452626  0.281498160  0.48228569\n#&gt; Gene46 10.906735750 11.40647910 11.379215720 10.631052680 10.69211442\n#&gt; Gene47  5.665169221  5.94489169  5.530583178  5.948818516  5.76601091\n#&gt; Gene48  2.109194135  2.17929565  2.348260137  2.454241720  2.34274366\n#&gt; Gene49  0.004976574  0.00442388  0.006059272  0.025406740  0.03158951\n#&gt; Gene50  0.578367876  0.88617313  0.713324361  0.222133450  0.18598655\n#&gt;            Sample6\n#&gt; Gene1   0.69472331\n#&gt; Gene2   0.05942839\n#&gt; Gene3   2.43571945\n#&gt; Gene4   0.06852347\n#&gt; Gene5   0.06896061\n#&gt; Gene6   0.01208279\n#&gt; Gene7   0.69213029\n#&gt; Gene8   0.48171690\n#&gt; Gene9   1.06054591\n#&gt; Gene10  1.32278532\n#&gt; Gene11  3.51641291\n#&gt; Gene12  0.30601099\n#&gt; Gene13  0.41972532\n#&gt; Gene14  1.63142375\n#&gt; Gene15  0.66917172\n#&gt; Gene16  3.27913994\n#&gt; Gene17  0.01399543\n#&gt; Gene18  0.86020629\n#&gt; Gene19  0.58455431\n#&gt; Gene20  4.81441537\n#&gt; Gene21  5.68732288\n#&gt; Gene22  0.47799947\n#&gt; Gene23  5.39830421\n#&gt; Gene24 11.26897438\n#&gt; Gene25  5.28402767\n#&gt; Gene26  2.04171782\n#&gt; Gene27  1.04176371\n#&gt; Gene28  0.03033377\n#&gt; Gene29  1.21975286\n#&gt; Gene30  2.41736177\n#&gt; Gene31  1.87294193\n#&gt; Gene32 13.67646890\n#&gt; Gene33  5.82982434\n#&gt; Gene34 20.53076632\n#&gt; Gene35 12.53599826\n#&gt; Gene36  0.86309763\n#&gt; Gene37  2.43503104\n#&gt; Gene38 76.55265785\n#&gt; Gene39  7.53249882\n#&gt; Gene40  0.95383044\n#&gt; Gene41  0.09595213\n#&gt; Gene42  0.81975056\n#&gt; Gene43  0.43375747\n#&gt; Gene44 10.42543915\n#&gt; Gene45  0.38292966\n#&gt; Gene46 10.73717544\n#&gt; Gene47  5.88971626\n#&gt; Gene48  2.41323130\n#&gt; Gene49  0.06582145\n#&gt; Gene50  0.27235908\n\nsample_group &lt;- read.delim(\"data/heatmap/sample.class.txt\",header = T,row.names = 1,sep = \"\\t\")\ngene_group &lt;- read.delim(\"data/heatmap/gene.class.txt\",header = T,row.names = 1,sep = \"\\t\")\n\n\n\nCodepheatmap(test,\n         annotation_legend = T,#legend_breaks = seq(-1,1,0.2), legend_labels = seq(-1,1,0.2),\n         show_rownames = T,show_colnames = T,\n         fontsize = 12,\n         color = colorRampPalette(c(\"#0000ff\",\"#ffffff\",\"#ff0000\"))(200),\n         border_color = NA,\n         scale = \"row\",       # 归一化\n         cluster_rows = T,cluster_cols = T,clustering_distance_rows = \"correlation\",\n         display_numbers = TRUE, number_format = \"%.1e\",\n         \n \n         \n         treeheight_row = 12,\n         treeheight_col = 12,\n         \n         annotation_row = gene_group,annotation_col = sample_group,\n         )\n#&gt; Warning: The input is a data frame, convert it to the matrix.\n\n\n\n\n\n\n\n\nCodelibrary(\"Hiiragi2013\")\ndata(\"x\")\ndim(Biobase::exprs(x))\n#&gt; [1] 45101   101\n\ndfx = as.data.frame(Biobase::exprs(x))\ngroups = group_by(pData(x), sampleGroup) |&gt;\n  summarise(n = n(), color = unique(sampleColour))\ngroups\n#&gt; # A tibble: 8 × 3\n#&gt;   sampleGroup         n color  \n#&gt;   &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;  \n#&gt; 1 E3.25              36 #CAB2D6\n#&gt; 2 E3.25 (FGF4-KO)    17 #FDBF6F\n#&gt; 3 E3.5 (EPI)         11 #A6CEE3\n#&gt; 4 E3.5 (FGF4-KO)      8 #FF7F00\n#&gt; 5 E3.5 (PE)          11 #B2DF8A\n#&gt; 6 E4.5 (EPI)          4 #1F78B4\n#&gt; 7 E4.5 (FGF4-KO)     10 #E31A1C\n#&gt; 8 E4.5 (PE)           4 #33A02C\ngroupColor = setNames(groups$color, groups$sampleGroup)\ntopGenes = order(rowVars(Biobase::exprs(x)), decreasing = TRUE)[1:500]\nrowCenter = function(x) { x - rowMeans(x) }\npheatmap::pheatmap(rowCenter(dfx[topGenes, ]), \n  show_rownames = FALSE, \n  show_colnames = FALSE, \n  breaks = seq(-5, +5, length = 101),\n  annotation_col = pData(x)[, c(\"sampleGroup\", \"Embryonic.day\", \"ScanDate\", \"genotype\") ],\n  annotation_colors = list(\n    sampleGroup = groupColor,\n    genotype = c(`FGF4-KO` = \"chocolate1\", `WT` = \"azure2\"),\n    Embryonic.day = setNames(brewer.pal(9, \"Blues\")[c(3, 6, 9)], c(\"E3.25\", \"E3.5\", \"E4.5\")),\n    ScanDate = setNames(brewer.pal(nlevels(x$ScanDate), \"YlGn\"), levels(x$ScanDate))\n  )\n)",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "热图"
    ]
  },
  {
    "objectID": "热图.html#相关性热图",
    "href": "热图.html#相关性热图",
    "title": "\n1 热图",
    "section": "",
    "text": "Coder &lt;- cor(test,method = \"pearson\",use = \"pairwise.complete.obs\")\n\nr\n#&gt;           Sample1   Sample2   Sample3   Sample4   Sample5   Sample6\n#&gt; Sample1 1.0000000 0.9952840 0.9957627 0.9830767 0.9830091 0.9851351\n#&gt; Sample2 0.9952840 1.0000000 0.9983278 0.9887180 0.9865182 0.9891590\n#&gt; Sample3 0.9957627 0.9983278 1.0000000 0.9902566 0.9893629 0.9915575\n#&gt; Sample4 0.9830767 0.9887180 0.9902566 1.0000000 0.9992817 0.9990420\n#&gt; Sample5 0.9830091 0.9865182 0.9893629 0.9992817 1.0000000 0.9993162\n#&gt; Sample6 0.9851351 0.9891590 0.9915575 0.9990420 0.9993162 1.0000000\n\npheatmap::pheatmap(r,fontsize = 12,\n         color = colorRampPalette(c(\"#0000ff\",\"#ffffff\",\"#ff0000\"))(200),)\n\n\n\n\n\n\n\n\nCodepheatmap::pheatmap(test, kmeans_k = 2,\n                 cellwidth = 30,cellheight = 25,)\n\n\n\n\n\n\n\n\nCode# Show text within cells\npheatmap::pheatmap(test, display_numbers = TRUE)\n\n\n\n\n\n\nCodepheatmap::pheatmap(test, display_numbers = matrix(ifelse(test &gt; 5, \"*\", \"\"), nrow(test)))",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "热图"
    ]
  },
  {
    "objectID": "热图.html#geom_tile",
    "href": "热图.html#geom_tile",
    "title": "\n1 热图",
    "section": "",
    "text": "Code# 设置随机数种子以确保结果的可重复性  \nset.seed(10)  \n  \n# 生成随机数据集  \nmydata &lt;- tibble(  \n  year = 2000:2024,  \n  lung = runif(25),  \n  liver = runif(25), \n  bone = runif(25),  \n  luk = runif(25),  \n  eso = runif(25),  \n  gas = runif(25),   \n  eye = runif(25),  \n  brain = runif(25),  \n  pan = runif(25),  \n  kidney = runif(25),  \n  breast= runif(25),  \n)  |&gt; pivot_longer(cols = -1,\n                   names_to = \"cancer\",\n                   values_to = \"morbidity\")\n\nggplot(mydata, aes(year, cancer)) +  \n  geom_tile(aes(fill =morbidity)) +  \n  scale_fill_gradient(low = \"white\", high = \"red\")",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "热图"
    ]
  },
  {
    "objectID": "热图.html#complexheatmap",
    "href": "热图.html#complexheatmap",
    "title": "\n1 热图",
    "section": "",
    "text": "https://jokergoo.github.io/ComplexHeatmap-reference/book/\n\nCodeif(!require(ComplexHeatmap)) BiocManager::install(\"ComplexHeatmap\")\n\n\n\nCodeset.seed(123)\nnr1 = 4; nr2 = 8; nr3 = 6; nr = nr1 + nr2 + nr3\nnc1 = 6; nc2 = 8; nc3 = 10; nc = nc1 + nc2 + nc3\nmat = cbind(rbind(matrix(rnorm(nr1*nc1, mean = 1,   sd = 0.5), nrow  = nr1),\n          matrix(rnorm(nr2*nc1, mean = 0,   sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc1, mean = 0,   sd = 0.5), nrow = nr3)),\n    rbind(matrix(rnorm(nr1*nc2, mean = 0,   sd = 0.5), nrow = nr1),\n          matrix(rnorm(nr2*nc2, mean = 1,   sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc2, mean = 0,   sd = 0.5), nrow = nr3)),\n    rbind(matrix(rnorm(nr1*nc3, mean = 0.5, sd = 0.5), nrow = nr1),\n          matrix(rnorm(nr2*nc3, mean = 0.5, sd = 0.5), nrow = nr2),\n          matrix(rnorm(nr3*nc3, mean = 1,   sd = 0.5), nrow = nr3))\n   )\nmat = mat[sample(nr, nr), sample(nc, nc)] # random shuffle rows and columns\nrownames(mat) = paste0(\"row\", seq_len(nr))\ncolnames(mat) = paste0(\"column\", seq_len(nc))\n\n\n\nCodeHeatmap(mat)\n\n\n\n\n\n\n\n\nCodeset.seed(123)\nmat = matrix(rnorm(100), 10)\nrownames(mat) = paste0(\"R\", 1:10)\ncolnames(mat) = paste0(\"C\", 1:10)\ncolumn_ha = HeatmapAnnotation(foo1 = runif(10), bar1 = anno_barplot(runif(10)))\nrow_ha = rowAnnotation(foo2 = runif(10), bar2 = anno_barplot(runif(10)))\nHeatmap(mat, name = \"mat\", top_annotation = column_ha, right_annotation = row_ha)",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "热图"
    ]
  },
  {
    "objectID": "相关图.html",
    "href": "相关图.html",
    "title": "\n1 相关图",
    "section": "",
    "text": "1 相关图\n\nCodelibrary(tidyverse)\nlibrary(ggcorrplot)\n\n\n\nCodedata(\"iris\")\ncor&lt;-cor(iris[,1:4])\nggcorrplot(cor)\n\n\n\n\n\n\nCodep.mat &lt;- ggcorrplot::cor_pmat(cor)\nggcorrplot(cor,hc.order=TRUE,lab=TRUE)\n\n\n\n\n\n\nCode\nggcorrplot(cor, hc.order = TRUE, p.mat = p.mat) + \n    labs(title = \"鸢尾花数据集指标相关性\") +\n    theme(plot.title = element_text(hjust = 0.5))\n\n\n\n\n\n\n\n\n\n Back to top",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "相关图"
    ]
  },
  {
    "objectID": "网络图.html",
    "href": "网络图.html",
    "title": "\n1 网络图",
    "section": "",
    "text": "https://igraph.org/\nhttps://r.igraph.org/\nhttps://ggraph.data-imaginist.com/\nhttps://tidygraph.data-imaginist.com/index.html\nhttps://yufree.cn/cn/2020/06/24/r-network-analysis/\nhttps://kateto.net/network-visualization\n\n\nCodelibrary(tidygraph)\nlibrary(ggraph)\nrstat_nodes &lt;- data.frame(name = c(\"Hadley\", \"David\", \"Romain\", \"Julia\"))\nrstat_edges &lt;- data.frame(from = c(1, 1, 1, 2, 3, 3, 4, 4, 4),\n                            to = c(2, 3, 4, 1, 1, 2, 1, 2, 3))\ntbl_graph(nodes = rstat_nodes, edges = rstat_edges)\n#&gt; # A tbl_graph: 4 nodes and 9 edges\n#&gt; #\n#&gt; # A directed simple graph with 1 component\n#&gt; #\n#&gt; # Node Data: 4 × 1 (active)\n#&gt;   name  \n#&gt;   &lt;chr&gt; \n#&gt; 1 Hadley\n#&gt; 2 David \n#&gt; 3 Romain\n#&gt; 4 Julia \n#&gt; #\n#&gt; # Edge Data: 9 × 2\n#&gt;    from    to\n#&gt;   &lt;int&gt; &lt;int&gt;\n#&gt; 1     1     2\n#&gt; 2     1     3\n#&gt; 3     1     4\n#&gt; # ℹ 6 more rows\n\n\n\n\nCode\nhighschool %&gt;% as_tibble()\n#&gt; # A tibble: 506 × 3\n#&gt;     from    to  year\n#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n#&gt;  1     1    14  1957\n#&gt;  2     1    15  1957\n#&gt;  3     1    21  1957\n#&gt;  4     1    54  1957\n#&gt;  5     1    55  1957\n#&gt;  6     2    21  1957\n#&gt;  7     2    22  1957\n#&gt;  8     3     9  1957\n#&gt;  9     3    15  1957\n#&gt; 10     4     5  1957\n#&gt; # ℹ 496 more rows\n\n\ngr &lt;- as_tbl_graph(highschool)\ngr\n#&gt; # A tbl_graph: 70 nodes and 506 edges\n#&gt; #\n#&gt; # A directed multigraph with 1 component\n#&gt; #\n#&gt; # Node Data: 70 × 0 (active)\n#&gt; #\n#&gt; # Edge Data: 506 × 3\n#&gt;    from    to  year\n#&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;\n#&gt; 1     1    13  1957\n#&gt; 2     1    14  1957\n#&gt; 3     1    20  1957\n#&gt; # ℹ 503 more rows\n\ncreate_layout(gr,layout = \"kk\") %&gt;% \n    ggplot()+\n    theme(\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid = element_blank(),\n    )+\n    geom_point(aes(x = x, y = y))\n\n\n\n\n\n\nCode\n\nggraph(gr, layout = \"kk\") + \n  geom_point(aes(x = x, y = y))\n\n\n\n\n\n\nCode\nggraph(gr, layout = 'kk') + \n  geom_node_point()\n\n\n\n\n\n\n\n\nCodegr2 &lt;- tbl_graph(flare$vertices, flare$edges)\ngr2\n#&gt; # A tbl_graph: 252 nodes and 251 edges\n#&gt; #\n#&gt; # A rooted tree\n#&gt; #\n#&gt; # Node Data: 252 × 3 (active)\n#&gt;    name                                            size shortName            \n#&gt;    &lt;chr&gt;                                          &lt;dbl&gt; &lt;chr&gt;                \n#&gt;  1 flare.analytics.cluster.AgglomerativeCluster    3938 AgglomerativeCluster \n#&gt;  2 flare.analytics.cluster.CommunityStructure      3812 CommunityStructure   \n#&gt;  3 flare.analytics.cluster.HierarchicalCluster     6714 HierarchicalCluster  \n#&gt;  4 flare.analytics.cluster.MergeEdge                743 MergeEdge            \n#&gt;  5 flare.analytics.graph.BetweennessCentrality     3534 BetweennessCentrality\n#&gt;  6 flare.analytics.graph.LinkDistance              5731 LinkDistance         \n#&gt;  7 flare.analytics.graph.MaxFlowMinCut             7840 MaxFlowMinCut        \n#&gt;  8 flare.analytics.graph.ShortestPaths             5914 ShortestPaths        \n#&gt;  9 flare.analytics.graph.SpanningTree              3416 SpanningTree         \n#&gt; 10 flare.analytics.optimization.AspectRatioBanker  7074 AspectRatioBanker    \n#&gt; # ℹ 242 more rows\n#&gt; #\n#&gt; # Edge Data: 251 × 2\n#&gt;    from    to\n#&gt;   &lt;int&gt; &lt;int&gt;\n#&gt; 1   221     1\n#&gt; 2   221     2\n#&gt; 3   221     3\n#&gt; # ℹ 248 more rows\n\n\ncreate_layout(gr2,layout = \"partition\") \n#&gt; # A tibble: 252 × 12\n#&gt;        x     y width height circular leaf  depth name           size shortName\n#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;    \n#&gt;  1 110     1.5   220      1 FALSE    FALSE     0 flare             0 flare    \n#&gt;  2  10     2.5    20      1 FALSE    FALSE     1 flare.animate     0 animate  \n#&gt;  3  25.5   2.5    11      1 FALSE    FALSE     1 flare.data        0 data     \n#&gt;  4  33     2.5     4      1 FALSE    FALSE     1 flare.display     0 display  \n#&gt;  5  35.5   2.5     1      1 FALSE    FALSE     1 flare.flex        0 flex     \n#&gt;  6  40     2.5     8      1 FALSE    FALSE     1 flare.physics     0 physics  \n#&gt;  7  74     2.5    60      1 FALSE    FALSE     1 flare.query       0 query    \n#&gt;  8 109     2.5    10      1 FALSE    FALSE     1 flare.scale       0 scale    \n#&gt;  9 126.    2.5    25      1 FALSE    FALSE     1 flare.util        0 util     \n#&gt; 10 174.    2.5    71      1 FALSE    FALSE     1 flare.vis         0 vis      \n#&gt; # ℹ 242 more rows\n#&gt; # ℹ 2 more variables: .ggraph.orig_index &lt;int&gt;, .ggraph.index &lt;int&gt;\n\ncreate_layout(gr2,layout = \"partition\") %&gt;% \n    ggplot()+\n    theme(\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid = element_blank(),\n    )+\n    geom_tile(aes(x=x,y = -y, fill = depth))\n\n\n\n\n\n\nCode\nggraph(gr2, layout = 'partition') + \n  geom_node_tile(aes(y = -y, fill = depth))\n\n\n\n\n\n\n\n\n\nCodelibrary(ggraph)\nlibrary(tidygraph)\n\nhighschool$year &lt;- factor(highschool$year)\n\ngr &lt;- as_tbl_graph(highschool) %&gt;% \n    activate(edges)\n\ngr\n#&gt; # A tbl_graph: 70 nodes and 506 edges\n#&gt; #\n#&gt; # A directed multigraph with 1 component\n#&gt; #\n#&gt; # Edge Data: 506 × 3 (active)\n#&gt;     from    to year \n#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;\n#&gt;  1     1    13 1957 \n#&gt;  2     1    14 1957 \n#&gt;  3     1    20 1957 \n#&gt;  4     1    52 1957 \n#&gt;  5     1    53 1957 \n#&gt;  6     2    20 1957 \n#&gt;  7     2    21 1957 \n#&gt;  8     3     9 1957 \n#&gt;  9     3    14 1957 \n#&gt; 10     4     5 1957 \n#&gt; # ℹ 496 more rows\n#&gt; #\n#&gt; # Node Data: 70 × 0\n\n# link\n\nggraph(gr, layout = 'kk') + \n  geom_edge_link(aes(colour = year))\n\n\n\n\n\n\nCode\n\n# fan\n\nggraph(gr, layout = 'kk') + \n  geom_edge_fan(aes(colour = year))\n\n\n\n\n\n\nCode\n# parallel\n\nggraph(gr, layout = 'kk') + \n  geom_edge_parallel(aes(colour = year))\n\n\n\n\n\n\nCode\n# loop  make some of the student love themselves\nloopy_gr&lt;- gr |&gt; \n  bind_edges(tibble::tibble(from = 1:5, to = 1:5, year = rep('1957', 5)))\nggraph(loopy_gr, layout = 'stress') + \n  geom_edge_link(aes(colour = year), alpha = 0.25) + \n  geom_edge_loop(aes(colour = year))\n\n\n\n\n\n\nCode\n\n\n# Force directed 力导向\n\nggraph(gr) + \n  geom_edge_bundle_force(n_cycle = 2, threshold = 0.4)\n#&gt; Using \"stress\" as default layout\n\n\n\n\n\n\nCode\n\n\n# arc\nggraph(gr, layout = 'linear') + \n  geom_edge_arc(aes(colour = year))\n\n\n\n\n\n\n\n\nCode# hive 蜂巢图\nhairball &lt;- as_tbl_graph(highschool) |&gt; \n  mutate(\n    year_pop = map_local(mode = 'in', .f = function(neighborhood, ...) {\n      neighborhood %E&gt;% pull(year) |&gt; table() |&gt; sort(decreasing = TRUE)\n    }),\n    pop_devel = map_chr(year_pop, function(pop) {\n      if (length(pop) == 0 || length(unique(pop)) == 1) return('unchanged')\n      switch(names(pop)[which.max(pop)],\n             '1957' = 'decreased',\n             '1958' = 'increased')\n    }),\n    popularity = map_dbl(year_pop, ~ .[1]) %/% 0\n  ) |&gt; \n  activate(edges) |&gt; \n  mutate(year = as.character(year))\n\n\nggraph(hairball, layout = 'hive', axis = pop_devel, sort.by = popularity) + \n  geom_edge_hive(aes(colour = year)) + \n  geom_axis_hive(label = FALSE) + \n  coord_fixed()\n\n\n\n\n\n\n\n\nCodehierarchy &lt;- as_tbl_graph(hclust(dist(iris[, 1:4]))) |&gt; \n  mutate(Class = map_bfs_back_chr(node_is_root(), .f = function(node, path, ...) {\n    if (leaf[node]) {\n      as.character(iris$Species[as.integer(label[node])])\n    } else {\n      species &lt;- unique(unlist(path$result))\n      if (length(species) == 1) {\n        species\n      } else {\n        NA_character_\n      }\n    }\n  }))\n\n#  elbow\nggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_elbow()\n\n\n\n\n\n\nCodeggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_elbow2(aes(colour = node.Class))\n\n\n\n\n\n\nCode\nggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_diagonal()\n\n\n\n\n\n\nCode\n\nggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_bend()\n\n\n\n\n\n\n\n\n\nCode# Random names - I swear\nsimple &lt;- create_notable('bull') |&gt; \n  mutate(name = c('Thomas', 'Bob', 'Hadley', 'Winston', 'Baptiste')) |&gt; \n  activate(edges) |&gt; \n  mutate(type = sample(c('friend', 'foe'), 5, TRUE))\n\n\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(arrow = arrow(length = unit(4, 'mm'))) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\nCode\n\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(arrow = arrow(length = unit(4, 'mm')), \n                 end_cap = circle(3, 'mm')) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\nCode\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(aes(start_cap = label_rect(node1.name),\n                     end_cap = label_rect(node2.name)), \n                 arrow = arrow(length = unit(4, 'mm'))) + \n  geom_node_text(aes(label = name))\n\n\n\n\n\n\n\n\n\nCodeggraph(simple, layout = 'graphopt') + \n  geom_edge_link(aes(label = type), \n                 arrow = arrow(length = unit(4, 'mm')), \n                 end_cap = circle(3, 'mm')) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\nCode\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(aes(label = type), \n                 angle_calc = 'along',\n                 label_dodge = unit(2.5, 'mm'),\n                 arrow = arrow(length = unit(4, 'mm')), \n                 end_cap = circle(3, 'mm')) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\n\n\n\nCodeflaregraph &lt;- tbl_graph(flare$vertices, flare$edges)\nfrom &lt;- match(flare$imports$from, flare$vertices$name)\nto &lt;- match(flare$imports$to, flare$vertices$name)\nggraph(flaregraph, layout = 'dendrogram', circular = TRUE) + \n  geom_conn_bundle(data = get_con(from = from, to = to), alpha = 0.1) + \n  coord_fixed()",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "网络图"
    ]
  },
  {
    "objectID": "网络图.html#tbl_graph",
    "href": "网络图.html#tbl_graph",
    "title": "\n1 网络图",
    "section": "",
    "text": "Codelibrary(tidygraph)\nlibrary(ggraph)\nrstat_nodes &lt;- data.frame(name = c(\"Hadley\", \"David\", \"Romain\", \"Julia\"))\nrstat_edges &lt;- data.frame(from = c(1, 1, 1, 2, 3, 3, 4, 4, 4),\n                            to = c(2, 3, 4, 1, 1, 2, 1, 2, 3))\ntbl_graph(nodes = rstat_nodes, edges = rstat_edges)\n#&gt; # A tbl_graph: 4 nodes and 9 edges\n#&gt; #\n#&gt; # A directed simple graph with 1 component\n#&gt; #\n#&gt; # Node Data: 4 × 1 (active)\n#&gt;   name  \n#&gt;   &lt;chr&gt; \n#&gt; 1 Hadley\n#&gt; 2 David \n#&gt; 3 Romain\n#&gt; 4 Julia \n#&gt; #\n#&gt; # Edge Data: 9 × 2\n#&gt;    from    to\n#&gt;   &lt;int&gt; &lt;int&gt;\n#&gt; 1     1     2\n#&gt; 2     1     3\n#&gt; 3     1     4\n#&gt; # ℹ 6 more rows",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "网络图"
    ]
  },
  {
    "objectID": "网络图.html#节点",
    "href": "网络图.html#节点",
    "title": "\n1 网络图",
    "section": "",
    "text": "Code\nhighschool %&gt;% as_tibble()\n#&gt; # A tibble: 506 × 3\n#&gt;     from    to  year\n#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n#&gt;  1     1    14  1957\n#&gt;  2     1    15  1957\n#&gt;  3     1    21  1957\n#&gt;  4     1    54  1957\n#&gt;  5     1    55  1957\n#&gt;  6     2    21  1957\n#&gt;  7     2    22  1957\n#&gt;  8     3     9  1957\n#&gt;  9     3    15  1957\n#&gt; 10     4     5  1957\n#&gt; # ℹ 496 more rows\n\n\ngr &lt;- as_tbl_graph(highschool)\ngr\n#&gt; # A tbl_graph: 70 nodes and 506 edges\n#&gt; #\n#&gt; # A directed multigraph with 1 component\n#&gt; #\n#&gt; # Node Data: 70 × 0 (active)\n#&gt; #\n#&gt; # Edge Data: 506 × 3\n#&gt;    from    to  year\n#&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;\n#&gt; 1     1    13  1957\n#&gt; 2     1    14  1957\n#&gt; 3     1    20  1957\n#&gt; # ℹ 503 more rows\n\ncreate_layout(gr,layout = \"kk\") %&gt;% \n    ggplot()+\n    theme(\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid = element_blank(),\n    )+\n    geom_point(aes(x = x, y = y))\n\n\n\n\n\n\nCode\n\nggraph(gr, layout = \"kk\") + \n  geom_point(aes(x = x, y = y))\n\n\n\n\n\n\nCode\nggraph(gr, layout = 'kk') + \n  geom_node_point()\n\n\n\n\n\n\n\n\nCodegr2 &lt;- tbl_graph(flare$vertices, flare$edges)\ngr2\n#&gt; # A tbl_graph: 252 nodes and 251 edges\n#&gt; #\n#&gt; # A rooted tree\n#&gt; #\n#&gt; # Node Data: 252 × 3 (active)\n#&gt;    name                                            size shortName            \n#&gt;    &lt;chr&gt;                                          &lt;dbl&gt; &lt;chr&gt;                \n#&gt;  1 flare.analytics.cluster.AgglomerativeCluster    3938 AgglomerativeCluster \n#&gt;  2 flare.analytics.cluster.CommunityStructure      3812 CommunityStructure   \n#&gt;  3 flare.analytics.cluster.HierarchicalCluster     6714 HierarchicalCluster  \n#&gt;  4 flare.analytics.cluster.MergeEdge                743 MergeEdge            \n#&gt;  5 flare.analytics.graph.BetweennessCentrality     3534 BetweennessCentrality\n#&gt;  6 flare.analytics.graph.LinkDistance              5731 LinkDistance         \n#&gt;  7 flare.analytics.graph.MaxFlowMinCut             7840 MaxFlowMinCut        \n#&gt;  8 flare.analytics.graph.ShortestPaths             5914 ShortestPaths        \n#&gt;  9 flare.analytics.graph.SpanningTree              3416 SpanningTree         \n#&gt; 10 flare.analytics.optimization.AspectRatioBanker  7074 AspectRatioBanker    \n#&gt; # ℹ 242 more rows\n#&gt; #\n#&gt; # Edge Data: 251 × 2\n#&gt;    from    to\n#&gt;   &lt;int&gt; &lt;int&gt;\n#&gt; 1   221     1\n#&gt; 2   221     2\n#&gt; 3   221     3\n#&gt; # ℹ 248 more rows\n\n\ncreate_layout(gr2,layout = \"partition\") \n#&gt; # A tibble: 252 × 12\n#&gt;        x     y width height circular leaf  depth name           size shortName\n#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;    \n#&gt;  1 110     1.5   220      1 FALSE    FALSE     0 flare             0 flare    \n#&gt;  2  10     2.5    20      1 FALSE    FALSE     1 flare.animate     0 animate  \n#&gt;  3  25.5   2.5    11      1 FALSE    FALSE     1 flare.data        0 data     \n#&gt;  4  33     2.5     4      1 FALSE    FALSE     1 flare.display     0 display  \n#&gt;  5  35.5   2.5     1      1 FALSE    FALSE     1 flare.flex        0 flex     \n#&gt;  6  40     2.5     8      1 FALSE    FALSE     1 flare.physics     0 physics  \n#&gt;  7  74     2.5    60      1 FALSE    FALSE     1 flare.query       0 query    \n#&gt;  8 109     2.5    10      1 FALSE    FALSE     1 flare.scale       0 scale    \n#&gt;  9 126.    2.5    25      1 FALSE    FALSE     1 flare.util        0 util     \n#&gt; 10 174.    2.5    71      1 FALSE    FALSE     1 flare.vis         0 vis      \n#&gt; # ℹ 242 more rows\n#&gt; # ℹ 2 more variables: .ggraph.orig_index &lt;int&gt;, .ggraph.index &lt;int&gt;\n\ncreate_layout(gr2,layout = \"partition\") %&gt;% \n    ggplot()+\n    theme(\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid = element_blank(),\n    )+\n    geom_tile(aes(x=x,y = -y, fill = depth))\n\n\n\n\n\n\nCode\nggraph(gr2, layout = 'partition') + \n  geom_node_tile(aes(y = -y, fill = depth))",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "网络图"
    ]
  },
  {
    "objectID": "网络图.html#边",
    "href": "网络图.html#边",
    "title": "\n1 网络图",
    "section": "",
    "text": "Codelibrary(ggraph)\nlibrary(tidygraph)\n\nhighschool$year &lt;- factor(highschool$year)\n\ngr &lt;- as_tbl_graph(highschool) %&gt;% \n    activate(edges)\n\ngr\n#&gt; # A tbl_graph: 70 nodes and 506 edges\n#&gt; #\n#&gt; # A directed multigraph with 1 component\n#&gt; #\n#&gt; # Edge Data: 506 × 3 (active)\n#&gt;     from    to year \n#&gt;    &lt;int&gt; &lt;int&gt; &lt;chr&gt;\n#&gt;  1     1    13 1957 \n#&gt;  2     1    14 1957 \n#&gt;  3     1    20 1957 \n#&gt;  4     1    52 1957 \n#&gt;  5     1    53 1957 \n#&gt;  6     2    20 1957 \n#&gt;  7     2    21 1957 \n#&gt;  8     3     9 1957 \n#&gt;  9     3    14 1957 \n#&gt; 10     4     5 1957 \n#&gt; # ℹ 496 more rows\n#&gt; #\n#&gt; # Node Data: 70 × 0\n\n# link\n\nggraph(gr, layout = 'kk') + \n  geom_edge_link(aes(colour = year))\n\n\n\n\n\n\nCode\n\n# fan\n\nggraph(gr, layout = 'kk') + \n  geom_edge_fan(aes(colour = year))\n\n\n\n\n\n\nCode\n# parallel\n\nggraph(gr, layout = 'kk') + \n  geom_edge_parallel(aes(colour = year))\n\n\n\n\n\n\nCode\n# loop  make some of the student love themselves\nloopy_gr&lt;- gr |&gt; \n  bind_edges(tibble::tibble(from = 1:5, to = 1:5, year = rep('1957', 5)))\nggraph(loopy_gr, layout = 'stress') + \n  geom_edge_link(aes(colour = year), alpha = 0.25) + \n  geom_edge_loop(aes(colour = year))\n\n\n\n\n\n\nCode\n\n\n# Force directed 力导向\n\nggraph(gr) + \n  geom_edge_bundle_force(n_cycle = 2, threshold = 0.4)\n#&gt; Using \"stress\" as default layout\n\n\n\n\n\n\nCode\n\n\n# arc\nggraph(gr, layout = 'linear') + \n  geom_edge_arc(aes(colour = year))\n\n\n\n\n\n\n\n\nCode# hive 蜂巢图\nhairball &lt;- as_tbl_graph(highschool) |&gt; \n  mutate(\n    year_pop = map_local(mode = 'in', .f = function(neighborhood, ...) {\n      neighborhood %E&gt;% pull(year) |&gt; table() |&gt; sort(decreasing = TRUE)\n    }),\n    pop_devel = map_chr(year_pop, function(pop) {\n      if (length(pop) == 0 || length(unique(pop)) == 1) return('unchanged')\n      switch(names(pop)[which.max(pop)],\n             '1957' = 'decreased',\n             '1958' = 'increased')\n    }),\n    popularity = map_dbl(year_pop, ~ .[1]) %/% 0\n  ) |&gt; \n  activate(edges) |&gt; \n  mutate(year = as.character(year))\n\n\nggraph(hairball, layout = 'hive', axis = pop_devel, sort.by = popularity) + \n  geom_edge_hive(aes(colour = year)) + \n  geom_axis_hive(label = FALSE) + \n  coord_fixed()\n\n\n\n\n\n\n\n\nCodehierarchy &lt;- as_tbl_graph(hclust(dist(iris[, 1:4]))) |&gt; \n  mutate(Class = map_bfs_back_chr(node_is_root(), .f = function(node, path, ...) {\n    if (leaf[node]) {\n      as.character(iris$Species[as.integer(label[node])])\n    } else {\n      species &lt;- unique(unlist(path$result))\n      if (length(species) == 1) {\n        species\n      } else {\n        NA_character_\n      }\n    }\n  }))\n\n#  elbow\nggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_elbow()\n\n\n\n\n\n\nCodeggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_elbow2(aes(colour = node.Class))\n\n\n\n\n\n\nCode\nggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_diagonal()\n\n\n\n\n\n\nCode\n\nggraph(hierarchy, layout = 'dendrogram', height = height) + \n  geom_edge_bend()\n\n\n\n\n\n\n\n\n\nCode# Random names - I swear\nsimple &lt;- create_notable('bull') |&gt; \n  mutate(name = c('Thomas', 'Bob', 'Hadley', 'Winston', 'Baptiste')) |&gt; \n  activate(edges) |&gt; \n  mutate(type = sample(c('friend', 'foe'), 5, TRUE))\n\n\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(arrow = arrow(length = unit(4, 'mm'))) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\nCode\n\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(arrow = arrow(length = unit(4, 'mm')), \n                 end_cap = circle(3, 'mm')) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\nCode\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(aes(start_cap = label_rect(node1.name),\n                     end_cap = label_rect(node2.name)), \n                 arrow = arrow(length = unit(4, 'mm'))) + \n  geom_node_text(aes(label = name))\n\n\n\n\n\n\n\n\n\nCodeggraph(simple, layout = 'graphopt') + \n  geom_edge_link(aes(label = type), \n                 arrow = arrow(length = unit(4, 'mm')), \n                 end_cap = circle(3, 'mm')) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\nCode\nggraph(simple, layout = 'graphopt') + \n  geom_edge_link(aes(label = type), \n                 angle_calc = 'along',\n                 label_dodge = unit(2.5, 'mm'),\n                 arrow = arrow(length = unit(4, 'mm')), \n                 end_cap = circle(3, 'mm')) + \n  geom_node_point(size = 5)\n\n\n\n\n\n\n\n\n\nCodeflaregraph &lt;- tbl_graph(flare$vertices, flare$edges)\nfrom &lt;- match(flare$imports$from, flare$vertices$name)\nto &lt;- match(flare$imports$to, flare$vertices$name)\nggraph(flaregraph, layout = 'dendrogram', circular = TRUE) + \n  geom_conn_bundle(data = get_con(from = from, to = to), alpha = 0.1) + \n  coord_fixed()",
    "crumbs": [
      "ggplot2 图形",
      "Relationship",
      "网络图"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html",
    "href": "ggplot2_graphics.html",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "ggplot2: Elegant Graphics for Data Analysis (3e)\ngg 为 grammar of graphics 的缩写。\nggplot(data =  ,mapping = aes(x,y,…))\n创建一个基础图形对象gg，空白图层 + 数据集 + 美学映射。\n\n\nCodelibrary(tidyverse)\n#&gt; Warning: package 'purrr' was built under R version 4.5.2\n#&gt; Warning: package 'stringr' was built under R version 4.5.2\n#&gt; Warning: package 'forcats' was built under R version 4.5.2\n#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.6\n#&gt; ✔ forcats   1.0.1     ✔ stringr   1.6.0\n#&gt; ✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n#&gt; ✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n#&gt; ✔ purrr     1.2.0     \n#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#&gt; ✖ dplyr::filter() masks stats::filter()\n#&gt; ✖ dplyr::lag()    masks stats::lag()\n#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\nlibrary(patchwork)\n#&gt; Warning: package 'patchwork' was built under R version 4.5.2\ndf &lt;- tibble(\n    index = 1:26,\n    pch = 0:25,\n    type = c( rep(\"hollow_color\",15),rep(\"soild_color\",6),rep(\"fill_color\",5)),\n    height = rep(c(1,2,3), times = c(15,6,5)),\n    \n)\n\n\n\nmapping=aes(x,y,z,..,color,fill,shape,size,group,linewidth,linetype,alpha,...)\n\nCodeggplot(data = df,\n       mapping = aes(x = index, y = pch ))\n\n\n\n\n\n\n\n\n\n\n图形基元（Graphical primitives）:\n\ngeom_blank(): display nothing. Most useful for adjusting axes limits using data.\ngeom_point(): points.\ngeom_path(): paths.\ngeom_ribbon(): ribbons, a path with vertical thickness.\ngeom_segment(): a line segment, specified by start and end position.\ngeom_rect(): rectangles.\ngeom_polygon(): filled polygons.\ngeom_text(): text.\n\n\n\n\nCodedf &lt;- data.frame(\n  x = c(3, 1, 5), \n  y = c(2, 4, 6), \n  label = c(\"a\",\"b\",\"c\")\n)\n\np &lt;- ggplot(df, aes(x, y, label = label)) + \n  labs(x = NULL, y = NULL) + # Hide axis label\n  theme(plot.title = element_text(size = 12)) # Shrink plot title\n\n(p + geom_point() + ggtitle(\"point\") +\n        p + geom_text() + ggtitle(\"text\") +\n        p + geom_bar(stat = \"identity\") + ggtitle(\"bar\") )/\n(p + geom_tile() + ggtitle(\"tile\") +\n     p + geom_raster() + ggtitle(\"raster\")+\n     p + geom_line() + ggtitle(\"line\")) /\n(p + geom_area() + ggtitle(\"area\") +\n    p + geom_path() + ggtitle(\"path\") +\n    p + geom_polygon() + ggtitle(\"polygon\"))\n\n\n\n\n\n\n\n\n\nOne variable:\n\n\nDiscrete:\n\n\ngeom_bar(): display distribution of discrete variable.\n\n\n\nContinuous:\n\ngeom_histogram(): bin and count continuous variable, display with bars.\ngeom_density(): smoothed density estimate.\ngeom_dotplot(): stack individual points into a dot plot.\ngeom_freqpoly(): bin and count continuous variable, display with lines.\n\n\n\n\n\nTwo variables:\n\n\nBoth continuous:\n\ngeom_point(): scatterplot.\ngeom_quantile(): smoothed quantile regression.\ngeom_rug(): marginal rug plots.\ngeom_smooth(): smoothed line of best fit.\ngeom_text(): text labels.\n\n\n\nShow distribution:\n\ngeom_bin2d(): bin into rectangles and count.\ngeom_density2d(): smoothed 2d density estimate.\ngeom_hex(): bin into hexagons and count.\n\n\n\nAt least one discrete:\n\ngeom_count(): count number of point at distinct locations\ngeom_jitter(): randomly jitter overlapping points.\n\n\n\nOne continuous, one discrete:\n\ngeom_bar(stat = \"identity\"): a bar chart of precomputed summaries.\ngeom_boxplot(): boxplots.\ngeom_violin(): show density of values in each group.\n\n\n\nOne time, one continuous:\n\ngeom_area(): area plot.\ngeom_line(): line plot.\ngeom_step(): step plot.\n\n\n\nDisplay uncertainty:\n\ngeom_crossbar(): vertical bar with center.\ngeom_errorbar(): error bars.\ngeom_linerange(): vertical line.\ngeom_pointrange(): vertical line with center.\n\n\n\nSpatial:\n\n\ngeom_map(): fast version of for map data.\n\n\n\n\n\nThree variables:\n\ngeom_contour(): contours.\ngeom_tile(): tile the plane with rectangles.\ngeom_raster(): fast version of for equal sized tiles.\n\n\n\n\n\n\nCodeggplot(data = mpg) + \n    geom_point(mapping = aes(x=displ,y=hwy),\n               stat = \"identity\",position = \"identity\")\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(displ,hwy)) +\n    geom_point() |\n    \n    ggplot(mpg, aes(displ,hwy)) +\n    geom_point(aes(size = displ/10)) + \n    scale_size_area(name=\"displ/10\")\n\n\n\n\n\n\n\n\n\nCodeeconomics |&gt; head()\n#&gt; # A tibble: 6 × 6\n#&gt;   date         pce    pop psavert uempmed unemploy\n#&gt;   &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;\n#&gt; 1 1967-07-01  507. 198712    12.6     4.5     2944\n#&gt; 2 1967-08-01  510. 198911    12.6     4.7     2945\n#&gt; 3 1967-09-01  516. 199113    11.9     4.6     2958\n#&gt; 4 1967-10-01  512. 199311    12.9     4.9     3143\n#&gt; 5 1967-11-01  517. 199498    12.8     4.7     3066\n#&gt; 6 1967-12-01  525. 199657    11.8     4.8     3018\n\nggplot(economics,aes(date,pop))+\n    geom_line()+\n    scale_x_date()\n\n\n\n\n\n\n\n\n\nCodeq &lt;- ggplot(mpg, aes(displ, hwy)) +\n    geom_point()\n\nq+geom_smooth(method = \"loess\",span = 0.2,se=T) # loess 平滑局部回归   small n\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\nCode                                   #span 0非常摆动，1不那么摆动\n\nq+ geom_smooth(span = 1)  #不很摆动\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\nlibrary(MASS)\n#&gt; \n#&gt; Attaching package: 'MASS'\n#&gt; \n#&gt; The following object is masked from 'package:patchwork':\n#&gt; \n#&gt;     area\n#&gt; \n#&gt; The following object is masked from 'package:dplyr':\n#&gt; \n#&gt;     select\nq+geom_smooth(method = \"rlm\")   # robust linear model  稳健线性模型\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\nCode\nlibrary(mgcv)\n#&gt; Warning: package 'mgcv' was built under R version 4.5.2\n#&gt; Loading required package: nlme\n#&gt; \n#&gt; Attaching package: 'nlme'\n#&gt; \n#&gt; The following object is masked from 'package:dplyr':\n#&gt; \n#&gt;     collapse\n#&gt; \n#&gt; This is mgcv 1.9-4. For overview type '?mgcv'.\nq+ geom_smooth(method = \"gam\", formula = y ~ s(x)) # gam 广义相加模型   n&gt;1000\n\n\n\n\n\n\n\n\nCodebinomial_smooth &lt;- function(...) {\n  geom_smooth(method = \"glm\", method.args = list(family = \"binomial\"), ...)\n}\n\n\n\nggplot(rpart::kyphosis,aes(Age,as.numeric(Kyphosis)-1))+\n    geom_point()+\n    binomial_smooth()\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(hwy)) + geom_histogram(binwidth = 2.5)\n\n\n\n\n\n\nCode\n\nggplot(mpg, aes(hwy)) +\n  geom_histogram(binwidth = 1) |\nggplot(mpg, aes(hwy)) +\n  geom_histogram(aes(weight = displ), binwidth = 1) # 加权\n\n\n\n\n\n\nCode\nggplot(data = mpg) + \n    geom_histogram(aes(x=displ,y=after_stat(density)),\n                   stat = \"bin\",position = \"stack\",\n                   binwidth = 0.5\n                   ) +\n    scale_y_continuous(labels=scales::percent) +\n    geom_density(aes(x=displ,y=after_stat(density)),\n                 color=\"red\", linewidth=1)\n\n\n\n\n\n\n\n\n\nCodesmaller &lt;- diamonds |&gt; \n  dplyr::filter(carat &lt; 3)\nggplot(smaller, aes(x = carat, y = price)) +\n  geom_bin2d()\n#&gt; `stat_bin2d()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCode\n# install.packages(\"hexbin\")\nggplot(smaller, aes(x = carat, y = price)) +\n  geom_hex()\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(hwy)) + \n  geom_freqpoly(binwidth = 2.5)\n\n\n\n\n\n\n\n\n\nCode\np &lt;- ggplot(data = mpg)\np + geom_density(aes(displ,fill=drv),\n                 stat = \"density\",position = \"identity\",\n                 alpha=0.3\n                 )+\n    scale_y_continuous(labels = scales::percent)+\n    labs(fill=\"图例名\")+\n    theme(legend.position = \"top\")\n\n\n\n\n\n\n\n\ny→sides=\"r\",\"l\"\nx→sides=\"b\",\"t\"\n\nCodep + geom_rug(aes(x=displ,y=hwy),\n           sides = \"br\",color=\"brown\")\n\n\n\n\n\n\n\n\n\nCodep + geom_jitter(mapping = aes(x=displ,y=hwy),\n               stat = \"identity\",position = \"jitter\")\n\n\n\n\n\n\n\n\n\n\nCodeggplot(data = mpg) + \n    geom_bar(mapping = aes(x=factor(cyl),fill=drv),\n             stat = \"count\",position = \"stack\") |\nggplot(data = mpg) + \n    geom_bar(mapping = aes(x=factor(cyl),fill=drv),\n             position = \"dodge\")\n\n\n\n\n\n\nCode\n\nggplot(data = mpg) + \n    geom_col(mapping = aes(x=factor(cyl),y=hwy,fill=drv),\n             position = \"stack\") |\n\nggplot(data = mpg) + \n    geom_col(mapping = aes(x=factor(cyl),y=hwy,fill=drv),\n             position = \"fill\")+\n    scale_y_continuous(labels = scales::label_percent())\n\n\n\n\n\n\n\n有序条形图\n\nCodeggplot(mpg, aes(x = fct_infreq(class))) +  #降序条形图\n  geom_bar()\n\n\n\n\n\n\n\n\n\ngeom_errorbarh\ngeom_linerange\ngeom_crossbar\ngeom_pointrange\n\n\nCodey &lt;- c(18, 11, 16)\ndf &lt;- data.frame(x = 1:3, y = y, se = c(1.2, 0.5, 1.0))\n\nbase &lt;- ggplot(df, aes(x, y, ymin = y - se, ymax = y + se))\n(base + geom_errorbar()|\nbase + geom_linerange()|\nbase + geom_ribbon())/\n(base + geom_crossbar()|\nbase + geom_pointrange()|\nbase + geom_smooth(stat = \"identity\"))\n\n\n\n\n\n\n\n\nCoderead_csv(\"data/g.csv\") |&gt; \n    summarise(\n        mean=mean(liverweight),\n        sd=sd(liverweight),\n        .by=treatment\n  ) |&gt; \n    ggplot(aes(treatment,mean,fill=treatment))+\n    geom_bar(stat = \"identity\")+\n    geom_errorbar(aes(ymin=mean-sd,ymax=mean+sd),width=.2)\n#&gt; Rows: 20 Columns: 2\n#&gt; ── Column specification ────────────────────────────────────────────────────────\n#&gt; Delimiter: \",\"\n#&gt; chr (1): treatment\n#&gt; dbl (1): liverweight\n#&gt; \n#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.\n#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg)+geom_dotplot(mapping = aes(x=drv,y=hwy),\n                 position = \"identity\",\n                 stackdir = \"center\",binaxis = 'y',# stacking along y axis\n                 fill=\"red\",binwidth = 0.7)\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg) + geom_boxplot(mapping = aes(x=drv,y=hwy),\n             stat = \"boxplot\",position = \"dodge\",\n             notch=TRUE, varwidth=TRUE,\n             width=0.1,fill=\"green\"\n            )+\n    geom_violin(aes(x=drv,y=hwy),alpha=0.2)\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg) + geom_violin(mapping = aes(x=drv,y=hwy),\n             stat = \"ydensity\",position = \"dodge\")\n\n\n\n\n\n\n\n\n\nCode# 设置随机数种子以确保结果的可重复性  \nset.seed(10)  \n  \n# 生成随机数据集  \nmydata &lt;- tibble(  \n  year = 2000:2024,  \n  lung = runif(25),  \n  liver = runif(25), \n  bone = runif(25),  \n  luk = runif(25),  \n  eso = runif(25),  \n  gas = runif(25),   \n  eye = runif(25),  \n  brain = runif(25),  \n  pan = runif(25),  \n  kidney = runif(25),  \n  breast= runif(25),  \n)  |&gt; pivot_longer(cols = -1,\n                   names_to = \"cancer\",\n                   values_to = \"morbidity\")\n\nggplot(mydata, aes(year, cancer)) +  \n  geom_tile(aes(fill =morbidity)) +  \n  scale_fill_gradient(low = \"white\", high = \"red\")\n\n\n\n\n\n\n\n\nstat_bin()：geom_bar()，geom_freqpoly()，geom_histogram()\nstat_bin2d()：geom_bin2d()\nstat_bindot()：geom_dotplot()\nstat_binhex()：geom_hex()\nstat_boxplot()：geom_boxplot()\nstat_contour()：geom_contour()\nstat_quantile()：geom_quantile()\nstat_smooth()：geom_smooth()\nstat_sum()：geom_count()\nstat_ecdf()：计算经验累积分布图。\nstat_function()：根据 x 值的函数计算 y 值。\nstat_summary()：将 Y 值汇总到不同的 X 值。\n\nCodemtcars |&gt; \n    ggplot(aes(x = factor(am) , y= mpg))+\n    stat_summary(geom = \"bar\",fun = mean)\n\n\n\n\n\n\n\n\nCodeggplot(diamonds) + \n  stat_summary(\n    aes(x = cut, y = depth),\n    geom = \"errorbar\",\n    fun.min = min,\n    fun.max = max,\n    fun = mean\n  )\n\n\n\n\n\n\nCode\nggplot(mpg, aes(trans, cty)) + \n    geom_point() + \n    stat_summary(geom = \"point\", fun = \"mean\", colour = \"red\", size = 4)\n\n\n\n\n\n\n\nstat_summary2d() ：汇总分箱值。\nstat_summary_hex()\nstat_qq()：对分位数-分位数图执行计算。\nstat_spoke()：将角度和半径转换为位置。\nstat_unique()：删除重复的行。\n\n\n\nCodeggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(alpha = 1/5, position = \"identity\")|\n\nggplot(mpg, aes(x = drv, color = class)) + \n  geom_bar(fill = NA, position = \"identity\")\n\n\n\n\n\n\nCode\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(position = \"fill\")|\n\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(position = \"dodge\")\n\n\n\n\n\n\n\n\nposition_nudge()：按固定偏移量移动点。\nposition_jitter()：为每个位置添加一点随机噪音。\nposition_jitterdodge()：躲避组内的点，然后添加一点随机噪音。\n\nCodeggplot(mpg, aes(x = factor(cyl), y = hwy)) + \n  geom_point(position = \"identity\") |\nggplot(mpg, aes(x = factor(cyl), y = hwy)) + \n  geom_point(position = \"jitter\")\n\n\n\n\n\n\nCode\nggplot(mpg, aes(x = factor(cyl), y = hwy)) + \n  geom_point(position =position_nudge(x=0.1,y=0))|\nggplot(mpg, aes(x = factor(cyl), y = hwy,color=factor(cyl))) + \n  geom_point(position = position_jitterdodge())\n\n\n\n\n\n\n\n\n\n\nArgument name\nAxis\nLegend\n\n\n\nname\nLabel\nTitle\n\n\nbreaks\nTicks & grid line\nKey\n\n\nlabels\nTick label\nKey label\n\n\n\n\n\n\n\nCodeshape_names &lt;- c(\n  \"circle\", paste(\"circle\", c(\"open\", \"filled\", \"cross\", \"plus\", \"small\")), \"bullet\",\n  \"square\", paste(\"square\", c(\"open\", \"filled\", \"cross\", \"plus\", \"triangle\")),\n  \"diamond\", paste(\"diamond\", c(\"open\", \"filled\", \"plus\")),\n  \"triangle\", paste(\"triangle\", c(\"open\", \"filled\", \"square\")),\n  paste(\"triangle down\", c(\"open\", \"filled\")),\n  \"plus\", \"cross\", \"asterisk\"\n)\n\nshapes &lt;- data.frame(\n  shape_names = shape_names,\n  x = c(1:7, 1:6, 1:3, 5, 1:3, 6, 2:3, 1:3),\n  y = -rep(1:6, c(7, 6, 4, 4, 2, 3))\n)\n\nggplot(shapes, aes(x, y)) +\n  geom_point(aes(shape = shape_names), fill = \"red\", size = 5) +\n  geom_text(aes(label = shape_names), nudge_y = -0.3, size = 3.5) +\n  scale_shape_identity() +\n  theme_void()\n\n\n\n\n\n\n\n\n填充颜色，形状（ggpattern）\n\nCode# library(grid)\n# library(scales)\n\n\n\n\nCodeggplot(mpg, aes(log10(cty),hwy)) +\n    geom_point()+\n    scale_x_log10()\n\n\n\n\n\n\n\n\nCodeggplot(mtcars, aes(x = wt, y = mpg)) + \n  geom_point() +\n  scale_x_continuous(name = \"Weight (1000 lbs.)\",   \n                     n.breaks = 10,                 \n                     minor_breaks = NULL,           \n                     limits = c(1.5, 5.5)) +        \n  scale_y_continuous(name = \"Miles per gallon\",     \n                     breaks = seq(10, 35, 5),       \n                     minor_breaks = seq(10, 35, 1), \n                     limits = c(10, 35)) +          \n  labs(title = \"Fuel efficiency by car weight\")\n\n\n\n\n\n\n\n\nCodeggplot(diamonds, aes(x = price, y = cut)) +\n  geom_boxplot(alpha = 0.05) +\n  scale_x_continuous(labels = scales::label_dollar(scale = 1/1000, suffix = \"K\"))\n\n\n\n\n\n\nCode\nggplot(diamonds, aes(x = cut, fill = clarity)) +\n  geom_bar(position = \"fill\") +\n  scale_y_continuous(name = \"Percentage\", labels = scales::label_percent())\n\n\n\n\n\n\n\n\nCodeggplot(mpg,aes(x=factor(drv),fill=class))+\n    geom_bar(position = \"fill\") -&gt;p\np | p + scale_x_discrete(name = \"drv\",                                  \n                   limits = c(\"f\", \"r\"),    \n                   labels = c('f'=\"drv='f'\",'r'= \"drv='r'\"),\n                   position = \"top\") \n#&gt; Warning: Removed 103 rows containing non-finite outside the scale range\n#&gt; (`stat_count()`).\n\n\n\n\n\n\n\n\n默认坐标系是笛卡尔坐标系\n\nCodebar &lt;- ggplot(data = diamonds) + \n  geom_bar(\n    mapping = aes(x = clarity, fill = clarity), \n    show.legend = FALSE,\n    width = 1\n  ) + \n  theme(aspect.ratio = 1)\nbar\n\n\n\n\n\n\nCodebar + coord_cartesian() |#笛卡尔坐标\nbar + coord_flip()| #水平条形图\nbar + coord_polar()#极坐标\n\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(displ, hwy)) +\n    geom_point(na.rm = TRUE) | \nggplot(mpg, aes(displ, hwy)) +\n    geom_point(na.rm = TRUE) +\n    xlim(5, 6) +\n    ylim(10, 25)\n\n\n\n\n\n\nCode\nggplot(mpg, aes(drv, hwy)) +\n    geom_jitter(width = 0.25, na.rm = TRUE) +\n    xlim(\"f\", \"r\") +\n    ylim(25, NA)\n\n\n\n\n\n\n\n\nCode# filter\nmpg |&gt;\n  dplyr::filter(displ &gt;= 5 & displ &lt;= 6 & hwy &gt;= 10 & hwy &lt;= 25) |&gt;\n  ggplot(aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth(na.rm=TRUE)|\n# limits\nggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth(na.rm=TRUE) +\n  scale_x_continuous(limits = c(5, 6)) +    #取子集\n  scale_y_continuous(limits = c(10, 25))  \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n#&gt; Warning: Removed 202 rows containing missing values or values outside the scale range\n#&gt; (`geom_point()`).\n\n\n\n\n\n\n\n\n\nCode\n# Sample data\nx &lt;- droplevels(chickwts$feed[1:36])\nlevels(x) &lt;- LETTERS[1:3]\ny &lt;- chickwts$weight[1:36]\ndf &lt;- data.frame(x = x, y = y)\n\n# Plot\np &lt;- ggplot(df, aes(x = x, y = y)) + \n      stat_boxplot(geom = \"errorbar\",\n                   width = 0.25) +\n      geom_boxplot(fill = \"dodgerblue1\",\n                   colour = \"black\",\n                   alpha = 0.5,\n                   outlier.colour = \"tomato2\")\np|p + \n  theme(axis.ticks.length  = unit(0.5, \"cm\")) + \n  theme(axis.ticks = element_line(color = 2,\n                                  linewidth = 2))\n\n\n\n\n\n\n\n\n调整绘制的数据,在每个刻度中设置coord_cartesian(xlim= ,ylim= )\n\nCodeggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth() |\n    ggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth()+\n  coord_cartesian(xlim = c(5, 6), ylim = c(10, 25))   #放大局部\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\np + \n   coord_cartesian(ylim = c(100, 200)) \n\n\n\n\n\n\n\n\n\nCodep + \n  expand_limits(x = 0, y = 0) \n\n\n\n\n\n\nCodep + \n  theme(axis.line = element_line(arrow = arrow(angle = 30,\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"))) \n\n\n\n\n\n\n\n\n\nCodeggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(trans = ~.* 2, name = \"Z-axis title\")) \n#&gt; Warning: The `trans` argument of `sec_axis()` is deprecated as of ggplot2 3.5.0.\n#&gt; ℹ Please use the `transform` argument instead.\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\n\n# 次轴   breaks\n\nggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(~.* 2, name = \"Z-axis title\",\n                                         breaks = c(100, 200, 300))) \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode# 次轴    labels\nggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(~.* 2, name = \"Z-axis title\",\n                                         breaks = c(100, 200, 300),\n                                         labels = c(\"A\", \"B\", \"C\"))) \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\n\n\nggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(~.* 2, name = \"Z-axis title\")) + \n  theme(axis.title.y.right = element_text(color = \"red\", \n                                          size = 15,\n                                          face = \"bold\"),\n        axis.text.y.right = element_text(color = \"blue\", size = 10),\n        axis.line.y.right = element_line(color = \"orange\")) \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\nshared 坐标轴相同\n\nCodex_scale &lt;- scale_x_continuous(limits = range(mpg$displ))\ny_scale &lt;- scale_y_continuous(limits = range(mpg$hwy))\ncol_scale &lt;- scale_color_discrete(limits = unique(mpg$drv))\nggplot(mpg[mpg$class==\"suv\",], aes(x = displ, y = hwy, color = drv)) +\n  geom_point() +\n  x_scale +\n  y_scale +\n  col_scale|\nggplot(mpg[mpg$class==\"compact\",], aes(x = displ, y = hwy, color = drv)) +\n  geom_point() +\n  x_scale +\n  y_scale +\n  col_scale\n\n\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(cty, hwy)) +\n    geom_point(alpha = 1 / 3) +\n    xlab(\"city driving (mpg)\") +\n    ylab(\"highway driving (mpg)\")+\n    ggtitle(label = \"主标题\",\n            subtitle = \"副标题\")+\n     theme(plot.title.position = \"panel\") # 默认\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = class)) +\n  geom_smooth(se = FALSE) +\n  labs(\n    title = \"Fuel efficiency generally decreases with engine size\",\n    subtitle = \"Two seaters (sports cars) are an \n    exception because of their light weight\",\n    caption = \"Data from fueleconomy.gov\",\n    tag = \"Fig. 1\",\n    x = \"Engine displacement (L)\",\n    y = \"Highway fuel economy (mpg)\",\n    color = \"Car type\", # 图例 美学映射color\n  )+\n    theme(plot.title.position = \"plot\",# 相对于整个绘图进行设置\n          plot.caption.position = \"plot\",\n          plot.tag.position = \"topleft\",\n        plot.caption = element_text(hjust = 0))  \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\nCodeggplot(economics, aes(date, unemploy)) +\n  geom_area(fill = rgb(0, 0.5, 1, alpha = 0.5)) + \n  labs(title = \"Title of the plot\",\n       subtitle = \"Subtitle of the plot\",\n       caption = \"This is the caption\",\n       tag = \"Fig. 1\") + \n  theme(plot.title = element_text(family = \"serif\",              # Font family\n                                  face = \"bold\",                 # Font face\n                                  color = 4,                     # Font color\n                                  size = 15,                     # Font size\n                                  hjust = 1,             # Horizontal adjustment\n                                  vjust = 1,             # Vertical adjustment\n                                  angle = -10,                   # Font angle\n                                  lineheight = 1,                # Line spacing\n                                  margin = margin(20, 0, 0, 0)), # Margins (t, r, b, l)\n        plot.subtitle = element_text(hjust = 0),    # Subtitle customization\n        plot.caption = element_text(hjust = 0.25),  # Caption customization\n        plot.tag = element_text(face = \"italic\"),   # Tag customization\n        plot.title.position = \"plot\",               # Title and subtitle position (\"plot\" or \"panel\")\n        plot.caption.position = \"panel\",            # Caption position (\"plot\" or \"panel\")\n        plot.tag.position = \"top\")                  # Tag position\n\n\n\n\n\n\n\n\n\n\nCode# 字体 样式\ndf &lt;- data.frame(x = 1:3, y = 1:3, \n                 family = c(\"sans\", \"serif\", \"mono\"),\n                 face = c(\"plain\", \"bold\", \"italic\"))\nggplot(df, aes(x, y)) + \n  geom_text(mapping = aes(label = paste0(family,\": \",face), \n                          family = family, fontface = face),\n            vjust = \"inward\", hjust = \"inward\")\n\n\n\n\n\n\nCode\n# 位置\ndf &lt;- data.frame(\n  x = c(1, 1, 2, 2, 1.5),\n  y = c(1, 2, 1, 2, 1.5),\n  text = c(\n    \"bottom-left\", \"top-left\",  \n    \"bottom-right\", \"top-right\", \"center\"\n  )\n)\nggplot(df, aes(x, y)) +\n  geom_text(aes(label = text), vjust = \"inward\", hjust = \"inward\")\n\n\n\n\n\n\nCode\n\n# 自定义\ndf &lt;- data.frame(\n  treatment = c(\"a\", \"b\", \"c\"), \n  response = c(1.2, 3.4, 2.5)\n)\nggplot(df, aes(treatment, response)) + \n  geom_point() + \n  geom_text(\n    mapping = aes(label = paste0(\"(\", response, \")\")), \n    nudge_x = -0.3,\n    nudge_y=.2\n  ) \n\n\n\n\n\n\n\n\nCodelabel_info &lt;- mpg |&gt;\n    group_by(drv) |&gt;\n    arrange(desc(displ)) |&gt;\n    slice_head(n = 1)|&gt;\n    mutate(\n        drive_type = case_when(       # vectorise multiple if_else () statements \n        drv == \"f\" ~ \"front-wheel drive\",\n        drv == \"r\" ~ \"rear-wheel drive\",\n        drv == \"4\" ~ \"4-wheel drive\")\n        )|&gt;\n    dplyr::select(displ, hwy, drv, drive_type)\n\np &lt;-ggplot(mpg, aes(x = displ, y = hwy, color = drv)) +\n    geom_point(alpha = 0.3) +\n    geom_smooth(method=\"lm\",formula=\"y~x\",se = FALSE) +\n    theme(legend.position = \"none\")\n\np+  geom_text(#添加注释  geom_label 标签加背景框\n    data = label_info, \n    aes(x = displ, y = hwy, label = drive_type),#label映射\n    fontface = \"bold\", size = 5, nudge_y = 2\n    )\n\n\n\n\n\n\nCode\np + ggrepel::geom_label_repel(                   \n    data = label_info, \n    aes(x = displ, y = hwy, label = drive_type),\n    fontface = \"bold\", size = 5, nudge_y = 2\n  ) \n\n\n\n\n\n\nCode\n\npotential_outliers &lt;- mpg |&gt;\n  dplyr::filter(hwy &gt; 40 | (hwy &gt; 20 & displ &gt; 5))\n\nggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point() +\n  ggrepel::geom_text_repel(data = potential_outliers, aes(label = model)) +\n  geom_point(data = potential_outliers, color = \"red\") +\n  geom_point(\n    data = potential_outliers,\n    color = \"red\", size = 3, shape = \"circle open\"\n  )\n\n\n\n\n\n\n\n\ngeom_hline()\ngeom_vline()\ngeom_abline\ngeom_segment() arrow\n\nCodetrend_text &lt;- \"Larger engine sizes tend to have lower fuel economy.\" |&gt;\n  str_wrap(width = 30)\ntrend_text\n#&gt; [1] \"Larger engine sizes tend to\\nhave lower fuel economy.\"\nggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point() +\n  annotate(\n    geom = \"label\", x = 3.5, y = 38,\n    label = trend_text,\n    hjust = \"left\", color = \"red\"\n  ) +\n  annotate(\n    geom = \"segment\",\n    x = 3, y = 35, xend = 5, yend = 25, color = \"red\",\n    arrow = arrow(type = \"closed\")\n  )\n\n\n\n\n\n\n\n\nCodep &lt;- ggplot(mpg, aes(displ, hwy)) +\n  geom_point(\n    data = dplyr::filter(mpg, manufacturer == \"subaru\"), \n    colour = \"orange\",\n    size = 3\n  ) +\n  geom_point() \np|p + \n  annotate(geom = \"point\", x = 5.5, y = 40, colour = \"orange\", size = 3) + \n  annotate(geom = \"point\", x = 5.5, y = 40) + \n  annotate(geom = \"text\", x = 5.6, y = 40, label = \"subaru\", hjust = \"left\")|\np + \n  annotate(\n    geom = \"curve\", x = 4, y = 35, xend = 2.65, yend = 27, \n    curvature = .3, arrow = arrow(length = unit(2, \"mm\"))\n  ) +\n  annotate(geom = \"text\", x = 4.1, y = 35, label = \"subaru\", hjust = \"left\")\n\n\n\n\n\n\n\n\n\nCodedf &lt;- data.frame(x = 1:3, y = 1:3)\nbase &lt;- ggplot(df, aes(x, y)) + \n  geom_point() + \n  labs(x = \"Axis title with *italics* and **bold**\")\n\n\nlibrary(ggtext)\nbase |\nbase + \n  geom_richtext(aes(x = 2, y = 3,\n                    label =  \"**title** of &lt;span style = 'color:red'&gt;xy&lt;/span&gt;\"),\n                angle =-25)  + theme(axis.title.x = ggtext::element_markdown()) \n#&gt; Warning in geom_richtext(aes(x = 2, y = 3, label = \"**title** of &lt;span style = 'color:red'&gt;xy&lt;/span&gt;\"), : All aesthetics have length 1, but the data has 3 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n\n\n\n\n\n\n\n\n?plotmath\n\nCode\ntibble(\n  x = 1:10,\n  y = cumsum(x^2)) %&gt;% \n  ggplot(aes(x, y)) +\n  geom_point() +\n  labs(\n    x = quote(x[i]),\n    y = quote(sum(x[i] ^ 2, i == 1, n)) #数学方程式\n  )\n\n\n\n\n\n\nCode\nvalues &lt;- seq(from = -2, to = 2, by = .01)\ndf &lt;- tibble(x = values, y = values ^ 3)\nggplot(df, aes(x, y)) + \n  geom_path() + \n  labs(y = quote(f(x) == x^3))         #数学表达式   ？plotmath\n\n\n\n\n\n\n\n\n\nCodeq &lt;- ggplot(mpg,aes(x=displ))+\n  geom_histogram(fill=\"lightblue\")\n\n# 一个分类变量\nq + facet_wrap(~drv,nrow = 3)\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCodeq + facet_wrap(~drv,ncol = 3)  #\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCode\n# 多个分类变量\nq + facet_grid(drv~class)\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCodeq + facet_grid(drv~.)\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCodeq + facet_grid(.~drv)   #\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  facet_grid(drv ~ cyl) |\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  facet_grid(drv ~ cyl, scales = \"free_y\")\n\n\n\n\n\n\n\n\nplot, axis, legend, panel and facet\n\n\n\nElement\nSetter\nDescription\n\n\n\nplot.background\nelement_rect()\nplot background\n\n\nplot.title\nelement_text()\nplot title\n\n\nplot.margin\nmargin()\nmargins around plot\n\n\n\n\n\n\n\n\n\n\n\npanel.background\nelement_rect()\npanel background (under data)\n\n\npanel.border\nelement_rect()\npanel border (over data)\n\n\npanel.grid.major\nelement_line()\nmajor grid lines\n\n\npanel.grid.major.x\nelement_line()\nvertical major grid lines\n\n\npanel.grid.major.y\nelement_line()\nhorizontal major grid lines\n\n\npanel.grid.minor\nelement_line()\nminor grid lines\n\n\npanel.grid.minor.x\nelement_line()\nvertical minor grid lines\n\n\npanel.grid.minor.y\nelement_line()\nhorizontal minor grid lines\n\n\naspect.ratio\nnumeric\nplot aspect ratio\n\n\n\n\nCodelibrary(ggplot2)\n\nbase &lt;- ggplot() +\n  stat_function(fun = dnorm, geom = \"density\",\n                xlim = c(-4, 4),\n                fill = rgb(0, 0, 1, 0.1))\n\n\nbase + theme(\n    plot.background = element_rect(\n        colour = \"red\",\n        fill = \"lightblue\",\n        # 默认 fill = NA\n        linewidth = 2,\n    ),\n    plot.margin = margin(\n        t = 2,\n        # Top margin\n        r = 2,\n        # Right margin\n        b = 2,\n        # Bottom margin\n        l = 2\n    )# Left margin\n) +  theme(\n    panel.background = element_rect(fill = \"lightyellow\"),\n    panel.grid.major.y = element_line(color = \"green\", linewidth = 0.8),\n    panel.grid.major.x = element_line(color = \"purple\", linewidth = 0.8))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nElement\nSetter\nDescription\n\n\n\nlegend.background\nelement_rect()\nlegend background\n\n\nlegend.key\nelement_rect()\nbackground of legend keys\n\n\nlegend.key.size\nunit()\nlegend key size\n\n\nlegend.key.height\nunit()\nlegend key height\n\n\nlegend.key.width\nunit()\nlegend key width\n\n\nlegend.margin\nunit()\nlegend margin\n\n\nlegend.text\nelement_text()\nlegend labels\n\n\nlegend.text.align\n0–1\nlegend label alignment (0 = right, 1 = left)\n\n\nlegend.title\nelement_text()\nlegend name\n\n\nlegend.title.align\n0–1\nlegend name alignment (0 = right, 1 = left)\n\n\n\n\nCodedf &lt;- data.frame(x = 1:4, y = 1:4, z = rep(c(\"a\", \"b\"), each = 2))\nbase &lt;- ggplot(df, aes(x, y, colour = z)) + geom_point()\n\nbase + theme(\n  legend.background = element_rect(\n    fill = \"lemonchiffon\", \n    colour = \"grey50\", \n    linewidth = 1\n  )\n)\n\n\n\n\n\n\nCodebase + theme(\n  legend.key = element_rect(color = \"grey50\"),\n  legend.key.width = unit(0.9, \"cm\"),\n  legend.key.height = unit(0.75, \"cm\")\n)\n\n\n\n\n\n\nCodebase + theme(\n  legend.text = element_text(size = 15),\n  legend.title = element_text(size = 15, face = \"bold\")\n)\n\n\n\n\n\n\nCode\nbase + \n  theme(legend.position = \"top\") +\n  guides(color = guide_legend(nrow = 3))\n\n\n\n\n\n\nCodebase + \n  theme(legend.position = \"bottom\") +\n  guides(color = guide_legend(nrow = 2, override.aes = list(size = 4)))\n\n\n\n\n\n\nCode\n# 文本\n\nggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +\n  geom_point(size=3) +\n  scale_color_discrete(name=\"Cylinders\") +\n  theme(legend.position = c(.95, .95),\n        legend.justification = c(1, 1),\n        legend.background = element_rect(fill = \"lightgrey\",\n                                         color = \"white\",\n                                         linewidth = 1),\n        legend.key = element_blank(),\n        legend.direction = \"horizontal\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nElement\nSetter\nDescription\n\n\n\naxis.line\nelement_line()\nline parallel to axis (hidden in default themes)\n\n\naxis.text\nelement_text()\ntick labels\n\n\naxis.text.x\nelement_text()\nx-axis tick labels\n\n\naxis.text.y\nelement_text()\ny-axis tick labels\n\n\naxis.title\nelement_text()\naxis titles\n\n\naxis.title.x\nelement_text()\nx-axis title\n\n\naxis.title.y\nelement_text()\ny-axis title\n\n\naxis.ticks\nelement_line()\naxis tick marks\n\n\naxis.ticks.length\nunit()\nlength of tick marks\n\n\n\n\nCodefindfont &lt;- function(x){\n  suppressMessages(require(showtext))\n  suppressMessages(require(dplyr))\n  dplyr::filter(font_files(), grepl(x, family, ignore.case=TRUE)) |&gt; \n    dplyr::select(path, file, family, face)\n}\n\nfindfont(\"comic\")\n#&gt;               path        file        family        face\n#&gt; 1 C:/Windows/Fonts   comic.ttf Comic Sans MS     Regular\n#&gt; 2 C:/Windows/Fonts comicbd.ttf Comic Sans MS        Bold\n#&gt; 3 C:/Windows/Fonts  comici.ttf Comic Sans MS      Italic\n#&gt; 4 C:/Windows/Fonts  comicz.ttf Comic Sans MS Bold Italic\nfont_add(family = \"Times New Roman\", regular = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\times.ttf\",\n         bold = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\timesbd.ttf\",\n         italic = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\timesi.ttf\",\n         bolditalic = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\timesbi.ttf\")\nfindfont(\"Times New Roman\")\n#&gt;               path        file          family        face\n#&gt; 1 C:/Windows/Fonts   times.ttf Times New Roman     Regular\n#&gt; 2 C:/Windows/Fonts timesbd.ttf Times New Roman        Bold\n#&gt; 3 C:/Windows/Fonts timesbi.ttf Times New Roman Bold Italic\n#&gt; 4 C:/Windows/Fonts  timesi.ttf Times New Roman      Italic\nfont_families()\n#&gt; [1] \"sans\"            \"serif\"           \"mono\"            \"wqy-microhei\"   \n#&gt; [5] \"Times New Roman\"\n\n\n\nCodeggplot(mpg, aes(x = displ, y = hwy, color = drv)) +\n  geom_point() +\n  labs(\n    title = \"Larger engine sizes tend to have lower fuel economy\",\n    caption = \"Source: https://fueleconomy.gov.\"\n  ) +\n  theme(\n    legend.position = c(0.8, 0.9),\n    legend.direction = \"horizontal\",\n    legend.box.background = element_rect(color = \"blue\"),\n    plot.title = element_text(face = \"bold\",hjust = 0.5),\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    plot.caption = element_text(hjust = 1)\n  )",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#data",
    "href": "ggplot2_graphics.html#data",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "Codelibrary(tidyverse)\n#&gt; Warning: package 'purrr' was built under R version 4.5.2\n#&gt; Warning: package 'stringr' was built under R version 4.5.2\n#&gt; Warning: package 'forcats' was built under R version 4.5.2\n#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.6\n#&gt; ✔ forcats   1.0.1     ✔ stringr   1.6.0\n#&gt; ✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n#&gt; ✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n#&gt; ✔ purrr     1.2.0     \n#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#&gt; ✖ dplyr::filter() masks stats::filter()\n#&gt; ✖ dplyr::lag()    masks stats::lag()\n#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\nlibrary(patchwork)\n#&gt; Warning: package 'patchwork' was built under R version 4.5.2\ndf &lt;- tibble(\n    index = 1:26,\n    pch = 0:25,\n    type = c( rep(\"hollow_color\",15),rep(\"soild_color\",6),rep(\"fill_color\",5)),\n    height = rep(c(1,2,3), times = c(15,6,5)),\n    \n)",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#aesthetics-mapping",
    "href": "ggplot2_graphics.html#aesthetics-mapping",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "mapping=aes(x,y,z,..,color,fill,shape,size,group,linewidth,linetype,alpha,...)\n\nCodeggplot(data = df,\n       mapping = aes(x = index, y = pch ))",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#geometry",
    "href": "ggplot2_graphics.html#geometry",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "图形基元（Graphical primitives）:\n\ngeom_blank(): display nothing. Most useful for adjusting axes limits using data.\ngeom_point(): points.\ngeom_path(): paths.\ngeom_ribbon(): ribbons, a path with vertical thickness.\ngeom_segment(): a line segment, specified by start and end position.\ngeom_rect(): rectangles.\ngeom_polygon(): filled polygons.\ngeom_text(): text.\n\n\n\n\nCodedf &lt;- data.frame(\n  x = c(3, 1, 5), \n  y = c(2, 4, 6), \n  label = c(\"a\",\"b\",\"c\")\n)\n\np &lt;- ggplot(df, aes(x, y, label = label)) + \n  labs(x = NULL, y = NULL) + # Hide axis label\n  theme(plot.title = element_text(size = 12)) # Shrink plot title\n\n(p + geom_point() + ggtitle(\"point\") +\n        p + geom_text() + ggtitle(\"text\") +\n        p + geom_bar(stat = \"identity\") + ggtitle(\"bar\") )/\n(p + geom_tile() + ggtitle(\"tile\") +\n     p + geom_raster() + ggtitle(\"raster\")+\n     p + geom_line() + ggtitle(\"line\")) /\n(p + geom_area() + ggtitle(\"area\") +\n    p + geom_path() + ggtitle(\"path\") +\n    p + geom_polygon() + ggtitle(\"polygon\"))\n\n\n\n\n\n\n\n\n\nOne variable:\n\n\nDiscrete:\n\n\ngeom_bar(): display distribution of discrete variable.\n\n\n\nContinuous:\n\ngeom_histogram(): bin and count continuous variable, display with bars.\ngeom_density(): smoothed density estimate.\ngeom_dotplot(): stack individual points into a dot plot.\ngeom_freqpoly(): bin and count continuous variable, display with lines.\n\n\n\n\n\nTwo variables:\n\n\nBoth continuous:\n\ngeom_point(): scatterplot.\ngeom_quantile(): smoothed quantile regression.\ngeom_rug(): marginal rug plots.\ngeom_smooth(): smoothed line of best fit.\ngeom_text(): text labels.\n\n\n\nShow distribution:\n\ngeom_bin2d(): bin into rectangles and count.\ngeom_density2d(): smoothed 2d density estimate.\ngeom_hex(): bin into hexagons and count.\n\n\n\nAt least one discrete:\n\ngeom_count(): count number of point at distinct locations\ngeom_jitter(): randomly jitter overlapping points.\n\n\n\nOne continuous, one discrete:\n\ngeom_bar(stat = \"identity\"): a bar chart of precomputed summaries.\ngeom_boxplot(): boxplots.\ngeom_violin(): show density of values in each group.\n\n\n\nOne time, one continuous:\n\ngeom_area(): area plot.\ngeom_line(): line plot.\ngeom_step(): step plot.\n\n\n\nDisplay uncertainty:\n\ngeom_crossbar(): vertical bar with center.\ngeom_errorbar(): error bars.\ngeom_linerange(): vertical line.\ngeom_pointrange(): vertical line with center.\n\n\n\nSpatial:\n\n\ngeom_map(): fast version of for map data.\n\n\n\n\n\nThree variables:\n\ngeom_contour(): contours.\ngeom_tile(): tile the plane with rectangles.\ngeom_raster(): fast version of for equal sized tiles.\n\n\n\n\n\n\nCodeggplot(data = mpg) + \n    geom_point(mapping = aes(x=displ,y=hwy),\n               stat = \"identity\",position = \"identity\")\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(displ,hwy)) +\n    geom_point() |\n    \n    ggplot(mpg, aes(displ,hwy)) +\n    geom_point(aes(size = displ/10)) + \n    scale_size_area(name=\"displ/10\")\n\n\n\n\n\n\n\n\n\nCodeeconomics |&gt; head()\n#&gt; # A tibble: 6 × 6\n#&gt;   date         pce    pop psavert uempmed unemploy\n#&gt;   &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;\n#&gt; 1 1967-07-01  507. 198712    12.6     4.5     2944\n#&gt; 2 1967-08-01  510. 198911    12.6     4.7     2945\n#&gt; 3 1967-09-01  516. 199113    11.9     4.6     2958\n#&gt; 4 1967-10-01  512. 199311    12.9     4.9     3143\n#&gt; 5 1967-11-01  517. 199498    12.8     4.7     3066\n#&gt; 6 1967-12-01  525. 199657    11.8     4.8     3018\n\nggplot(economics,aes(date,pop))+\n    geom_line()+\n    scale_x_date()\n\n\n\n\n\n\n\n\n\nCodeq &lt;- ggplot(mpg, aes(displ, hwy)) +\n    geom_point()\n\nq+geom_smooth(method = \"loess\",span = 0.2,se=T) # loess 平滑局部回归   small n\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\nCode                                   #span 0非常摆动，1不那么摆动\n\nq+ geom_smooth(span = 1)  #不很摆动\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\nlibrary(MASS)\n#&gt; \n#&gt; Attaching package: 'MASS'\n#&gt; \n#&gt; The following object is masked from 'package:patchwork':\n#&gt; \n#&gt;     area\n#&gt; \n#&gt; The following object is masked from 'package:dplyr':\n#&gt; \n#&gt;     select\nq+geom_smooth(method = \"rlm\")   # robust linear model  稳健线性模型\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\nCode\nlibrary(mgcv)\n#&gt; Warning: package 'mgcv' was built under R version 4.5.2\n#&gt; Loading required package: nlme\n#&gt; \n#&gt; Attaching package: 'nlme'\n#&gt; \n#&gt; The following object is masked from 'package:dplyr':\n#&gt; \n#&gt;     collapse\n#&gt; \n#&gt; This is mgcv 1.9-4. For overview type '?mgcv'.\nq+ geom_smooth(method = \"gam\", formula = y ~ s(x)) # gam 广义相加模型   n&gt;1000\n\n\n\n\n\n\n\n\nCodebinomial_smooth &lt;- function(...) {\n  geom_smooth(method = \"glm\", method.args = list(family = \"binomial\"), ...)\n}\n\n\n\nggplot(rpart::kyphosis,aes(Age,as.numeric(Kyphosis)-1))+\n    geom_point()+\n    binomial_smooth()\n#&gt; `geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(hwy)) + geom_histogram(binwidth = 2.5)\n\n\n\n\n\n\nCode\n\nggplot(mpg, aes(hwy)) +\n  geom_histogram(binwidth = 1) |\nggplot(mpg, aes(hwy)) +\n  geom_histogram(aes(weight = displ), binwidth = 1) # 加权\n\n\n\n\n\n\nCode\nggplot(data = mpg) + \n    geom_histogram(aes(x=displ,y=after_stat(density)),\n                   stat = \"bin\",position = \"stack\",\n                   binwidth = 0.5\n                   ) +\n    scale_y_continuous(labels=scales::percent) +\n    geom_density(aes(x=displ,y=after_stat(density)),\n                 color=\"red\", linewidth=1)\n\n\n\n\n\n\n\n\n\nCodesmaller &lt;- diamonds |&gt; \n  dplyr::filter(carat &lt; 3)\nggplot(smaller, aes(x = carat, y = price)) +\n  geom_bin2d()\n#&gt; `stat_bin2d()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCode\n# install.packages(\"hexbin\")\nggplot(smaller, aes(x = carat, y = price)) +\n  geom_hex()\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(hwy)) + \n  geom_freqpoly(binwidth = 2.5)\n\n\n\n\n\n\n\n\n\nCode\np &lt;- ggplot(data = mpg)\np + geom_density(aes(displ,fill=drv),\n                 stat = \"density\",position = \"identity\",\n                 alpha=0.3\n                 )+\n    scale_y_continuous(labels = scales::percent)+\n    labs(fill=\"图例名\")+\n    theme(legend.position = \"top\")\n\n\n\n\n\n\n\n\ny→sides=\"r\",\"l\"\nx→sides=\"b\",\"t\"\n\nCodep + geom_rug(aes(x=displ,y=hwy),\n           sides = \"br\",color=\"brown\")\n\n\n\n\n\n\n\n\n\nCodep + geom_jitter(mapping = aes(x=displ,y=hwy),\n               stat = \"identity\",position = \"jitter\")\n\n\n\n\n\n\n\n\n\n\nCodeggplot(data = mpg) + \n    geom_bar(mapping = aes(x=factor(cyl),fill=drv),\n             stat = \"count\",position = \"stack\") |\nggplot(data = mpg) + \n    geom_bar(mapping = aes(x=factor(cyl),fill=drv),\n             position = \"dodge\")\n\n\n\n\n\n\nCode\n\nggplot(data = mpg) + \n    geom_col(mapping = aes(x=factor(cyl),y=hwy,fill=drv),\n             position = \"stack\") |\n\nggplot(data = mpg) + \n    geom_col(mapping = aes(x=factor(cyl),y=hwy,fill=drv),\n             position = \"fill\")+\n    scale_y_continuous(labels = scales::label_percent())\n\n\n\n\n\n\n\n有序条形图\n\nCodeggplot(mpg, aes(x = fct_infreq(class))) +  #降序条形图\n  geom_bar()\n\n\n\n\n\n\n\n\n\ngeom_errorbarh\ngeom_linerange\ngeom_crossbar\ngeom_pointrange\n\n\nCodey &lt;- c(18, 11, 16)\ndf &lt;- data.frame(x = 1:3, y = y, se = c(1.2, 0.5, 1.0))\n\nbase &lt;- ggplot(df, aes(x, y, ymin = y - se, ymax = y + se))\n(base + geom_errorbar()|\nbase + geom_linerange()|\nbase + geom_ribbon())/\n(base + geom_crossbar()|\nbase + geom_pointrange()|\nbase + geom_smooth(stat = \"identity\"))\n\n\n\n\n\n\n\n\nCoderead_csv(\"data/g.csv\") |&gt; \n    summarise(\n        mean=mean(liverweight),\n        sd=sd(liverweight),\n        .by=treatment\n  ) |&gt; \n    ggplot(aes(treatment,mean,fill=treatment))+\n    geom_bar(stat = \"identity\")+\n    geom_errorbar(aes(ymin=mean-sd,ymax=mean+sd),width=.2)\n#&gt; Rows: 20 Columns: 2\n#&gt; ── Column specification ────────────────────────────────────────────────────────\n#&gt; Delimiter: \",\"\n#&gt; chr (1): treatment\n#&gt; dbl (1): liverweight\n#&gt; \n#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.\n#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg)+geom_dotplot(mapping = aes(x=drv,y=hwy),\n                 position = \"identity\",\n                 stackdir = \"center\",binaxis = 'y',# stacking along y axis\n                 fill=\"red\",binwidth = 0.7)\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg) + geom_boxplot(mapping = aes(x=drv,y=hwy),\n             stat = \"boxplot\",position = \"dodge\",\n             notch=TRUE, varwidth=TRUE,\n             width=0.1,fill=\"green\"\n            )+\n    geom_violin(aes(x=drv,y=hwy),alpha=0.2)\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg) + geom_violin(mapping = aes(x=drv,y=hwy),\n             stat = \"ydensity\",position = \"dodge\")\n\n\n\n\n\n\n\n\n\nCode# 设置随机数种子以确保结果的可重复性  \nset.seed(10)  \n  \n# 生成随机数据集  \nmydata &lt;- tibble(  \n  year = 2000:2024,  \n  lung = runif(25),  \n  liver = runif(25), \n  bone = runif(25),  \n  luk = runif(25),  \n  eso = runif(25),  \n  gas = runif(25),   \n  eye = runif(25),  \n  brain = runif(25),  \n  pan = runif(25),  \n  kidney = runif(25),  \n  breast= runif(25),  \n)  |&gt; pivot_longer(cols = -1,\n                   names_to = \"cancer\",\n                   values_to = \"morbidity\")\n\nggplot(mydata, aes(year, cancer)) +  \n  geom_tile(aes(fill =morbidity)) +  \n  scale_fill_gradient(low = \"white\", high = \"red\")",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#statistical-transformations",
    "href": "ggplot2_graphics.html#statistical-transformations",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "stat_bin()：geom_bar()，geom_freqpoly()，geom_histogram()\nstat_bin2d()：geom_bin2d()\nstat_bindot()：geom_dotplot()\nstat_binhex()：geom_hex()\nstat_boxplot()：geom_boxplot()\nstat_contour()：geom_contour()\nstat_quantile()：geom_quantile()\nstat_smooth()：geom_smooth()\nstat_sum()：geom_count()\nstat_ecdf()：计算经验累积分布图。\nstat_function()：根据 x 值的函数计算 y 值。\nstat_summary()：将 Y 值汇总到不同的 X 值。\n\nCodemtcars |&gt; \n    ggplot(aes(x = factor(am) , y= mpg))+\n    stat_summary(geom = \"bar\",fun = mean)\n\n\n\n\n\n\n\n\nCodeggplot(diamonds) + \n  stat_summary(\n    aes(x = cut, y = depth),\n    geom = \"errorbar\",\n    fun.min = min,\n    fun.max = max,\n    fun = mean\n  )\n\n\n\n\n\n\nCode\nggplot(mpg, aes(trans, cty)) + \n    geom_point() + \n    stat_summary(geom = \"point\", fun = \"mean\", colour = \"red\", size = 4)\n\n\n\n\n\n\n\nstat_summary2d() ：汇总分箱值。\nstat_summary_hex()\nstat_qq()：对分位数-分位数图执行计算。\nstat_spoke()：将角度和半径转换为位置。\nstat_unique()：删除重复的行。",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#position-adjustments",
    "href": "ggplot2_graphics.html#position-adjustments",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "Codeggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(alpha = 1/5, position = \"identity\")|\n\nggplot(mpg, aes(x = drv, color = class)) + \n  geom_bar(fill = NA, position = \"identity\")\n\n\n\n\n\n\nCode\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(position = \"fill\")|\n\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(position = \"dodge\")\n\n\n\n\n\n\n\n\nposition_nudge()：按固定偏移量移动点。\nposition_jitter()：为每个位置添加一点随机噪音。\nposition_jitterdodge()：躲避组内的点，然后添加一点随机噪音。\n\nCodeggplot(mpg, aes(x = factor(cyl), y = hwy)) + \n  geom_point(position = \"identity\") |\nggplot(mpg, aes(x = factor(cyl), y = hwy)) + \n  geom_point(position = \"jitter\")\n\n\n\n\n\n\nCode\nggplot(mpg, aes(x = factor(cyl), y = hwy)) + \n  geom_point(position =position_nudge(x=0.1,y=0))|\nggplot(mpg, aes(x = factor(cyl), y = hwy,color=factor(cyl))) + \n  geom_point(position = position_jitterdodge())",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#scale-and-guides",
    "href": "ggplot2_graphics.html#scale-and-guides",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "Argument name\nAxis\nLegend\n\n\n\nname\nLabel\nTitle\n\n\nbreaks\nTicks & grid line\nKey\n\n\nlabels\nTick label\nKey label\n\n\n\n\n\n\n\nCodeshape_names &lt;- c(\n  \"circle\", paste(\"circle\", c(\"open\", \"filled\", \"cross\", \"plus\", \"small\")), \"bullet\",\n  \"square\", paste(\"square\", c(\"open\", \"filled\", \"cross\", \"plus\", \"triangle\")),\n  \"diamond\", paste(\"diamond\", c(\"open\", \"filled\", \"plus\")),\n  \"triangle\", paste(\"triangle\", c(\"open\", \"filled\", \"square\")),\n  paste(\"triangle down\", c(\"open\", \"filled\")),\n  \"plus\", \"cross\", \"asterisk\"\n)\n\nshapes &lt;- data.frame(\n  shape_names = shape_names,\n  x = c(1:7, 1:6, 1:3, 5, 1:3, 6, 2:3, 1:3),\n  y = -rep(1:6, c(7, 6, 4, 4, 2, 3))\n)\n\nggplot(shapes, aes(x, y)) +\n  geom_point(aes(shape = shape_names), fill = \"red\", size = 5) +\n  geom_text(aes(label = shape_names), nudge_y = -0.3, size = 3.5) +\n  scale_shape_identity() +\n  theme_void()\n\n\n\n\n\n\n\n\n填充颜色，形状（ggpattern）\n\nCode# library(grid)\n# library(scales)\n\n\n\n\nCodeggplot(mpg, aes(log10(cty),hwy)) +\n    geom_point()+\n    scale_x_log10()\n\n\n\n\n\n\n\n\nCodeggplot(mtcars, aes(x = wt, y = mpg)) + \n  geom_point() +\n  scale_x_continuous(name = \"Weight (1000 lbs.)\",   \n                     n.breaks = 10,                 \n                     minor_breaks = NULL,           \n                     limits = c(1.5, 5.5)) +        \n  scale_y_continuous(name = \"Miles per gallon\",     \n                     breaks = seq(10, 35, 5),       \n                     minor_breaks = seq(10, 35, 1), \n                     limits = c(10, 35)) +          \n  labs(title = \"Fuel efficiency by car weight\")\n\n\n\n\n\n\n\n\nCodeggplot(diamonds, aes(x = price, y = cut)) +\n  geom_boxplot(alpha = 0.05) +\n  scale_x_continuous(labels = scales::label_dollar(scale = 1/1000, suffix = \"K\"))\n\n\n\n\n\n\nCode\nggplot(diamonds, aes(x = cut, fill = clarity)) +\n  geom_bar(position = \"fill\") +\n  scale_y_continuous(name = \"Percentage\", labels = scales::label_percent())\n\n\n\n\n\n\n\n\nCodeggplot(mpg,aes(x=factor(drv),fill=class))+\n    geom_bar(position = \"fill\") -&gt;p\np | p + scale_x_discrete(name = \"drv\",                                  \n                   limits = c(\"f\", \"r\"),    \n                   labels = c('f'=\"drv='f'\",'r'= \"drv='r'\"),\n                   position = \"top\") \n#&gt; Warning: Removed 103 rows containing non-finite outside the scale range\n#&gt; (`stat_count()`).",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#coordinate",
    "href": "ggplot2_graphics.html#coordinate",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "默认坐标系是笛卡尔坐标系\n\nCodebar &lt;- ggplot(data = diamonds) + \n  geom_bar(\n    mapping = aes(x = clarity, fill = clarity), \n    show.legend = FALSE,\n    width = 1\n  ) + \n  theme(aspect.ratio = 1)\nbar\n\n\n\n\n\n\nCodebar + coord_cartesian() |#笛卡尔坐标\nbar + coord_flip()| #水平条形图\nbar + coord_polar()#极坐标",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#轴-axis",
    "href": "ggplot2_graphics.html#轴-axis",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "Codeggplot(mpg, aes(displ, hwy)) +\n    geom_point(na.rm = TRUE) | \nggplot(mpg, aes(displ, hwy)) +\n    geom_point(na.rm = TRUE) +\n    xlim(5, 6) +\n    ylim(10, 25)\n\n\n\n\n\n\nCode\nggplot(mpg, aes(drv, hwy)) +\n    geom_jitter(width = 0.25, na.rm = TRUE) +\n    xlim(\"f\", \"r\") +\n    ylim(25, NA)\n\n\n\n\n\n\n\n\nCode# filter\nmpg |&gt;\n  dplyr::filter(displ &gt;= 5 & displ &lt;= 6 & hwy &gt;= 10 & hwy &lt;= 25) |&gt;\n  ggplot(aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth(na.rm=TRUE)|\n# limits\nggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth(na.rm=TRUE) +\n  scale_x_continuous(limits = c(5, 6)) +    #取子集\n  scale_y_continuous(limits = c(10, 25))  \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n#&gt; Warning: Removed 202 rows containing missing values or values outside the scale range\n#&gt; (`geom_point()`).\n\n\n\n\n\n\n\n\n\nCode\n# Sample data\nx &lt;- droplevels(chickwts$feed[1:36])\nlevels(x) &lt;- LETTERS[1:3]\ny &lt;- chickwts$weight[1:36]\ndf &lt;- data.frame(x = x, y = y)\n\n# Plot\np &lt;- ggplot(df, aes(x = x, y = y)) + \n      stat_boxplot(geom = \"errorbar\",\n                   width = 0.25) +\n      geom_boxplot(fill = \"dodgerblue1\",\n                   colour = \"black\",\n                   alpha = 0.5,\n                   outlier.colour = \"tomato2\")\np|p + \n  theme(axis.ticks.length  = unit(0.5, \"cm\")) + \n  theme(axis.ticks = element_line(color = 2,\n                                  linewidth = 2))\n\n\n\n\n\n\n\n\n调整绘制的数据,在每个刻度中设置coord_cartesian(xlim= ,ylim= )\n\nCodeggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth() |\n    ggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = drv)) +\n  geom_smooth()+\n  coord_cartesian(xlim = c(5, 6), ylim = c(10, 25))   #放大局部\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\np + \n   coord_cartesian(ylim = c(100, 200)) \n\n\n\n\n\n\n\n\n\nCodep + \n  expand_limits(x = 0, y = 0) \n\n\n\n\n\n\nCodep + \n  theme(axis.line = element_line(arrow = arrow(angle = 30,\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"))) \n\n\n\n\n\n\n\n\n\nCodeggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(trans = ~.* 2, name = \"Z-axis title\")) \n#&gt; Warning: The `trans` argument of `sec_axis()` is deprecated as of ggplot2 3.5.0.\n#&gt; ℹ Please use the `transform` argument instead.\n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\n\n# 次轴   breaks\n\nggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(~.* 2, name = \"Z-axis title\",\n                                         breaks = c(100, 200, 300))) \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode# 次轴    labels\nggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(~.* 2, name = \"Z-axis title\",\n                                         breaks = c(100, 200, 300),\n                                         labels = c(\"A\", \"B\", \"C\"))) \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\nCode\n\n\nggplot(cars, aes(x = speed, y = dist)) +\n  geom_col() +\n  geom_smooth(data = cars, aes(x = speed, y = dist * 2)) + \n  scale_y_continuous(sec.axis = sec_axis(~.* 2, name = \"Z-axis title\")) + \n  theme(axis.title.y.right = element_text(color = \"red\", \n                                          size = 15,\n                                          face = \"bold\"),\n        axis.text.y.right = element_text(color = \"blue\", size = 10),\n        axis.line.y.right = element_line(color = \"orange\")) \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\nshared 坐标轴相同\n\nCodex_scale &lt;- scale_x_continuous(limits = range(mpg$displ))\ny_scale &lt;- scale_y_continuous(limits = range(mpg$hwy))\ncol_scale &lt;- scale_color_discrete(limits = unique(mpg$drv))\nggplot(mpg[mpg$class==\"suv\",], aes(x = displ, y = hwy, color = drv)) +\n  geom_point() +\n  x_scale +\n  y_scale +\n  col_scale|\nggplot(mpg[mpg$class==\"compact\",], aes(x = displ, y = hwy, color = drv)) +\n  geom_point() +\n  x_scale +\n  y_scale +\n  col_scale",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#annotation",
    "href": "ggplot2_graphics.html#annotation",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "Codeggplot(mpg, aes(cty, hwy)) +\n    geom_point(alpha = 1 / 3) +\n    xlab(\"city driving (mpg)\") +\n    ylab(\"highway driving (mpg)\")+\n    ggtitle(label = \"主标题\",\n            subtitle = \"副标题\")+\n     theme(plot.title.position = \"panel\") # 默认\n\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point(aes(color = class)) +\n  geom_smooth(se = FALSE) +\n  labs(\n    title = \"Fuel efficiency generally decreases with engine size\",\n    subtitle = \"Two seaters (sports cars) are an \n    exception because of their light weight\",\n    caption = \"Data from fueleconomy.gov\",\n    tag = \"Fig. 1\",\n    x = \"Engine displacement (L)\",\n    y = \"Highway fuel economy (mpg)\",\n    color = \"Car type\", # 图例 美学映射color\n  )+\n    theme(plot.title.position = \"plot\",# 相对于整个绘图进行设置\n          plot.caption.position = \"plot\",\n          plot.tag.position = \"topleft\",\n        plot.caption = element_text(hjust = 0))  \n#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\nCodeggplot(economics, aes(date, unemploy)) +\n  geom_area(fill = rgb(0, 0.5, 1, alpha = 0.5)) + \n  labs(title = \"Title of the plot\",\n       subtitle = \"Subtitle of the plot\",\n       caption = \"This is the caption\",\n       tag = \"Fig. 1\") + \n  theme(plot.title = element_text(family = \"serif\",              # Font family\n                                  face = \"bold\",                 # Font face\n                                  color = 4,                     # Font color\n                                  size = 15,                     # Font size\n                                  hjust = 1,             # Horizontal adjustment\n                                  vjust = 1,             # Vertical adjustment\n                                  angle = -10,                   # Font angle\n                                  lineheight = 1,                # Line spacing\n                                  margin = margin(20, 0, 0, 0)), # Margins (t, r, b, l)\n        plot.subtitle = element_text(hjust = 0),    # Subtitle customization\n        plot.caption = element_text(hjust = 0.25),  # Caption customization\n        plot.tag = element_text(face = \"italic\"),   # Tag customization\n        plot.title.position = \"plot\",               # Title and subtitle position (\"plot\" or \"panel\")\n        plot.caption.position = \"panel\",            # Caption position (\"plot\" or \"panel\")\n        plot.tag.position = \"top\")                  # Tag position\n\n\n\n\n\n\n\n\n\n\nCode# 字体 样式\ndf &lt;- data.frame(x = 1:3, y = 1:3, \n                 family = c(\"sans\", \"serif\", \"mono\"),\n                 face = c(\"plain\", \"bold\", \"italic\"))\nggplot(df, aes(x, y)) + \n  geom_text(mapping = aes(label = paste0(family,\": \",face), \n                          family = family, fontface = face),\n            vjust = \"inward\", hjust = \"inward\")\n\n\n\n\n\n\nCode\n# 位置\ndf &lt;- data.frame(\n  x = c(1, 1, 2, 2, 1.5),\n  y = c(1, 2, 1, 2, 1.5),\n  text = c(\n    \"bottom-left\", \"top-left\",  \n    \"bottom-right\", \"top-right\", \"center\"\n  )\n)\nggplot(df, aes(x, y)) +\n  geom_text(aes(label = text), vjust = \"inward\", hjust = \"inward\")\n\n\n\n\n\n\nCode\n\n# 自定义\ndf &lt;- data.frame(\n  treatment = c(\"a\", \"b\", \"c\"), \n  response = c(1.2, 3.4, 2.5)\n)\nggplot(df, aes(treatment, response)) + \n  geom_point() + \n  geom_text(\n    mapping = aes(label = paste0(\"(\", response, \")\")), \n    nudge_x = -0.3,\n    nudge_y=.2\n  ) \n\n\n\n\n\n\n\n\nCodelabel_info &lt;- mpg |&gt;\n    group_by(drv) |&gt;\n    arrange(desc(displ)) |&gt;\n    slice_head(n = 1)|&gt;\n    mutate(\n        drive_type = case_when(       # vectorise multiple if_else () statements \n        drv == \"f\" ~ \"front-wheel drive\",\n        drv == \"r\" ~ \"rear-wheel drive\",\n        drv == \"4\" ~ \"4-wheel drive\")\n        )|&gt;\n    dplyr::select(displ, hwy, drv, drive_type)\n\np &lt;-ggplot(mpg, aes(x = displ, y = hwy, color = drv)) +\n    geom_point(alpha = 0.3) +\n    geom_smooth(method=\"lm\",formula=\"y~x\",se = FALSE) +\n    theme(legend.position = \"none\")\n\np+  geom_text(#添加注释  geom_label 标签加背景框\n    data = label_info, \n    aes(x = displ, y = hwy, label = drive_type),#label映射\n    fontface = \"bold\", size = 5, nudge_y = 2\n    )\n\n\n\n\n\n\nCode\np + ggrepel::geom_label_repel(                   \n    data = label_info, \n    aes(x = displ, y = hwy, label = drive_type),\n    fontface = \"bold\", size = 5, nudge_y = 2\n  ) \n\n\n\n\n\n\nCode\n\npotential_outliers &lt;- mpg |&gt;\n  dplyr::filter(hwy &gt; 40 | (hwy &gt; 20 & displ &gt; 5))\n\nggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point() +\n  ggrepel::geom_text_repel(data = potential_outliers, aes(label = model)) +\n  geom_point(data = potential_outliers, color = \"red\") +\n  geom_point(\n    data = potential_outliers,\n    color = \"red\", size = 3, shape = \"circle open\"\n  )\n\n\n\n\n\n\n\n\ngeom_hline()\ngeom_vline()\ngeom_abline\ngeom_segment() arrow\n\nCodetrend_text &lt;- \"Larger engine sizes tend to have lower fuel economy.\" |&gt;\n  str_wrap(width = 30)\ntrend_text\n#&gt; [1] \"Larger engine sizes tend to\\nhave lower fuel economy.\"\nggplot(mpg, aes(x = displ, y = hwy)) +\n  geom_point() +\n  annotate(\n    geom = \"label\", x = 3.5, y = 38,\n    label = trend_text,\n    hjust = \"left\", color = \"red\"\n  ) +\n  annotate(\n    geom = \"segment\",\n    x = 3, y = 35, xend = 5, yend = 25, color = \"red\",\n    arrow = arrow(type = \"closed\")\n  )\n\n\n\n\n\n\n\n\nCodep &lt;- ggplot(mpg, aes(displ, hwy)) +\n  geom_point(\n    data = dplyr::filter(mpg, manufacturer == \"subaru\"), \n    colour = \"orange\",\n    size = 3\n  ) +\n  geom_point() \np|p + \n  annotate(geom = \"point\", x = 5.5, y = 40, colour = \"orange\", size = 3) + \n  annotate(geom = \"point\", x = 5.5, y = 40) + \n  annotate(geom = \"text\", x = 5.6, y = 40, label = \"subaru\", hjust = \"left\")|\np + \n  annotate(\n    geom = \"curve\", x = 4, y = 35, xend = 2.65, yend = 27, \n    curvature = .3, arrow = arrow(length = unit(2, \"mm\"))\n  ) +\n  annotate(geom = \"text\", x = 4.1, y = 35, label = \"subaru\", hjust = \"left\")\n\n\n\n\n\n\n\n\n\nCodedf &lt;- data.frame(x = 1:3, y = 1:3)\nbase &lt;- ggplot(df, aes(x, y)) + \n  geom_point() + \n  labs(x = \"Axis title with *italics* and **bold**\")\n\n\nlibrary(ggtext)\nbase |\nbase + \n  geom_richtext(aes(x = 2, y = 3,\n                    label =  \"**title** of &lt;span style = 'color:red'&gt;xy&lt;/span&gt;\"),\n                angle =-25)  + theme(axis.title.x = ggtext::element_markdown()) \n#&gt; Warning in geom_richtext(aes(x = 2, y = 3, label = \"**title** of &lt;span style = 'color:red'&gt;xy&lt;/span&gt;\"), : All aesthetics have length 1, but the data has 3 rows.\n#&gt; ℹ Please consider using `annotate()` or provide this layer with data containing\n#&gt;   a single row.\n\n\n\n\n\n\n\n\n?plotmath\n\nCode\ntibble(\n  x = 1:10,\n  y = cumsum(x^2)) %&gt;% \n  ggplot(aes(x, y)) +\n  geom_point() +\n  labs(\n    x = quote(x[i]),\n    y = quote(sum(x[i] ^ 2, i == 1, n)) #数学方程式\n  )\n\n\n\n\n\n\nCode\nvalues &lt;- seq(from = -2, to = 2, by = .01)\ndf &lt;- tibble(x = values, y = values ^ 3)\nggplot(df, aes(x, y)) + \n  geom_path() + \n  labs(y = quote(f(x) == x^3))         #数学表达式   ？plotmath",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#facet",
    "href": "ggplot2_graphics.html#facet",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "Codeq &lt;- ggplot(mpg,aes(x=displ))+\n  geom_histogram(fill=\"lightblue\")\n\n# 一个分类变量\nq + facet_wrap(~drv,nrow = 3)\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCodeq + facet_wrap(~drv,ncol = 3)  #\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCode\n# 多个分类变量\nq + facet_grid(drv~class)\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCodeq + facet_grid(drv~.)\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\nCodeq + facet_grid(.~drv)   #\n#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n\n\n\n\n\n\n\n\nCodeggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  facet_grid(drv ~ cyl) |\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  facet_grid(drv ~ cyl, scales = \"free_y\")",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#themes",
    "href": "ggplot2_graphics.html#themes",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "plot, axis, legend, panel and facet\n\n\n\nElement\nSetter\nDescription\n\n\n\nplot.background\nelement_rect()\nplot background\n\n\nplot.title\nelement_text()\nplot title\n\n\nplot.margin\nmargin()\nmargins around plot\n\n\n\n\n\n\n\n\n\n\n\npanel.background\nelement_rect()\npanel background (under data)\n\n\npanel.border\nelement_rect()\npanel border (over data)\n\n\npanel.grid.major\nelement_line()\nmajor grid lines\n\n\npanel.grid.major.x\nelement_line()\nvertical major grid lines\n\n\npanel.grid.major.y\nelement_line()\nhorizontal major grid lines\n\n\npanel.grid.minor\nelement_line()\nminor grid lines\n\n\npanel.grid.minor.x\nelement_line()\nvertical minor grid lines\n\n\npanel.grid.minor.y\nelement_line()\nhorizontal minor grid lines\n\n\naspect.ratio\nnumeric\nplot aspect ratio\n\n\n\n\nCodelibrary(ggplot2)\n\nbase &lt;- ggplot() +\n  stat_function(fun = dnorm, geom = \"density\",\n                xlim = c(-4, 4),\n                fill = rgb(0, 0, 1, 0.1))\n\n\nbase + theme(\n    plot.background = element_rect(\n        colour = \"red\",\n        fill = \"lightblue\",\n        # 默认 fill = NA\n        linewidth = 2,\n    ),\n    plot.margin = margin(\n        t = 2,\n        # Top margin\n        r = 2,\n        # Right margin\n        b = 2,\n        # Bottom margin\n        l = 2\n    )# Left margin\n) +  theme(\n    panel.background = element_rect(fill = \"lightyellow\"),\n    panel.grid.major.y = element_line(color = \"green\", linewidth = 0.8),\n    panel.grid.major.x = element_line(color = \"purple\", linewidth = 0.8))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nElement\nSetter\nDescription\n\n\n\nlegend.background\nelement_rect()\nlegend background\n\n\nlegend.key\nelement_rect()\nbackground of legend keys\n\n\nlegend.key.size\nunit()\nlegend key size\n\n\nlegend.key.height\nunit()\nlegend key height\n\n\nlegend.key.width\nunit()\nlegend key width\n\n\nlegend.margin\nunit()\nlegend margin\n\n\nlegend.text\nelement_text()\nlegend labels\n\n\nlegend.text.align\n0–1\nlegend label alignment (0 = right, 1 = left)\n\n\nlegend.title\nelement_text()\nlegend name\n\n\nlegend.title.align\n0–1\nlegend name alignment (0 = right, 1 = left)\n\n\n\n\nCodedf &lt;- data.frame(x = 1:4, y = 1:4, z = rep(c(\"a\", \"b\"), each = 2))\nbase &lt;- ggplot(df, aes(x, y, colour = z)) + geom_point()\n\nbase + theme(\n  legend.background = element_rect(\n    fill = \"lemonchiffon\", \n    colour = \"grey50\", \n    linewidth = 1\n  )\n)\n\n\n\n\n\n\nCodebase + theme(\n  legend.key = element_rect(color = \"grey50\"),\n  legend.key.width = unit(0.9, \"cm\"),\n  legend.key.height = unit(0.75, \"cm\")\n)\n\n\n\n\n\n\nCodebase + theme(\n  legend.text = element_text(size = 15),\n  legend.title = element_text(size = 15, face = \"bold\")\n)\n\n\n\n\n\n\nCode\nbase + \n  theme(legend.position = \"top\") +\n  guides(color = guide_legend(nrow = 3))\n\n\n\n\n\n\nCodebase + \n  theme(legend.position = \"bottom\") +\n  guides(color = guide_legend(nrow = 2, override.aes = list(size = 4)))\n\n\n\n\n\n\nCode\n# 文本\n\nggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +\n  geom_point(size=3) +\n  scale_color_discrete(name=\"Cylinders\") +\n  theme(legend.position = c(.95, .95),\n        legend.justification = c(1, 1),\n        legend.background = element_rect(fill = \"lightgrey\",\n                                         color = \"white\",\n                                         linewidth = 1),\n        legend.key = element_blank(),\n        legend.direction = \"horizontal\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nElement\nSetter\nDescription\n\n\n\naxis.line\nelement_line()\nline parallel to axis (hidden in default themes)\n\n\naxis.text\nelement_text()\ntick labels\n\n\naxis.text.x\nelement_text()\nx-axis tick labels\n\n\naxis.text.y\nelement_text()\ny-axis tick labels\n\n\naxis.title\nelement_text()\naxis titles\n\n\naxis.title.x\nelement_text()\nx-axis title\n\n\naxis.title.y\nelement_text()\ny-axis title\n\n\naxis.ticks\nelement_line()\naxis tick marks\n\n\naxis.ticks.length\nunit()\nlength of tick marks",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  },
  {
    "objectID": "ggplot2_graphics.html#字体",
    "href": "ggplot2_graphics.html#字体",
    "title": "\n1 ggplot2 Graphics",
    "section": "",
    "text": "Codefindfont &lt;- function(x){\n  suppressMessages(require(showtext))\n  suppressMessages(require(dplyr))\n  dplyr::filter(font_files(), grepl(x, family, ignore.case=TRUE)) |&gt; \n    dplyr::select(path, file, family, face)\n}\n\nfindfont(\"comic\")\n#&gt;               path        file        family        face\n#&gt; 1 C:/Windows/Fonts   comic.ttf Comic Sans MS     Regular\n#&gt; 2 C:/Windows/Fonts comicbd.ttf Comic Sans MS        Bold\n#&gt; 3 C:/Windows/Fonts  comici.ttf Comic Sans MS      Italic\n#&gt; 4 C:/Windows/Fonts  comicz.ttf Comic Sans MS Bold Italic\nfont_add(family = \"Times New Roman\", regular = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\times.ttf\",\n         bold = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\timesbd.ttf\",\n         italic = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\timesi.ttf\",\n         bolditalic = \"C:\\\\Windows\\\\Fonts\\\\Times New Roman\\\\timesbi.ttf\")\nfindfont(\"Times New Roman\")\n#&gt;               path        file          family        face\n#&gt; 1 C:/Windows/Fonts   times.ttf Times New Roman     Regular\n#&gt; 2 C:/Windows/Fonts timesbd.ttf Times New Roman        Bold\n#&gt; 3 C:/Windows/Fonts timesbi.ttf Times New Roman Bold Italic\n#&gt; 4 C:/Windows/Fonts  timesi.ttf Times New Roman      Italic\nfont_families()\n#&gt; [1] \"sans\"            \"serif\"           \"mono\"            \"wqy-microhei\"   \n#&gt; [5] \"Times New Roman\"\n\n\n\nCodeggplot(mpg, aes(x = displ, y = hwy, color = drv)) +\n  geom_point() +\n  labs(\n    title = \"Larger engine sizes tend to have lower fuel economy\",\n    caption = \"Source: https://fueleconomy.gov.\"\n  ) +\n  theme(\n    legend.position = c(0.8, 0.9),\n    legend.direction = \"horizontal\",\n    legend.box.background = element_rect(color = \"blue\"),\n    plot.title = element_text(face = \"bold\",hjust = 0.5),\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    plot.caption = element_text(hjust = 1)\n  )",
    "crumbs": [
      "ggplot2 图形",
      "ggplot2 Graphics"
    ]
  }
]